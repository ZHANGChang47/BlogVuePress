---
title: Vue2项目笔记
date: 2023-02-03 23:27:27
permalink: /pages/09eb89/
categories:
  - 前端
tags:
  - 
---
# Vue2项目笔记

## 0、项目的技术栈展示以及项目的核心重点部分

![项目技术栈](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/8.png)

1. 项目搭建+使用element实现首页布局
2. 顶部导航菜单及与左侧导航联动的面包屑实现
3. 封装一个ECharts组件 
4. 封装一个Form表单组件和Table表格组件 
5. 企业开发之权限管理思路讲解

## 1、脚手架的搭建

### 1.1、Yarn是什么

Yarn是Facebook、Google、Exponent和Tilde联合推出了一个新的JS包管理工具，正如官方文档所说，它是为弥补npm的一些缺陷而出现的。

**下载yarn:**

```bash
npm i -g yarn
```

**查看yarn的版本：**

```bash
yarn -v
```

**npm的坑：**

- npm install下载巨慢

- 同一个项目，安装的时候无法保持一致性。由于package.json文件中版本号的特点，下方版本号在安装时有不同含义

  ```json
  "5.0.3"		#表示安装指定的5.0.3版本
  "~5.0.3"	#表示安装5.0.X中最新的版本
  "^5.0.3"	#表示安装5.X.X中最新的版本
  ```

- 安装的时候，包会在同一时间下载和安装，中途某个时候，一个包抛出了一个错误，但是npm会继续下载和安装包。因为npm会把所有的日志输出终端，有有关错误包的错误信息就会在一大堆npm打印的警告中丢失，并且有可能永远注意不到实际发生的错误

**Yarn的优点：**

- 速度快
  - 并行安装：无论是npm还是Yarn在执行包安装时，都会执行一系列任务。npm是按照队列执行每个package,，也就是说必须要等到当前package安装完成后，才能继续后面的安装。而Yarn是同步执行所有任务，提高了性能
  - 离线模式：如果之前已经安装过一个软件包，用Yarn再次安装时直接从缓存中获取，就不用像npm那样从网络下载了
- 安装版本统一：为了防止拉取到不同的版本，Yarn有一个锁定文件（lock file）记录了被确切安装上的模块的版本号。每次只要新增了一个模块，Yarn就会创建（或更新）yarn.lock这个文件，这样做就保证了每一次拉取同一个项目依赖时，使用的都是一样的模块版本
- 更简洁的输出：npm的输出信息比较冗长，在执行npm install的时候，命令行里会不断打印出所有被安装上的依赖。相比之下，Yarn简洁太多，默认情况下，结合了emoji直观且直接地打印出必要地信息，也提供了一些命令供开发者查询额外地安装信息
- 多注册来源处理：所有的依赖包，不管它被不同的库间接关联引用多少次，安装这个包时，只会从一个注册来源去装，要么是npm要么是bower，防止出现混乱不一致
- 更好的语义化：yarn改变了一些npm命令的名称，比如yarn add/remove，感觉上比npm原有的install/uninstall更加清晰

**Yarn与npm命令对比**

| npm                          | yarn                 |
| ---------------------------- | -------------------- |
| npm install                  | yarn                 |
| npm install react --save     | yarn add react       |
| npm uninstall react --save   | yarn remove react    |
| npm install react --save-dev | yarn add react --dev |
| npm update --save            | yarn upgrade         |

### 1.2、安装vue-cli

如果报错：

```bash
vue create is a Vue CLI 3 only command and you are using Vue CLI 2.9.6.
  You may want to run the following to upgrade to Vue CLI 3:

  npm uninstall -g vue-cli
  npm install -g @vue/cli
```

[需要先卸载，再安装！！！](https://blog.csdn.net/weixin_43796818/article/details/124708724)

### 1.3、项目构建

在构建项目的时候，项目名称不能包含大写字母以及使用驼峰命名

![image-20221209105006726](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209105006726.png)

在Vue CLI v5.0.8中默认是vue3的版本，可以选择vue2或者自定义相关依赖

选择vue2进行项目搭建，并使用yarn下载相关依赖

![image-20221209105344198](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209105344198.png)

![image-20221209105453080](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209105453080.png)

使用Vscode打开，可以看到我们生产的项目

![image-20221209105615460](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209105615460.png)

package.json中的scripts表示我们可以启动的脚本

使用如下代码，便可启动

```bash
npm run serve
```

![image-20221209105904321](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209105904321.png)

![image-20221209110105801](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209110105801.png)

### 1.4、使用yarn安装element-ui

```bash
yarn add element-ui
```

![image-20221209114836647](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221209114838224.png)

#### 1.4.1、全局引用

在`main.js`中添加如下:

```js
import ElementUI from 'element-ui';
import 'element-ui/lib/theme-chalk/index.css';

Vue.config.productionTip = false

Vue.use(ElementUI)
```

![image-20221209115101024](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209115101024.png)

在App.vue中进行修改测试

![image-20221209115359851](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209115359851.png)

![image-20221209115428750](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209115428750.png)

#### 1.4.2、按需引用

只引入需要的组件，以达到减小项目体积的目的

首先安装插件：

```bash
yarn add babel-plugin-component -D
```

然后修改babel.config.js文件：

```js
module.exports = {
  presets: [
    '@vue/cli-plugin-babel/preset',
    ["es2015", { "modules": false }]
  ],
  "plugins": [
    [
      "component",
      {
        "libraryName": "element-ui",
        "styleLibraryName": "theme-chalk"
      }
    ]
  ]
}
```

再修改main.js文件

```js
import Vue from 'vue'
import App from './App.vue'
// import ElementUI from 'element-ui';
import {Row,Button} from 'element-ui'
import 'element-ui/lib/theme-chalk/index.css';

Vue.config.productionTip = false

// Vue.use(ElementUI);
Vue.use(Row)
Vue.use(Button)

new Vue({
  render: h => h(App),
}).$mount('#app')
```

### 1.5、路由

引入vue-router

```bash
yarn add vue-router@3.6.5
```

在src目录下创建router文件夹，然后创建index.js文件

![image-20221209144828175](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209144828175.png)

在index.js中填写内容，导入Vue与VueRouter，并use

```js
import Vue from 'vue'
import VueRouter from 'vue-router';

Vue.use(VueRouter);
```

![image-20221209145446286](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209145446286.png)

#### 1.5.1、路由案例

1、首先在src目录下创建views文件夹，用来存放一个个视图组件，如：Home.vue与User.vue

![image-20221209145842227](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209145842227.png)

2、在index.js文件中将组件与路由进行映射处理，创建router实例，并将其挂载至根目录

```js
import Vue from 'vue'
import VueRouter from 'vue-router';
import Home from '../views/Home.vue';
import User from '../views/User.vue';

Vue.use(VueRouter);

//1.创建路由组件

//2.将路由与组件进行映射
const routes = [
    {path:'/home',component: Home},
    {path:'/user',component: User}
]

//3.创建router实例
const router = new VueRouter({
    routes
})

// 4. 创建和挂载根实例。
// 记得要通过 router 配置参数注入路由，
// 从而让整个应用都有路由功能
export default router
```

![image-20221209151503312](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209151503312.png)

3、在main.js中导入router

![image-20221209151616208](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209151616208.png)

4、在App.vue中要指定路由匹配组件显示渲染的位置

```html
<router-view></router-view>
```

![image-20221209151727189](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209151727189.png)

5、在终端运行

```bash
npm run serve
```

若报错内容有关eslint，则在vue.config.js文件中进行修改，增加内容：

```js
lintOnSave:false  //关闭eslint校验
```

![image-20221209152036379](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209152036379.png)

![image-20221209152043862](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209152043862.png)

#### 1.5.2、嵌套路由

实际生活中的应用界面，通常由多层嵌套的组件组合而成。同样地，URL 中各段动态路径也按某种结构对应嵌套的各层组件，例如：

![image-20221209152219259](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209152219259.png)

在views目录创建Main.vue作为嵌套路由的主路由，并且需要添加router-view标签

```vue
<template>
    <div>
        <h1>我是Main</h1>
        <!-- 路由匹配到的组件将渲染在这里 -->
        <router-view></router-view>
    </div>
</template>

<script>
export default {
    data(){
        return {}
    }
}
</script>

<style>

</style>
```

在index.js中注册Main.vue组件，并将Home组件以及User组件作为子路嵌入到Main的路由中

```js
import Vue from 'vue'
import VueRouter from 'vue-router';
import Home from '../views/Home.vue';
import User from '../views/User.vue';
import Main from '../views/Main.vue';

Vue.use(VueRouter);

//1.创建路由组件

//2.将路由与组件进行映射
const routes = [
    //主路由
    {
        path:'/',
        component: Main,
        children: [
            //子路由
            {path:'/home',component: Home},
            {path:'/user',component: User}
        ]
    },
    // {path:'/home',component: Home},
    // {path:'/user',component: User}
]

//3.创建router实例
const router = new VueRouter({
    routes
})

// 4. 创建和挂载根实例。
// 记得要通过 router 配置参数注入路由，
// 从而让整个应用都有路由功能
export default router
```

![image-20221209153906687](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209153906687.png)

## 2、整体框架布局

[container的容器](https://element.eleme.cn/#/zh-CN/component/container#footer-attributes)

使用Element中的Container布局容器，方便快速搭建页面的基本结构：

`<el-container>`：外层容器。当子元素中包含 `<el-header>` 或 `<el-footer>` 时，全部子元素会垂直上下排列，否则会水平左右排列。

`<el-header>`：顶栏容器。

`<el-aside>`：侧边栏容器。

`<el-main>`：主要区域容器。

`<el-footer>`：底栏容器。

> 以上组件采用了 flex 布局，使用前请确定目标浏览器是否兼容。此外，`<el-container>` 的子元素只能是后四者，后四者的父元素也只能是 `<el-container>`

选用如下布局方式：

![image-20221209154558558](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209154558558.png)

```html
<el-container>
  <el-aside width="200px">Aside</el-aside>
  <el-container>
    <el-header>Header</el-header>
    <el-main>Main</el-main>
  </el-container>
</el-container>
```

将上述代码放在Main.vue中，删除无关代码，以及将子路由组件内容放在\<el-main>标签中

```vue
<template>
    <div>
        <el-container>
            <el-aside width="200px">Aside</el-aside>
            <el-container>
                <el-header>Header</el-header>
                <el-main>
                    <!-- 路由匹配到的组件将渲染在这里 -->
                    <router-view></router-view>
                </el-main>
            </el-container>
        </el-container>
    </div>
</template>

<script>
export default {
    data(){
        return {}
    }
}
</script>

<style>

</style>
```

![image-20221209154745384](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209154745384.png)

## 3、侧边栏的实现

### 3.1、选用合适的侧边栏布局

[menu的样式](https://element.eleme.cn/#/zh-CN/component/menu#menu-group-attribute)

尽管可以直接将代码赋值粘贴在Main.vue中，但考虑到侧边栏可以单独作为一个功能专一组件使用，可在components文件夹中创建CommonAside.vue组件

```vue
<template>
    <el-menu default-active="1-4-1" class="el-menu-vertical-demo" @open="handleOpen" @close="handleClose" :collapse="isCollapse">
    <el-submenu index="1">
        <template slot="title">
        <i class="el-icon-location"></i>
        <span slot="title">导航一</span>
        </template>
        <el-menu-item-group>
        <span slot="title">分组一</span>
        <el-menu-item index="1-1">选项1</el-menu-item>
        <el-menu-item index="1-2">选项2</el-menu-item>
        </el-menu-item-group>
        <el-menu-item-group title="分组2">
        <el-menu-item index="1-3">选项3</el-menu-item>
        </el-menu-item-group>
        <el-submenu index="1-4">
        <span slot="title">选项4</span>
        <el-menu-item index="1-4-1">选项1</el-menu-item>
        </el-submenu>
    </el-submenu>
    <el-menu-item index="2">
        <i class="el-icon-menu"></i>
        <span slot="title">导航二</span>
    </el-menu-item>
    <el-menu-item index="3" disabled>
        <i class="el-icon-document"></i>
        <span slot="title">导航三</span>
    </el-menu-item>
    <el-menu-item index="4">
        <i class="el-icon-setting"></i>
        <span slot="title">导航四</span>
    </el-menu-item>
    </el-menu>
</template>

<style>
  .el-menu-vertical-demo:not(.el-menu--collapse) {
    width: 200px;
    min-height: 400px;
  }
</style>

<script>
  export default {
    data() {
      return {
        isCollapse: true
      };
    },
    methods: {
      handleOpen(key, keyPath) {
        console.log(key, keyPath);
      },
      handleClose(key, keyPath) {
        console.log(key, keyPath);
      }
    }
  }
</script>
```

然后在Main.js中引入CommonAside组件，注意在标签中的命名方式

```vue
<template>
    <div>
        <el-container>
            <el-aside width="200px">
                <common-aside />
            </el-aside>
            <el-container>
                <el-header>Header</el-header>
                <el-main>
                    <!-- 路由匹配到的组件将渲染在这里 -->
                    <router-view></router-view>
                </el-main>
            </el-container>
        </el-container>
    </div>
</template>

<script>
import CommonAside from "../components/CommonAside.vue"

export default {
    data(){
        return {}
    },
    components:{
        CommonAside
    }
}
</script>

<style>

</style>
```

![image-20221209160234208](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209160234208.png)

可以查看官方文档中内容，修改对应的属性，例如将左侧导航展开，需要在CommonAside.vue中data()将isCollapse: true修改为isCollapse: false

![image-20221209160704109](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209160704109.png)

根据需要修改删除侧边栏中的内容，例如删除后只有一个“选项1”，之后可以通过循环的方式增加

![image-20221209161130005](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209161130005.png)

![image-20221209161148786](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209161148786.png)

### 3.2、填充数据，并使用v-for进行循环

- 在数据data()中的menuData，可根据是否有子菜单分为两类，使用计算属性中的filter过滤筛选
- 在使用v-for的时候，需要指定key（唯一且固定），用来表示当前元素的唯一性
- index作为唯一标志，用来确定点击的具体是哪一项
- 在elementUI中图标可以采用动态拼接的方式来指定

```vue
<template>
    <el-menu default-active="1-4-1" class="el-menu-vertical-demo" @open="handleOpen" @close="handleClose" :collapse="isCollapse">
    <el-menu-item v-for="item in noChildren" :key="item.name" :index="item.name">
        <!-- <i class="el-icon-menu"></i> -->
        <i :class="`el-icon-${item.icon}`"></i>
        <span slot="title">{{item.label}}</span>
    </el-menu-item>
    <el-submenu v-for="item in hasChildren" :key="item.label" :index="item.label">
        <template slot="title">
            <i :class="`el-icon-${item.icon}`"></i>
            <span slot="title">{{item.label}}</span>
        </template>
        <el-menu-item-group v-for="subItem in item.children" :key="subItem.name">
            <el-menu-item index="subItem.name">{{subItem.label}}</el-menu-item>
        </el-menu-item-group>
    </el-submenu>
   
    </el-menu>
</template>

<style>
  .el-menu-vertical-demo:not(.el-menu--collapse) {
    width: 200px;
    min-height: 400px;
  }
</style>

<script>
  export default {
    data() {
      return {
        isCollapse: false,
        menuData:[
            {
                path: '/',
                name: 'home',
                label: '首页',
                icon: 's-home',
                url: 'Home/Home'
            },
            {
                path: '/mall',
                name: 'mall',
                label: '商品管理',
                icon: 'video-play',
                url: 'MallManage/MallManage'
            },
            {
                path: '/user',
                name: 'user',
                label: '用户管理',
                icon: 'user',
                url: 'UserManage/UserManage'
            },
            {
                label: '其他',
                icon: 'location',
                children: [
                    {
                        path: '/page1',
                        name: 'page1',
                        label: '页面1',
                        icon: 'setting',
                        url: 'Other/PageOne'
                    },
                    {
                        path: '/page2',
                        name: 'page2',
                        label: '页面2',
                        icon: 'setting',
                        url: 'Other/PageTwo'
                    }
                ]
            }
        ]
      };
    },
    methods: {
      handleOpen(key, keyPath) {
        console.log(key, keyPath);
      },
      handleClose(key, keyPath) {
        console.log(key, keyPath);
      }
    },
    computed:{
        //对数据进行过滤，分成两组，一组有子菜单，一组没有子菜单
        //没有子菜单
        noChildren(){
            //使用filter进行过滤，filter的参数是一个函数，根据这个函数是true或者false进行判断
            return this.menuData.filter(item => !item.children)
        },
        //有子菜单
        hasChildren(){
            //使用filter进行过滤，filter的参数是一个函数，根据这个函数是true或者false进行判断
            return this.menuData.filter(item => item.children)
        }
    }
  }
</script>
```

![image-20221209164811548](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209164811548.png)

### 3.3、修改样式

可以在elementUI官网中找到修改字体的命令，例如：背景颜色、字体颜色、选中后字体颜色

```vue
background-color="#545c64"
text-color="#fff"
active-text-color="#ffd04b"
```

引入[Less](https://less.bootcss.com/)，进行更加便捷的修改css样式

```bash
yarn add less@4.1.2 less-loader@6.0.0
```

然后修改style中的内容，首先添加lang="less"，然后指定scoped（只作用于当前页面）

```css
<style lang="less" scoped>
.el-menu-vertical-demo:not(.el-menu--collapse) {
  width: 200px;
  min-height: 400px;
}
.el-menu{
    height:100vh;
    h3{
        color:#fff;
        text-align: center;
        line-height:48px;
        font-size:16px;
        font-weight: 400;
    }
}
</style>
```

为了去掉边框，需要在App.vue中修改样式

```css
<style lang="less">
  html, body, h3 {
    margin: 0;
    padding: 0;
  }
</style>
```

![image-20221209171223541](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209171223541.png)

### 3.4、菜单点击跳转

#### 3.4.1、建立对应组件并设置路由

![image-20221209172939293](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209172939293.png)

#### 3.4.2、在CommonAside.vue中添加方法

在methods中添加clickMenu(item){}方法，并将其绑定在相应的循环标签中

```vue
methods: {
    handleOpen(key, keyPath) {
      console.log(key, keyPath);
    },
    handleClose(key, keyPath) {
      console.log(key, keyPath);
    },
    //点击菜单
    clickMenu(item){
      // console.log(item)
      //当页面的路由与跳转的路由不一致时才能跳转
      if(this.$route.path !== item.path && !(this.$route.path === '/home' && (item.path === '/'))){
        this.$router.push(item.path);
      }  
    }
},
```

![image-20221209173431542](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209173431542.png)

### 3.5、CommonAside.vue完整版

```vue
<template>
  <el-menu
    default-active="1-4-1"
    class="el-menu-vertical-demo"
    @open="handleOpen"
    @close="handleClose"
    :collapse="isCollapse"
    background-color="#545c64"
    text-color="#fff"
    active-text-color="#ffd04b"
    >
    <h3>通用后台管理系统</h3>
    <el-menu-item
      @click="clickMenu(item)"
      v-for="item in noChildren"
      :key="item.name"
      :index="item.name"
    >
      <!-- <i class="el-icon-menu"></i> -->
      <i :class="`el-icon-${item.icon}`"></i>
      <span slot="title">{{ item.label }}</span>
    </el-menu-item>

    <el-submenu
      v-for="item in hasChildren"
      :key="item.label"
      :index="item.label"
    >
      <template slot="title">
        <i :class="`el-icon-${item.icon}`"></i>
        <span slot="title">{{ item.label }}</span>
      </template>
      <el-menu-item-group v-for="subItem in item.children" :key="subItem.name">
        <el-menu-item @click="clickMenu(subItem)" index="subItem.name">{{ subItem.label }}</el-menu-item>
      </el-menu-item-group>
    </el-submenu>
  </el-menu>
</template>

<style lang="less" scoped>
.el-menu-vertical-demo:not(.el-menu--collapse) {
  width: 200px;
  min-height: 400px;
}
.el-menu{
    height:100vh;
    h3{
        color:#fff;
        text-align: center;
        line-height:48px;
        font-size:16px;
        font-weight: 400;
    }
}
</style>

<script>
export default {
  data() {
    return {
      isCollapse: false,
      menuData: [
        {
          path: "/",
          name: "home",
          label: "首页",
          icon: "s-home",
          url: "Home/Home",
        },
        {
          path: "/mall",
          name: "mall",
          label: "商品管理",
          icon: "video-play",
          url: "MallManage/MallManage",
        },
        {
          path: "/user",
          name: "user",
          label: "用户管理",
          icon: "user",
          url: "UserManage/UserManage",
        },
        {
          label: "其他",
          icon: "location",
          children: [
            {
              path: "/page1",
              name: "page1",
              label: "页面1",
              icon: "setting",
              url: "Other/PageOne",
            },
            {
              path: "/page2",
              name: "page2",
              label: "页面2",
              icon: "setting",
              url: "Other/PageTwo",
            },
          ],
        },
      ],
    };
  },
  methods: {
    handleOpen(key, keyPath) {
      console.log(key, keyPath);
    },
    handleClose(key, keyPath) {
      console.log(key, keyPath);
    },
    //点击菜单
    clickMenu(item){
      // console.log(item)
      //当页面的路由与跳转的路由不一致时才能跳转
      if(this.$route.path !== item.path && !(this.$route.path === '/home' && (item.path === '/'))){
        this.$router.push(item.path);
      }  
    }
  },
  computed: {
    //对数据进行过滤，分成两组，一组有子菜单，一组没有子菜单
    //没有子菜单
    noChildren() {
      //使用filter进行过滤，filter的参数是一个函数，根据这个函数是true或者false进行判断
      return this.menuData.filter((item) => !item.children);
    },
    //有子菜单
    hasChildren() {
      //使用filter进行过滤，filter的参数是一个函数，根据这个函数是true或者false进行判断
      return this.menuData.filter((item) => item.children);
    },
  },
};
</script>
```

## 4、header组件实现

### 4.1、框架搭建

对于header而言，也是一个单一组件，故可以在components文件夹下制作CommonHeader.vue组件。

对于该导航条而言，可以分成左右两个div，在左侧的div中存放“按钮”以及“面包屑区”，按钮用来控制侧边栏是否展开，右侧则是一个图标展示的下拉菜单，用来退出等操作。

针对“按钮”、“面包屑区”、“下拉菜单”都可以从elementUI中获取，初步CommonHeader.vue代码如下所示：

```vue
<template>
  <div class="header-container">
    <div class="l-content">
        <el-button icon="el-icon-menu" size="mini" ></el-button>
        <!-- 面包屑区 -->
        <span class="text">首页</span>
    </div>
    <div class="r-content">
        <el-dropdown>
            <span class="el-dropdown-link">
                <img class="user" src="../assets/images/user.png" alt="">
            </span>
            <el-dropdown-menu slot="dropdown">
                <el-dropdown-item>黄金糕</el-dropdown-item>
                <el-dropdown-item>狮子头</el-dropdown-item>
                <el-dropdown-item>螺蛳粉</el-dropdown-item>
                <el-dropdown-item disabled>双皮奶</el-dropdown-item>
                <el-dropdown-item divided>蚵仔煎</el-dropdown-item>
            </el-dropdown-menu>
         </el-dropdown>
    </div>
  </div>
</template>

<script>
export default {

}
</script>

<style lang="less" scoped>
.header-container{
    padding: 0 20px;
    background-color:#333;
    height:60px;
    display:flex;
    justify-content: space-between;
    align-items: center;
    .text{
        color: #fff;
        font-size: 14px;
        margin-left: 10px;
    };
    .r-content{
        .user{
            widows: 40px;
            height: 40px;
            border-radius: 50%;
        }
    }
}
</style>
```

![image-20221209214624709](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221209214624709.png)

### 4.2、vuex组件通信（按钮功能）

vuex实现左侧任务栏折叠

Vuex 是一个专为 Vue.js 应用程序开发的**状态管理模式 + 库**。它采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。

安装：

```bash
yarn add vuex@3.6.2
```

#### 4.2.1、构建所需index.js文件

在src目录下创建store文件夹，以及index.js文件，用来进行不同组件之间的数据传递

index.js可以包含多个控制文件，例如包含tab.js

```js
import Vue from 'vue'
import Vuex from 'vuex'
import tab from './tab'

Vue.use(Vuex)

//创建vuex的实例
export default new Vuex.Store({
    modules:{
        tab
    }
})
```

tab.js：

```js
//管理菜单侧边栏中的数据
export default {
    //定义属性数据
    state:{
        isCollapse:false    //用于控制菜单的展开与收起的属性
    },
    //定义修改方法
    mutations: {
        //修改菜单展开与收起的方法
        collapseMenu(state){
            state.isCollapse = !state.isCollapse
        }
    }
}
```

将store挂载到mian.js中，main.js的代码如下所示：

```js
import Vue from 'vue'
import App from './App.vue'
import ElementUI from 'element-ui';
// import {Row,Button} from 'element-ui'
import 'element-ui/lib/theme-chalk/index.css';

import router from './router'

import store from './store'

Vue.config.productionTip = false

Vue.use(ElementUI);
// Vue.use(Row)
// Vue.use(Button)

new Vue({
  router,
  store,
  render: h => h(App),
}).$mount('#app')

```

#### 4.2.2、增加触发方法

在CommonHeader.vue组件的对应按钮标签中，绑定触发方法“handleMenu”

```html
<el-button @click="handleMenu" icon="el-icon-menu" size="mini" ></el-button>
```

然后在script文件中，编写“handleMenu”的具体方法，用来触发调用store中的方法

```vue
<script>
export default {
    data(){
        return {}
    },
    methods:{
        handleMenu(){
            this.$store.commit('collapseMenu')
        }
    }
}
</script>
```

![image-20221210000607045](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210000607045.png)

#### 4.2.3、获取修改响应

在CommonAside.vue中的computed创建计算属性isCollapse()，并将data()中的isCollapse删除

isCollapse()会读取store中的数据内容

```js
computed: {
    //对数据进行过滤，分成两组，一组有子菜单，一组没有子菜单
    //没有子菜单
    noChildren() {
      //使用filter进行过滤，filter的参数是一个函数，根据这个函数是true或者false进行判断
      return this.menuData.filter((item) => !item.children);
    },
    //有子菜单
    hasChildren() {
      //使用filter进行过滤，filter的参数是一个函数，根据这个函数是true或者false进行判断
      return this.menuData.filter((item) => item.children);
    },
    isCollapse() {
      return this.$store.state.tab.isCollapse
    }
},
```

此时便完成了一个简单的组件通信，如下图所示，但仍存在一些bug

![image-20221210001111632](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210001111632.png)

#### 4.2.4、细节bug修正

为解决上述问题，需要针对名字以及关键字进行三元判断：

```html
<h3>{{isCollapse ? '后台' : '通用后台管理系统'}}</h3>
```

并将右侧的白色边框取消：border-right:none;

```css
.el-menu{
    height:100vh;
    h3{
        color:#fff;
        text-align: center;
        line-height:48px;
        font-size:16px;
        font-weight: 400;
    };
    border-right:none;
}
```

然后需要将侧边栏的宽度设为auto，该步骤要在Main.vue中修改

```vue
			<el-aside width="auto">
                <common-aside />
            </el-aside>
```

#### 4.2.5、侧边栏代码汇总

CommonAside.vue：

```vue
<template>
  <el-menu
    default-active="1-4-1"
    class="el-menu-vertical-demo"
    @open="handleOpen"
    @close="handleClose"
    :collapse="isCollapse"
    background-color="#545c64"
    text-color="#fff"
    active-text-color="#ffd04b"
    >
    <h3>{{isCollapse ? '后台' : '通用后台管理系统'}}</h3>
    <el-menu-item
      @click="clickMenu(item)"
      v-for="item in noChildren"
      :key="item.name"
      :index="item.name"
    >
      <!-- <i class="el-icon-menu"></i> -->
      <i :class="`el-icon-${item.icon}`"></i>
      <span slot="title">{{ item.label }}</span>
    </el-menu-item>

    <el-submenu
      v-for="item in hasChildren"
      :key="item.label"
      :index="item.label"
    >
      <template slot="title">
        <i :class="`el-icon-${item.icon}`"></i>
        <span slot="title">{{ item.label }}</span>
      </template>
      <el-menu-item-group v-for="subItem in item.children" :key="subItem.name">
        <el-menu-item @click="clickMenu(subItem)" index="subItem.name">{{ subItem.label }}</el-menu-item>
      </el-menu-item-group>
    </el-submenu>
  </el-menu>
</template>

<style lang="less" scoped>
.el-menu-vertical-demo:not(.el-menu--collapse) {
  width: 200px;
  min-height: 400px;
}
.el-menu{
    height:100vh;
    h3{
        color:#fff;
        text-align: center;
        line-height:48px;
        font-size:16px;
        font-weight: 400;
    };
    border-right:none;
}
</style>

<script>
export default {
  data() {
    return {
      menuData: [
        {
          path: "/",
          name: "home",
          label: "首页",
          icon: "s-home",
          url: "Home/Home",
        },
        {
          path: "/mall",
          name: "mall",
          label: "商品管理",
          icon: "video-play",
          url: "MallManage/MallManage",
        },
        {
          path: "/user",
          name: "user",
          label: "用户管理",
          icon: "user",
          url: "UserManage/UserManage",
        },
        {
          label: "其他",
          icon: "location",
          children: [
            {
              path: "/page1",
              name: "page1",
              label: "页面1",
              icon: "setting",
              url: "Other/PageOne",
            },
            {
              path: "/page2",
              name: "page2",
              label: "页面2",
              icon: "setting",
              url: "Other/PageTwo",
            },
          ],
        },
      ],
    };
  },
  methods: {
    handleOpen(key, keyPath) {
      console.log(key, keyPath);
    },
    handleClose(key, keyPath) {
      console.log(key, keyPath);
    },
    //点击菜单
    clickMenu(item){
      // console.log(item)
      //当页面的路由与跳转的路由不一致时才能跳转
      if(this.$route.path !== item.path && !(this.$route.path === '/home' && (item.path === '/'))){
        this.$router.push(item.path);
      }  
    }
  },
  computed: {
    //对数据进行过滤，分成两组，一组有子菜单，一组没有子菜单
    //没有子菜单
    noChildren() {
      //使用filter进行过滤，filter的参数是一个函数，根据这个函数是true或者false进行判断
      return this.menuData.filter((item) => !item.children);
    },
    //有子菜单
    hasChildren() {
      //使用filter进行过滤，filter的参数是一个函数，根据这个函数是true或者false进行判断
      return this.menuData.filter((item) => item.children);
    },
    isCollapse() {
      return this.$store.state.tab.isCollapse
    }
  },
};
</script>
```

## 5、home组件实现

### 5.1、Layout栅格布局

使用element中的Layout布局，将Home组件分为左右两部分

Home.vue：

```vue
<template>
  <el-row>
    <el-col :span="8"><div class="grid-content bg-purple"></div></el-col>
    <el-col :span="16"><div class="grid-content bg-purple-light"></div></el-col>
  </el-row>
</template>

<script>
export default {
    data(){
        return {}
    }
}
</script>

<style>

</style>
```

### 5.2、Card卡片组件

Home.vue

```vue
<template>
  <el-row>
    <el-col :span="8">
      <el-card class="box-card">
        <div class="user">
          <img src="../assets/images/user.png" alt="" >
          <div class="userInfo">
            <p class="name">Admin</p>
            <p class="access">超级管理员</p>
          </div>
        </div>
        <div class="login-info">
          <p>上次登录时间：<span>2021-7-19</span></p>
          <p>上次登录地点：<span>武汉</span></p>
        </div>
      </el-card>
    </el-col>
    <el-col :span="16"><div class="grid-content bg-purple-light"></div></el-col>
  </el-row>
</template>

<script>
export default {
    data(){
        return {}
    }
}
</script>

<style lang="less" scoped>
.user{
  display: flex;
  align-items: center;
  padding-bottom: 20px;
  margin-bottom: 20px;
  border-bottom: 1px solid #ccc;
  img{
    margin-right: 40px;
    width:150px;
    height:150px;
    border-radius:50%;
  };
  .userInfo{
    .name{
      font-size:32px;
      margin-bottom: 10px;
    }
    .access{
      color: #999999;
    }
  }
}
.login-info {
    p {
        line-height: 28px;
        font-size: 14px;
        color: #999999;
        span {
            color: #666666;
            margin-left: 60px;
        }
    }
}
</style>
```

![image-20221210100621182](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210100621182.png)

### 5.3、Table表格组件

使用table组件展示相应数据

home.vue：

```vue
<template>
  <el-row>
    <el-col :span="8">
      <el-card class="box-card">
        <div class="user">
          <img src="../assets/images/user.png" alt="" >
          <div class="userInfo">
            <p class="name">Admin</p>
            <p class="access">超级管理员</p>
          </div>
        </div>
        <div class="login-info">
          <p>上次登录时间：<span>2021-7-19</span></p>
          <p>上次登录地点：<span>武汉</span></p>
        </div>
      </el-card>
      <el-card style="margin-top:20px;height:460px;">
        <el-table :data="tableData" style="width: 100%">
          <el-table-column prop="name" label="手机品牌">
          </el-table-column>
          <el-table-column prop="todayBuy" label="今日购买">
          </el-table-column>
          <el-table-column prop="monthBuy" label="本月购买">
          </el-table-column>
          <el-table-column prop="totalBuy" label="总购买">
          </el-table-column>
        </el-table>
      </el-card>
    </el-col>
    <el-col :span="16"><div class="grid-content bg-purple-light"></div></el-col>
  </el-row>
</template>

<script>
export default {
    data(){
        return {
          tableData: [
            {
              name: 'oppo',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: 'vivo',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '苹果',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '小米',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '三星',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '魅族',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            }
          ]
        }
    }
}
</script>

<style lang="less" scoped>
.user{
  display: flex;
  align-items: center;
  padding-bottom: 20px;
  margin-bottom: 20px;
  border-bottom: 1px solid #ccc;
  img{
    margin-right: 40px;
    width:150px;
    height:150px;
    border-radius:50%;
  };
  .userInfo{
    .name{
      font-size:32px;
      margin-bottom: 10px;
    }
    .access{
      color: #999999;
    }
  }
}
.login-info {
    p {
        line-height: 28px;
        font-size: 14px;
        color: #999999;
        span {
            color: #666666;
            margin-left: 60px;
        }
    }
}

</style>
```

![image-20221210101919459](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210101919459.png)

在data()中增加tableLabel，使用v-for循环生成对应的列

```vue
<template>
  <el-row>
    <el-col :span="8">
      <el-card class="box-card">
        <div class="user">
          <img src="../assets/images/user.png" alt="" >
          <div class="userInfo">
            <p class="name">Admin</p>
            <p class="access">超级管理员</p>
          </div>
        </div>
        <div class="login-info">
          <p>上次登录时间：<span>2021-7-19</span></p>
          <p>上次登录地点：<span>武汉</span></p>
        </div>
      </el-card>
      <el-card style="margin-top:20px;height:460px;">
        <el-table :data="tableData" style="width: 100%">
          <el-table-column v-for="(val,key) in tableLabel" :key="key" :prop="key" :label="val" />
          <!-- <el-table-column prop="name" label="手机品牌">
          </el-table-column>
          <el-table-column prop="todayBuy" label="今日购买">
          </el-table-column>
          <el-table-column prop="monthBuy" label="本月购买">
          </el-table-column>
          <el-table-column prop="totalBuy" label="总购买">
          </el-table-column> -->
        </el-table>
      </el-card>
    </el-col>
    <el-col :span="16"><div class="grid-content bg-purple-light"></div></el-col>
  </el-row>
</template>

<script>
export default {
    data(){
        return {
          tableLabel:{
            name:'手机品牌',
            todayBuy:'今日购买',
            monthBuy:'本月购买',
            totalBuy:'总购买'
          },
          tableData: [
            {
              name: 'oppo',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: 'vivo',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '苹果',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '小米',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '三星',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '魅族',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            }
          ]
        }
    }
}
</script>

<style lang="less" scoped>
.user{
  display: flex;
  align-items: center;
  padding-bottom: 20px;
  margin-bottom: 20px;
  border-bottom: 1px solid #ccc;
  img{
    margin-right: 40px;
    width:150px;
    height:150px;
    border-radius:50%;
  };
  .userInfo{
    .name{
      font-size:32px;
      margin-bottom: 10px;
    }
    .access{
      color: #999999;
    }
  }
}
.login-info {
    p {
        line-height: 28px;
        font-size: 14px;
        color: #999999;
        span {
            color: #666666;
            margin-left: 60px;
        }
    }
}
</style>
```

### 5.4、flex布局

充分利用flex布局来完成右上方的订单展示

```vue
<template>
  <el-row>
    <el-col :span="8">
      <el-card class="box-card">
        <div class="user">
          <img src="../assets/images/user.png" alt="" >
          <div class="userInfo">
            <p class="name">Admin</p>
            <p class="access">超级管理员</p>
          </div>
        </div>
        <div class="login-info">
          <p>上次登录时间：<span>2021-7-19</span></p>
          <p>上次登录地点：<span>武汉</span></p>
        </div>
      </el-card>
      <el-card style="margin-top:20px;height:460px;">
        <el-table :data="tableData" style="width: 100%">
          <el-table-column v-for="(val,key) in tableLabel" :key="key" :prop="key" :label="val" />
          <!-- <el-table-column prop="name" label="手机品牌">
          </el-table-column>
          <el-table-column prop="todayBuy" label="今日购买">
          </el-table-column>
          <el-table-column prop="monthBuy" label="本月购买">
          </el-table-column>
          <el-table-column prop="totalBuy" label="总购买">
          </el-table-column> -->
        </el-table>
      </el-card>
    </el-col>
    <el-col :span="16">
      <div class="num">
        <el-card v-for="item in countData" :key="item.name" :body-style="{ display: 'flex', padding: 0 }">
            <i class="icon" :class="`el-icon-${item.icon}`" :style="{ background: item.color }"></i>
            <div class="detail">
              <p class="price">￥{{ item.value }}</p>
              <p class="desc">{{ item.name }}</p>
            </div>
        </el-card>
      </div>
    </el-col>
  </el-row>
</template>

<script>
export default {
    data(){
        return {
          tableLabel:{
            name:'手机品牌',
            todayBuy:'今日购买',
            monthBuy:'本月购买',
            totalBuy:'总购买'
          },
          tableData: [
            {
              name: 'oppo',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: 'vivo',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '苹果',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '小米',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '三星',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            },
            {
              name: '魅族',
              todayBuy: 100,
              monthBuy: 300,
              totalBuy: 800
            }
          ],
          countData: [
            {
              name: "今日支付订单",
              value: 1234,
              icon: "success",
              color: "#2ec7c9",
            },
            {
              name: "今日收藏订单",
              value: 210,
              icon: "star-on",
              color: "#ffb980",
            },
            {
              name: "今日未支付订单",
              value: 1234,
              icon: "s-goods",
              color: "#5ab1ef",
            },
            {
              name: "本月支付订单",
              value: 1234,
              icon: "success",
              color: "#2ec7c9",
            },
            {
              name: "本月收藏订单",
              value: 210,
              icon: "star-on",
              color: "#ffb980",
            },
            {
              name: "本月未支付订单",
              value: 1234,
              icon: "s-goods",
              color: "#5ab1ef",
            },
          ],
        }
    }
}
</script>

<style lang="less" scoped>
.user{
  display: flex;
  align-items: center;
  padding-bottom: 20px;
  margin-bottom: 20px;
  border-bottom: 1px solid #ccc;
  img{
    margin-right: 40px;
    width:150px;
    height:150px;
    border-radius:50%;
  };
  .userInfo{
    .name{
      font-size:32px;
      margin-bottom: 10px;
    }
    .access{
      color: #999999;
    }
  }
}
.login-info {
    p {
        line-height: 28px;
        font-size: 14px;
        color: #999999;
        span {
            color: #666666;
            margin-left: 60px;
        }
    }
}
.num {
    display: flex;
    flex-wrap: wrap; //强制换行
    justify-content: space-between; //让元素贴边
    .el-card {
        width: 32%;
        margin-bottom: 20px;
    }
    .icon {
        width: 80px;
        height: 80px;
        font-size: 30px;
        text-align: center;
        line-height: 80px;
        color: #fff;
    }
    .detail {
        margin-left: 15px;
        display: flex;
        flex-direction: column;     //主轴方向
        justify-content: center;
        .price {
            font-size: 30px;
            margin-bottom: 10px;
            line-height: 30px;
            height: 30px;
        }
        .desc {
            font-size: 14px;
            color: #999;
            text-align: center;
        }
    }
}
</style>
```

![image-20221210105032519](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210105032519.png)

## 6、Axios请求数据

[Axios](https://www.axios-http.cn/docs/intro) 是一个基于 *[promise](https://javascript.info/promise-basics)* 网络请求库，作用于[`node.js`](https://nodejs.org/) 和浏览器中。 它是 *[isomorphic](https://www.lullabot.com/articles/what-is-an-isomorphic-application)* 的(即同一套代码可以运行在浏览器和node.js中)。在服务端它使用原生 node.js `http` 模块, 而在客户端 (浏览端) 则XMLHttpRequests。

安装axios：

```bash
yarn add axios@0.27.2
```

可以把axios的封装看作一个工具方法，所以可以在src目录下新建一个utils文件夹，然后在其中新建requests.js

utils/requests.js

```JS
import axios from 'axios'

const http = axios.create({
    //通用请求的地址前缀，可以替换为后端的地址
    baseURL:'/api',

    //超时时间，单位是毫秒
    timeout: 10000,
})

// 添加请求拦截器
http.interceptors.request.use(function (config) {
    // 在发送请求之前做些什么
    return config;
  }, function (error) {
    // 对请求错误做些什么
    return Promise.reject(error);
  });

// 添加响应拦截器
http.interceptors.response.use(function (response) {
    // 2xx 范围内的状态码都会触发该函数。
    // 对响应数据做点什么
    return response;
  }, function (error) {
    // 超出 2xx 范围的状态码都会触发该函数。
    // 对响应错误做点什么
    return Promise.reject(error);
  });

export default http
```

一般来说，项目中的接口也需要统一位置进行存放，故在src目录下新建一个api文件夹，然后建立index.js文件，用来调用utils下requests.js文件中二次封装的axios

api/index.js：

```js
import http from '../utils/requests'

//请求首页数据的接口
export const getData = () => {
    //返回一个promise对象
    return http.get('/home/getData')
}
```

之后为在Home.vue组件中获取后端数据，首先要导入api/index中的相应方法，然后使用mounted钩子函数获取数据

Home.vue：

```js
<script>
import {getData} from '../api'  //将方法解构出来

export default {
	mounted(){  //vue中的一个钩子函数,一般在初始化页面完成后,再对dom节点进行相关操作。
      getData().then((data)=>{
        console.log(data)
      })
    }
}
</script>
```

## 7、mock模拟后端数据

[Mock.js ](http://mockjs.com/)

Mork.mork(rurl?,rtype?,template|function(options))

其中：

rurl为绝对地址也可以是正则表达式匹配的路径

rtype表示请求类型，是get还是post，或者是其他

template|function(options)表示处理函数或者mock模板

下载安装：

```bash
yarn add mockjs@1.1.0
```

在api文件夹下新建mock.js文件，针对需要拦截的路径进行处理

api/mock.js：

```js
import Mock from 'mockjs'

//定义mock的请求拦截
Mock.mock('/api/home/getData','get',function(){
    //拦截到请求后的处理逻辑
    console.log('拦截到了');
})
```

然后在main.js中引入

```js
import './api/mock'
```

重新启动项目，在控制台中就可以看到，成功拦截

如果Mock.mock()方法中有return返回值，则下方的data中将会有所体现

![image-20221210114356339](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210114356339.png)

可以针对mock进一步封装

在api文件夹下新建mockServeData文件夹，然后新建home.js以及permission.js，用来存放首页数据以及用户数据

在home.js中暴露出getStatisticalData()函数给mock.js使用

api/mock.js：

```js
import Mock from 'mockjs'
import homeApi from './mockServeData/home'

//定义mock的请求拦截
// Mock.mock('/api/home/getData','get',function(){
     // console.log('拦截到了');
// })
Mock.mock('/api/home/getData','get',homeApi.getStatisticalData)
```

api/mockServeData/home.js：

```js
// mock数据模拟
import Mock from 'mockjs'

// 图表数据
let List = []
export default {
  getStatisticalData: () => {
    //Mock.Random.float 产生随机数100到8000之间 保留小数 最小0位 最大0位
    for (let i = 0; i < 7; i++) {
      List.push(
        Mock.mock({
          苹果: Mock.Random.float(100, 8000, 0, 0),
          vivo: Mock.Random.float(100, 8000, 0, 0),
          oppo: Mock.Random.float(100, 8000, 0, 0),
          魅族: Mock.Random.float(100, 8000, 0, 0),
          三星: Mock.Random.float(100, 8000, 0, 0),
          小米: Mock.Random.float(100, 8000, 0, 0)
        })
      )
    }
    return {
      code: 20000,
      data: {
        // 饼图
        videoData: [
          {
            name: '小米',
            value: 2999
          },
          {
            name: '苹果',
            value: 5999
          },
          {
            name: 'vivo',
            value: 1500
          },
          {
            name: 'oppo',
            value: 1999
          },
          {
            name: '魅族',
            value: 2200
          },
          {
            name: '三星',
            value: 4500
          }
        ],
        // 柱状图
        userData: [
          {
            date: '周一',
            new: 5,
            active: 200
          },
          {
            date: '周二',
            new: 10,
            active: 500
          },
          {
            date: '周三',
            new: 12,
            active: 550
          },
          {
            date: '周四',
            new: 60,
            active: 800
          },
          {
            date: '周五',
            new: 65,
            active: 550
          },
          {
            date: '周六',
            new: 53,
            active: 770
          },
          {
            date: '周日',
            new: 33,
            active: 170
          }
        ],
        // 折线图
        orderData: {
          date: ['20191001', '20191002', '20191003', '20191004', '20191005', '20191006', '20191007'],
          data: List
        },
        tableData: [
          {
            name: 'oppo',
            todayBuy: 500,
            monthBuy: 3500,
            totalBuy: 22000
          },
          {
            name: 'vivo',
            todayBuy: 300,
            monthBuy: 2200,
            totalBuy: 24000
          },
          {
            name: '苹果',
            todayBuy: 800,
            monthBuy: 4500,
            totalBuy: 65000
          },
          {
            name: '小米',
            todayBuy: 1200,
            monthBuy: 6500,
            totalBuy: 45000
          },
          {
            name: '三星',
            todayBuy: 300,
            monthBuy: 2000,
            totalBuy: 34000
          },
          {
            name: '魅族',
            todayBuy: 350,
            monthBuy: 3000,
            totalBuy: 22000
          }
        ]
      }
    }
  }
}
```

![image-20221210115425525](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210115425525.png)

将mock函数传递的promise对象解构获取相应数据，并将该数据绑定到对应的属性上，不再使用之前的“死数据”

```js
	mounted(){  //vue中的一个钩子函数,一般在初始化页面完成后,再对dom节点进行相关操作。
      // getData().then((data)=>{
      //   console.log(data)
      // })
      getData().then(({data})=>{
        const {tableData} = data.data   //解构赋值运用到函数参数，因为getData()传过来的是一个promise对象，而我们需要的是tableData这部分数据
        // console.log(tableData)
        this.tableData = tableData
      })
    }
```

![image-20221210145230341](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210145230341.png)

## 8、echarts基本使用

### 8.1、规划图表位置

首先针对之前的项目进行一定的完善，增加图表放置位置

在页面右下方增加下述内容，与“class="num"”同级；并在style中增加下述css代码样式

```html
<el-card style="height: 280px">
    <!-- 折线图 -->
</el-card>
<div class="graph">
	<el-card style="height: 260px">
    </el-card>
    <el-card style="height: 260px">
    </el-card>
</div>
```

```css
.graph {
    margin-top: 20px;
    display: flex;
    justify-content: space-between;
    .el-card {
        width: 48%;
    }
}
```

![image-20221210150400009](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210150400009.png)

### 8.2、echarts安装

[ECharts官方网站](https://echarts.apache.org/handbook/zh/get-started/)

```bash
yarn add echarts@5.1.2
```

安装完毕后在相应位置进行导入

```js
import * as echarts from 'echarts';
```

![image-20221210151303968](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210151303968.png)

### 8.3、echarts使用

#### 8.3.1、绘制折线图

首先需要指定对应的dom节点，并且给定高度，否则无法绘图

```html
	  <el-card style="height: 280px">
          <!-- 折线图 -->
          <div ref="echarts1" style="height: 280px"></div>
      </el-card>
```

在mounted()函数中，根据dom节点，初始化echarts实例，然后指定图表的配置项与数据，其中包括x轴、y轴、图例以及存放在series中的具体数据，最后使用刚指定的配置项和数据显示图表

```js
  mounted() {
    //vue中的一个钩子函数,一般在初始化页面完成后,再对dom节点进行相关操作。
    // getData().then((data)=>{
    //   console.log(data)
    // })
    getData().then(({ data }) => {
      const { tableData } = data.data; //解构赋值运用到函数参数，因为getData()传过来的是一个promise对象，而我们需要的是tableData这部分数据
      // console.log(tableData)
      this.tableData = tableData;

      //基于准备好的Dom节点，初始化echarts实例
      const echarts1 = echarts.init(this.$refs.echarts1)      //this.$refs.echarts1为获取的dom节点
      //指定图表的配置项和数据
      var echarts1Option = {};
      // 处理数据xAxis
      const { orderData, userData, videoData } = data.data;
      console.log(orderData)
      const xAxis = Object.keys(orderData.data[0]); //Object.keys返回对象的枚举
      const xAxisData = {
        data: xAxis,
      };
      echarts1Option.xAxis = xAxisData;
      echarts1Option.yAxis = {};
      echarts1Option.legend = xAxisData;
      echarts1Option.series = [];
      xAxis.forEach((key) => {
        echarts1Option.series.push({
          name: key,
          data: orderData.data.map((item) => item[key]),  //使用map生成数组
          type: "line",
        });
      });
      console.log(echarts1Option);
      // 使用刚指定的配置项和数据显示图表。
      echarts1.setOption(echarts1Option);
    });
  },
```

在下方图片中，可以看到orderData数据的存放层级

![image-20221210154400391](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210154400391.png)

#### 8.3.2、绘制柱状图

先指定绘图的dom节点以及图像的高度

```html
		<el-card style="height: 260px">
          <div ref="echarts2" style="height: 260px"></div>
        </el-card>
```

在mounted中设置相应的属性

```js
	  // 柱状图
      const echarts2 = echarts.init(this.$refs.echarts2);
      const eachrts2Option = {
        legend: {
          // 图例文字颜色
          textStyle: {
            color: "#333",
          },
        },
        grid: {
          left: "20%",
        },
        // 提示框
        tooltip: {
          trigger: "axis",
        },
        xAxis: {
          type: "category", // 类目轴
          data: userData.map((item) => item.date),
          axisLine: {
            lineStyle: {
              color: "#17b3a3",
            },
          },
          axisLabel: {
            interval: 0,
            color: "#333",
          },
        },
        yAxis: [
          {
            type: "value",
            axisLine: {
              lineStyle: {
                color: "#17b3a3",
              },
            },
          },
        ],
        color: ["#2ec7c9", "#b6a2de"],
        series: [
          {
            name: "新增用户",
            data: userData.map((item) => item.new),
            type: "bar",
          },
          {
            name: "活跃用户",
            data: userData.map((item) => item.active),
            type: "bar",
          },
        ],
      };
      echarts2.setOption(eachrts2Option);
```

#### 8.3.3、绘制饼状图

先指定绘图的dom节点以及图像的高度

```html
		<el-card style="height: 260px">
          <div ref="echarts3" style="height: 240px"></div>
        </el-card>
```

在mounted中设置相应的属性

```js
	  // 饼状图
      const echarts3 = echarts.init(this.$refs.echarts3);
      const eachrts3Option = {
        tooltip: {
          trigger: "item",
        },
        color: [
          "#0f78f4",
          "#dd536b",
          "#9462e5",
          "#a6a6a6",
          "#e1bb22",
          "#39c362",
          "#3ed1cf",
        ],
        series: [
          {
            data: videoData,
            type: "pie",
          },
        ],
      };
      echarts3.setOption(eachrts3Option);
```

## 9、面包屑导航实现

面包屑是在head部分组件里，Tag标签虽然不再head部分组件里，但是它在整个管理后台系统中是会一直存在的，所以需要在Main.vue中。

这两块功能的实现，主要依赖Element-ui两个样式 Breadcrumb 面包屑 + Tag 标签


整个大致逻辑是这样的，首先是面包屑中的“首页”一定要存在的，接下来“侧边组件”点击某菜单，把这个数据存到vuex中，然后“头部组件”来获取vuex中这个数据并展示。

### 9.1、面包屑功能

1. 默认有一个首页
2. 点击新的也页面时，header部分会增加
3. 点击已有的菜单时，已有的数据不会增加

### 9.2、使用面包屑组件

使用elementUI下的面包屑组件，并根据需要设置相应的css样式

CommonHeader.vue：

```html
<el-breadcrumb separator="/">
	<el-breadcrumb-item v-for="item in tags" :key="item.path" :to="{ path: item.path }">{{ item.label }}</el-breadcrumb-item>
</el-breadcrumb>
```

```css
	.l-content{
        display: flex;
        align-items: center;
        /deep/.el-breadcrumb__item {    //样式的穿刺
            .el-breadcrumb__inner {
                font-weight: normal;	//设置颜色与字体大小
                &.is-link {             //& 表示并且关系
                    color: #666
                }
            }
            &:last-child {      //使用伪类   最后一个颜色为白色
                .el-breadcrumb__inner {
                    color: #fff
                }
            }
        }
    }
```

![image-20221210170149494](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210170149494.png)

### 9.3、使用vuex进行数据传递修改

在store/tab.js中增加内容

面包屑中用到的数据均被存放在state的tabsList中，具体内容应当与侧边栏中的菜单内容一致，默认只需要填写首页的数据，其余菜单中的内容可后续动态添加

在mutations中增加更新面包屑数据的方法，只有当数据不是首页，并且tabList中不存在时，才能进行添加操作，selectMenu(state, val)方法中包含两个参数，第一个参数state是mutations中所有方法都默认的参数，使用该参数才能应用定义的数据，第二个参数val是点击侧边栏传来的对象，该对象包含着名字、路由等内容

store/tab.js

```js
//管理菜单侧边栏中的数据
export default {
    //定义属性数据
    state:{
        isCollapse:false,    //用于控制菜单的展开与收起的属性
        tabsList: [
            {
                path: "/",
                name: "home",
                label: "首页",
                icon: "s-home",
                url: "Home/Home",
            }
        ], // 面包屑数据
    },
    //定义修改方法
    mutations: {
        //修改菜单展开与收起的方法
        collapseMenu(state){
            state.isCollapse = !state.isCollapse
        },
        // 更新面包屑数据
        selectMenu(state, val) {
            // console.log(val, 'val')
            // 判断添加的数据是否为首页
            if (val.name !== 'home') {
                const index = state.tabsList.findIndex(item => item.name === val.name)
                // 如果不存在
                if (index === -1) {
                    state.tabsList.push(val)
                }
            }
        },
    }
}
```

### 9.4、在侧边栏添加跳转函数

为菜单的侧边栏修改clickMenu(item)点击函数，增加一个调用vuex方法的语句

CommonAside.vue

```js
	//点击菜单
    clickMenu(item){
      // console.log(item)
      //当页面的路由与跳转的路由不一致时才能跳转
      if(this.$route.path !== item.path && !(this.$route.path === '/home' && (item.path === '/'))){
        this.$router.push(item.path);
      }
      this.$store.commit('selectMenu', item)
    }
```

### 9.5、导航栏获取数据

在头部导航栏组件中，使用mapState获取修改后的数据tags，将其作为计算属性，然后针对tags进行v-for循环，如第2步中的html代码所示。

CommonHeader.vue：

```js
<script>
//使用辅助函数
import { mapState } from 'vuex'

export default {
    data(){
        return {}
    },
    methods:{
        handleMenu(){
            this.$store.commit('collapseMenu')
        }
    },
    computed: {
        ...mapState({       //...为扩展运算符，将mapState对象解构
            tags: state => state.tab.tabsList
        })
    }
}
</script>
```

## 10、tag组件实现

在components文件夹中增加CommonTag.vue组件，然后注册到Main.vue中

在该组件中使用\<el-tag>进行tag栏的编写

它所获取的数据，来自于store文件夹下的tab.js文件，使用v-for进行循环展示

然后针对每一个标签，编写点击（click）方法以及关闭方法（close）

- click方法会跳转至对应的路由
- close方法会进一步调用store中的closeTag(state, item)方法，通过名称来找到要删除的位置，然后通过splice(index, 1)删除相应的数据。在删除之后会对没有删除的对象做进一步的处理。**不同于之前的store方法的调用以及路由的跳转，此处提供了不同的写法，但没有本质变化。**

此处还用到了路由的name属性，因此要对之前的router中index.js内容进行补全

### 10.1、CommonTag.vue：

```vue
<template>
    <div class="tabs">
        <!-- :closable 是否有关闭选项 -->
        <!-- :effect 主题 如果是true则激活为dark,否则为plain -->
        <el-tag
            v-for="(item, index) in tags"
            :key="item.path"
            :closable="item.name !== 'home'"        是否有关闭选项
            :effect="$route.name === item.name ? 'dark' : 'plain'"
            @click="changeMenu(item)"
            @close="handleClose(item, index)"
            size="small"
            >
            {{ item.label }}
        </el-tag>
    </div>
</template>
<script>
import { mapState, mapMutations } from 'vuex'
export default {
    name: 'CommonTag',
    data() {
        return {}
    },
    computed: {
        ...mapState({
            tags: state => state.tab.tabsList
        })
    },
    methods: {
        ...mapMutations(['closeTag']),
        // 点击tag跳转的功能
        changeMenu(item) {
            // console.log(item)
            this.$router.push({ name: item.name })
        },
        // 点击tag删除的功能
        handleClose(item, index) {
            // 调用store中的mutation进行具体的删除操作
            this.closeTag(item)
            const length = this.tags.length
            // 删除之后的跳转逻辑
            if (item.name !== this.$route.name) {
                return
            }
            // 表示的是删除的最后一项
            if (index === length) {
                this.$router.push({
                    name: this.tags[index - 1].name
                })
            } else {
                this.$router.push({
                    name: this.tags[index].name
                })
            }
        }
    }
}
</script>
<style lang="less" scoped>
.tabs {
    padding: 20px;
    .el-tag {
        margin-right: 15px;
        cursor: pointer;
    }
}
</style>
```

### 10.2、store/tab.js

```js
//管理菜单侧边栏中的数据
export default {
    //定义属性数据
    state:{
        isCollapse:false,    //用于控制菜单的展开与收起的属性
        tabsList: [
            {
                path: "/",
                name: "home",
                label: "首页",
                icon: "s-home",
                url: "Home/Home",
            }
        ], // 面包屑数据
    },
    //定义修改方法
    mutations: {
        //修改菜单展开与收起的方法
        collapseMenu(state){
            state.isCollapse = !state.isCollapse
        },
        // 更新面包屑数据
        selectMenu(state, val) {
            // console.log(val, 'val')
            // 判断添加的数据是否为首页
            if (val.name !== 'home') {
                const index = state.tabsList.findIndex(item => item.name === val.name)
                // 如果不存在
                if (index === -1) {
                    state.tabsList.push(val)
                }
            }
        },
        // 删除指定的tag数据
        closeTag(state, item) {
            // console.log(item, 'item')
            const index = state.tabsList.findIndex(val => val.name === item.name)
            state.tabsList.splice(index, 1)
        },
    }
}
```

### 10.3、Main.vue

```vue
<template>
    <div>
        <el-container>
            <el-aside width="auto">
                <common-aside />
            </el-aside>
            <el-container>
                <el-header>
                    <common-header />
                </el-header>
                <common-tag />
                <el-main>
                    <!-- 路由匹配到的组件将渲染在这里 -->
                    <router-view></router-view>
                </el-main>
            </el-container>
        </el-container>
    </div>
</template>

<script>
import CommonAside from "../components/CommonAside.vue"
import CommonHeader from "../components/CommonHeader.vue"
import CommonTag from "../components/CommonTag.vue"

export default {
    data(){
        return {}
    },
    components:{
        CommonAside,
        CommonHeader, 
        CommonTag
    }
}
</script>

<style scoped>
.el-header {
    padding: 0
}
</style>
```

### 10.4、router/index.js

```js
import Vue from 'vue'
import VueRouter from 'vue-router';
import Home from '../views/Home.vue';
import User from '../views/User.vue';
import Main from '../views/Main.vue';
import Mall from '../views/Mall.vue';
import PageOne from '../views/PageOne.vue';
import PageTwo from '../views/PageTwo.vue';


Vue.use(VueRouter);

//1.创建路由组件

//2.将路由与组件进行映射
const routes = [
    //主路由
    {
        path:'/',
        component: Main,
        redirect:'/home',      //重定向跳转至home
        children: [
            //子路由
            {path:'home',name:'home',component: Home}, //首页
            {path:'user',name:'user',component: User}, //用户管理
            {path:'mall',name:'mall',component: Mall}, //商品管理
            {path:'page1',name:'page1',component: PageOne}, //页面1
            {path:'page2',name:'page2',component: PageTwo}, //页面2
        ]
    },
    // {path:'/home',component: Home},
    // {path:'/user',component: User}
]

//3.创建router实例
const router = new VueRouter({
    routes
})

// 4. 创建和挂载根实例。
// 记得要通过 router 配置参数注入路由，
// 从而让整个应用都有路由功能
export default router
```

## 11、dialog弹窗组件实现

使用ElementUI中的组件完成，拷贝其中的template以及script

通过dialogVisible属性来实现点击弹窗展示的功能，因此要在button按钮中绑定上修改dialogVisible的方法

User.vue

```vue
<template>
  <div class="manage">
    <el-dialog
      title="提示"
      :visible.sync="dialogVisible"
      width="30%"
      :before-close="handleClose"
    >
      <span>这是一段信息</span>
      <span slot="footer" class="dialog-footer">
        <el-button @click="dialogVisible = false">取 消</el-button>
        <el-button type="primary" @click="dialogVisible = false">确 定</el-button>
      </span>
    </el-dialog>
    <div class="manage-header">
      <el-button type="primary" @click="dialogVisible = true">
        + 新增
      </el-button>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      dialogVisible: false
    };
  },
  methods: {
    handleClose(done) {
      this.$confirm('确认关闭？')
        .then(_ => {
          done();
        })
        .catch(_ => {});
    }
  }
};
</script>

<style>
</style>
```

![image-20221210205558469](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210205558469.png)

## 12、form表单组件实现

### 12.1、规定数据

form表单中传输的数据首先要在data()中定义好

```js
<script>
export default {
  data() {
    return {
      dialogVisible: false,
      form:{
        name: '',
        age: '',
        sex: '',
        birth: '',
        addr: ''
      }
    };
  },
  methods: {
    
  }
};
</script>
```

### 12.2、使用elementUI中的控件

**表单el-form可以嵌入在弹窗el-dialog中使用**

- el-form：表单
  - :inline="true"：表示插槽要在一行内
  - :model="form"：表示与data中的数据相对应
- el-form-item：表单中的一行
- el-input：表单中的输入数据
  - placeholder：提示语句
  - 使用v-model进行双向绑定
- el-select：多选
  - el-option：多选的具体内容
- el-date-picker：时间组件

User.vue

```vue
<template>
  <div class="manage">
    <el-dialog
      title="新增用户"
      :visible.sync="dialogVisible"
      width="40%">
      <!-- 用户的表单信息 -->
      <el-form ref="form" :inline="true" :model="form" label-width="80px">
        <el-form-item label="姓名">
          <el-input placeholder="请输入姓名" v-model="form.name"></el-input>
        </el-form-item>
        <el-form-item label="年龄">
          <el-input placeholder="请输入年龄" v-model="form.age"></el-input>
        </el-form-item>
        <el-form-item label="性别">
            <el-select v-model="form.sex" placeholder="请选择性别">
              <el-option label="男" value="1"></el-option>
              <el-option label="女" value="0"></el-option>
            </el-select>
        </el-form-item>
        <el-form-item label="出生日期">
          <el-date-picker
            v-model="form.birth"
            type="date"
            placeholder="选择日期">
          </el-date-picker>
        </el-form-item>
        <el-form-item label="地址">
          <el-input placeholder="请输入地址" v-model="form.addr"></el-input>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="dialogVisible = false">取 消</el-button>
        <el-button type="primary" @click="dialogVisible = false">确 定</el-button>
      </span>
    </el-dialog>

    <div class="manage-header">
      <el-button type="primary" @click="dialogVisible = true">
        + 新增
      </el-button>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      dialogVisible: false,
      form:{
        name: '',
        age: '',
        sex: '',
        birth: '',
        addr: ''
      }
    };
  },
  methods: {
    
  }
};
</script>

<style>
</style>
```

![image-20221210213648057](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210213648057.png)

### 12.3、表单校验

Form 组件提供了表单验证的功能，只需要通过 `rules` 属性传入约定的验证规则，并将 Form-Item 的 `prop` 属性设置为需校验的字段名即可。校验规则参见 [async-validator](https://github.com/yiminghe/async-validator)

首先需要在data()中添加rules，用来作为表单验证的规则，要求与form的名称一致

```js
<script>
export default {
  data() {
    return {
      dialogVisible: false,
      form: {
        name: "",
        age: "",
        sex: "",
        birth: "",
        addr: "",
      },
      rules: {
        name: [{ required: true, message: "请输入姓名" }],
        age: [{ required: true, message: "请输入年龄" }],
        sex: [{ required: true, message: "请选择性别" }],
        birth: [{ required: true, message: "请选择出生日期" }],
        addr: [{ required: true, message: "请输入地址" }],
      },
    };
  },
  methods: {},
};
</script>
```

然后在el-form中增加:rules="rules"，并且为每一行数据根据prop添加规则

![image-20221210214553018](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210214553018.png)

![image-20221210214629123](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210214629123.png)

### 12.4、获取表单中的数据，关闭时删除数据

修改“取消”以及“确定”的点击事件方法，分别为cancel()与submit()

并且考虑到是在“关闭”或者“取消”时清空表单

所以要增加handleClose() 方法，并且加入到弹窗头部当中

```html
	<el-dialog
      title="新增用户"
      :visible.sync="dialogVisible"
      width="40%"
      :before-close="handleClose"
    >
```

```html
	<span slot="footer" class="dialog-footer">
        <el-button @click="cancel">取 消</el-button>
        <el-button type="primary" @click="submit">确 定</el-button>
      </span>
```

对于表单而言，使用validate()方法校验各项输入，使用resetFields()清空表单内容

```js
  methods: {
    // 提交用户表单
    submit() {
      //使用dom节点获取form表单，并使用elementUI提供的validate函数进行验证
      this.$refs.form.validate((valid) => {
        // console.log(valid, 'valid')
        // 如果通过了校验，valid为true，否则为false
        if (valid) {
          

          // 清空表单的数据
          this.$refs.form.resetFields();
          // 关闭弹窗
          this.dialogVisible = false;
        }
      });
      console.log(this.form);
    },
    // 弹窗关闭的时候，情况表单中的数据
    handleClose() {
      this.$refs.form.resetFields();
      this.dialogVisible = false;
    },
    //点击取消按钮的时候，调用弹窗关闭方法
    cancel() {
      this.handleClose();
    },
  },
```

![image-20221210221515552](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210221515552.png)

## 13、用户table组件

### 13.1、获取数据与初步布局

首先在api/mockServeData中添加user.js文件，用来模拟后端获取列表、增加用户、删除用户、批量删除、修改用户的操作

api/mockServeData/user.js

```js
import Mock from 'mockjs'

// get请求从config.url获取参数，post从config.body中获取参数
function param2Obj (url) {
  const search = url.split('?')[1]
  if (!search) {
    return {}
  }
  return JSON.parse(
    '{"' +
    decodeURIComponent(search)
      .replace(/"/g, '\\"')
      .replace(/&/g, '","')
      .replace(/=/g, '":"') +
    '"}'
  )
}

let List = []
const count = 200

for (let i = 0; i < count; i++) {
  List.push(
    Mock.mock({
      id: Mock.Random.guid(),
      name: Mock.Random.cname(),
      addr: Mock.mock('@county(true)'),
      'age|18-60': 1,
      birth: Mock.Random.date(),
      sex: Mock.Random.integer(0, 1)
    })
  )
}

export default {
  /**
   * 获取列表
   * 要带参数 name, page, limt; name可以不填, page,limit有默认值。
   * @param name, page, limit
   * @return {{code: number, count: number, data: *[]}}
   */
  getUserList: config => {
    console.log(config, 'config')
    const { name, page = 1, limit = 20 } = param2Obj(config.url)
    console.log('name:' + name, 'page:' + page, '分页大小limit:' + limit)
    const mockList = List.filter(user => {
      if (name && user.name.indexOf(name) === -1 && user.addr.indexOf(name) === -1) return false
      return true
    })
    const pageList = mockList.filter((item, index) => index < limit * page && index >= limit * (page - 1))
    return {
      code: 20000,
      count: mockList.length,
      list: pageList
    }
  },
  /**
   * 增加用户
   * @param name, addr, age, birth, sex
   * @return {{code: number, data: {message: string}}}
   */
  createUser: config => {
    const { name, addr, age, birth, sex } = JSON.parse(config.body)
    console.log(JSON.parse(config.body))
    List.unshift({
      id: Mock.Random.guid(),
      name: name,
      addr: addr,
      age: age,
      birth: birth,
      sex: sex
    })
    return {
      code: 20000,
      data: {
        message: '添加成功'
      }
    }
  },
  /**
   * 删除用户
   * @param id
   * @return {*}
   */
  deleteUser: config => {
    const { id } = JSON.parse(config.body)
    if (!id) {
      return {
        code: -999,
        message: '参数不正确'
      }
    } else {
      List = List.filter(u => u.id !== id)
      return {
        code: 20000,
        message: '删除成功'
      }
    }
  },
  /**
   * 批量删除
   * @param config
   * @return {{code: number, data: {message: string}}}
   */
  batchremove: config => {
    let { ids } = param2Obj(config.url)
    ids = ids.split(',')
    List = List.filter(u => !ids.includes(u.id))
    return {
      code: 20000,
      data: {
        message: '批量删除成功'
      }
    }
  },
  /**
   * 修改用户
   * @param id, name, addr, age, birth, sex
   * @return {{code: number, data: {message: string}}}
   */
  updateUser: config => {
    const { id, name, addr, age, birth, sex } = JSON.parse(config.body)
    const sex_num = parseInt(sex)
    List.some(u => {
      if (u.id === id) {
        u.name = name
        u.addr = addr
        u.age = age
        u.birth = birth
        u.sex = sex_num
        return true
      }
    })
    return {
      code: 20000,
      data: {
        message: '编辑成功'
      }
    }
  }
}
```

在mock.js增加mock数据与路径的对应关系

api/mock.js

```js
import Mock from 'mockjs'
import homeApi from './mockServeData/home'
import user from './mockServeData/user'

//定义mock的请求拦截
// Mock.mock('/api/home/getData','get',function(){
     // console.log('拦截到了');
// })
Mock.mock('/api/home/getData','get',homeApi.getStatisticalData)

// 用户列表的数据
Mock.mock('/api/user/add', 'post', user.createUser)
Mock.mock('/api/user/edit', 'post', user.updateUser)
Mock.mock('/api/user/del', 'post', user.deleteUser)
Mock.mock(/api\/user\/getUser/, user.getUserList)
```

在index中定义使用axios二次封装后，发出的请求

```js
import http from '../utils/requests'

//请求首页数据的接口
export const getData = () => {
    //返回一个promise对象
    return http.get('/home/getData')
}

export const getUser = (params) => {
    console.log(params, 'params')
    // 返回用户列表
    return http.get('/user/getUser', params)
}

export const addUser = (data) => {
    return http.post('/user/add', data)
}

export const editUser = (data) => {
    return http.post('/user/edit', data)
}

export const delUser = (data) => {
    return http.post('/user/del', data)
}
```

由于是加载时就要渲染，所以要在User.vue中的mounted中获取数据，并导入相应函数

并且在“+ 新增”按钮下面增加table表单

还要在data()中增加tableData用来绑定数据

User.vue：

```html
    <div class="manage-header">
      <el-button type="primary" @click="dialogVisible = true">
        + 新增
      </el-button>
      <el-table 
        :data="tableData"
        style="width: 100%">
        <el-table-column
          prop="date"
          label="日期"
          width="180">
        </el-table-column>
        <el-table-column
          prop="name"
          label="姓名"
          width="180">
        </el-table-column>
        <el-table-column
          prop="address"
          label="地址">
        </el-table-column>
      </el-table>
    </div>
```

```js
import { getUser, addUser, editUser, delUser } from '../api'
```

![image-20221210225523917](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210225523917.png)

```js
  mounted() {
    getUser().then(({ data })=>{
      console.log(data)
    })
  },
```

![image-20221210225116396](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210225116396.png)

### 13.2、针对table列表做调整

修改具体的列名，并使用scope获取该行数据，进行过滤替换操作或者函数操作

并在mathods中定义编辑以及删除的函数

```html
	<div class="manage-header">
      <el-button type="primary" @click="dialogVisible = true">
        + 新增
      </el-button>
      <el-table :data="tableData" style="width: 100%">
        <el-table-column prop="name" label="姓名"> </el-table-column>
        <el-table-column prop="sex" label="性别">
          <!-- 自定义列，进行过滤替换 -->
          <template slot-scope="scope">
            <span> {{ scope.row.sex == 1 ? "男" : "女" }} </span>
          </template>
        </el-table-column>
        <el-table-column prop="age" label="年龄"> </el-table-column>
        <el-table-column prop="birth" label="出生日期"> </el-table-column>
        <el-table-column prop="addr" label="地址"> </el-table-column>
        <el-table-column prop="addr" label="操作">
          <!-- 自定义列 -->
          <template slot-scope="scope">
            <el-button size="mini" @click="handleEdit(scope.row)">编辑</el-button>
            <el-button size="mini" @click="handleDelete(scope.row)" type="danger">删除</el-button>
          </template>
        </el-table-column>
      </el-table>
    </div>
```

```js
	handleEdit(row) {
      
    },
    handleDelete(row) {
      
    },
```

![image-20221210231619801](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221210231619801.png)

### 13.3、用户管理页面新增编辑提交功能

由于“新增”功能与“编辑”功能的弹窗是复用的，应该通过一个状态去区分点击的是“新增”还是“编辑”，不同的状态所呈现的内容是不一样的

在data()中增加一个modelType属性

```
modelType: 0,     //0表示新增的弹窗，1表示编辑的弹窗
```

![image-20221211000703047](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221211000703047.png)

#### 13.3.1、submit()

对于submit()函数而言，需要根据modalType决定是调用api中的addUser还是editUser，再进行完操作后重新获取列表中的数据

```js
	// 提交用户表单
    submit() {
      //使用dom节点获取form表单，并使用elementUI提供的validate函数进行验证
      this.$refs.form.validate((valid) => {
        // console.log(valid, 'valid')
        // 如果通过了校验，valid为true，否则为false
        if (valid) {
          // 后续对表单数据的处理
          if (this.modalType === 0) {
            addUser(this.form).then(() => {
              // 重新获取列表的接口
              this.getList();
            });
          } else {
            editUser(this.form).then(() => {
              // 重新获取列表的接口
              this.getList();
            });
          }
          // 清空表单的数据
          this.$refs.form.resetFields();
          // 关闭弹窗
          this.dialogVisible = false;
        }
      });
    //   console.log(this.form);
    },
```

#### 13.3.2、getList()

在这之中，获取列表数据是一个单独的函数功能，可以从mounted中提取出来

```js
	// 获取列表的数据
    getList() {
      getUser().then(({ data }) => {
        console.log(data);
        this.tableData = data.list;
      });
    },
        
mounted() {
  this.getList();
},
```

#### 13.3.3、handleAdd()

点击“新增按钮”，调用handleAdd()方法，修改modalType的值，并打开弹窗

```js
	handleAdd() {
      this.modalType = 0;
      this.dialogVisible = true;
    },
```

#### 13.3.4、handleEdit(row) 

点击“编辑”按钮，调用handleEdit(row)方法，修改modalType的值，并打开弹窗，然后使用深拷贝的方法将已有数据进行复现

```js
	handleEdit(row) {
      this.modalType = 1;
      this.dialogVisible = true;
      // 注意需要对当前行数据进行深拷贝，否则会出错
      this.form = JSON.parse(JSON.stringify(row));
    },
```

#### 13.3.5、handleDelete(row)

点击“删除”按钮，调用handleDelete(row)方法，并使用api中的delUser(对象)方法进行删除，由于delUser的参数是对象，所以不能直接给定row.id，而是给定{id:row.id}

```js
	handleDelete(row) {
      this.$confirm("此操作将永久删除该文件, 是否继续?", "提示", {
        confirmButtonText: "确定",
        cancelButtonText: "取消",
        type: "warning",
      })
        .then(() => {
          delUser({id:row.id}).then(() => {
            this.$message({
              type: "success",
              message: "删除成功!",
            });
            // 重新获取列表的接口
            this.getList()
          })
        })
        .catch(() => {
          this.$message({
            type: "info",
            message: "已取消删除",
          });
        });
    },
```

### 13.4、修改下展示样式

设定manage的高度为90%，以及table的高度为90%，并将table区的信息移动至“manage-header”外，并预留form搜索区的位置

```css
<style lang="less" scoped>
.manage {
  height: 90%;
}
</style>
```

![image-20221211105038126](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221211105038126.png)

## 14、Pagination分页组件

设置`layout`，表示需要显示的内容，用逗号分隔，布局元素会依次显示。`prev`表示上一页，`next`为下一页，`pager`表示页码列表，除此以外还提供了`jumper`和`total`，`size`和特殊的布局符号`->`，`->`后的元素会靠右显示，`jumper`表示跳页元素，`total`表示总条目数，`size`用于设置每页显示的页码数量。

```html
	  <div class="pager">
        <el-pagination layout="prev, pager, next" :total="total" @current-change="handlePage">
        </el-pagination>
      </div>
```

其中：

- total为所有数据的总条数
- handlePage为点击调准页码的函数

在data()中增加total属性外，还需要增加pageData，用来确定展示页码以及每页的展示数据

在使用handlePage方法时，需要更新pageData中page的具体值，也就是页码的具体页数，然后调用getList()方法进行展示，因此要在getList()方法中给定总共的数据条数，并且需要将pageData以对象的形式传入到mock的getUser方法中，如果只有一个pageData可以写为getUser({params:pageData})，此外，mock中的路径不能够写死，要使用正则表达式去匹配。

表单与分页组件均位于common-tabel盒子中，分页组件位于pager盒子中，针对他们进行css样式设置

![image-20221211114312039](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221211114312039.png)

```js
  data() {
    return {
      dialogVisible: false,
      form: {
        name: "",
        age: "",
        sex: "",
        birth: "",
        addr: "",
      },
      rules: {
        name: [{ required: true, message: "请输入姓名" }],
        age: [{ required: true, message: "请输入年龄" }],
        sex: [{ required: true, message: "请选择性别" }],
        birth: [{ required: true, message: "请选择出生日期" }],
        addr: [{ required: true, message: "请输入地址" }],
      },
      tableData: [],
      modelType: 0, //0表示新增的弹窗，1表示编辑的弹窗
      total: 0,  //当前数据的总条数，默认为0
      pageData: {
        page: 1,
        limit: 10
      },
      userForm: {
        name: ''
      }
    };
  },
```

```js
	// 获取列表的数据
    getList() {
      getUser({ params: { ...this.userForm, ...this.pageData } }).then(({ data }) => {
        // console.log(data);
        this.tableData = data.list;
        this.total = data.count || 0;
      });
    },
    //选择页码的回调函数
    handlePage(val) {
      // console.log(val, 'val')
      this.pageData.page = val
      this.getList()
    },
```

```css
  .common-tabel {
    position: relative;
    height: calc(100% - 62px); //根据父盒子的高度进行动态计算

    .pager {
      position: absolute;
      bottom: 0;
      right: 20px;
    }
  }
```

api/mock.js

![image-20221211115527009](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221211115527009.png)

![image-20221211114647135](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221211114647135.png)

## 15、form搜索表单

在新增数据的同一行增加一个搜索表单

User.vue

```html
  <div class="manage-header">
      <el-button type="primary" @click="handleAdd"> + 新增 </el-button>
      <!-- form搜索区 -->
      <el-form :inline="true" :model="userForm">
        <el-form-item>
          <el-input placeholder="请输入名称" v-model="userForm.name"></el-input>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="onSubmit">查询</el-button>
        </el-form-item>
      </el-form>
    </div>
```

针对form搜索表单使用userForm中的name属性进行搜索，默认为''，不进行搜索过滤

![image-20221211115003428](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221211115003428.png)

点击函数onSubmit，针对name进行搜索，getList()中的参数对象做相应修改

```js
	// 列表的查询
    onSubmit() {
      this.getList()
    }
```

![image-20221211115229124](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221211115229124.png)

然后修改相应的css样式

```css
  .manage-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
```

### 15.1、User.vue汇总

```vue
<template>
  <div class="manage">
    <el-dialog title="新增用户" :visible.sync="dialogVisible" width="40%" :before-close="handleClose">
      <!-- 用户的表单信息 -->
      <el-form ref="form" :rules="rules" :inline="true" :model="form" label-width="80px">
        <el-form-item label="姓名" prop="name">
          <el-input placeholder="请输入姓名" v-model="form.name"></el-input>
        </el-form-item>
        <el-form-item label="年龄" prop="age">
          <el-input placeholder="请输入年龄" v-model="form.age"></el-input>
        </el-form-item>
        <el-form-item label="性别" prop="sex">
          <el-select v-model="form.sex" placeholder="请选择性别">
            <el-option label="男" :value="1"></el-option>
            <el-option label="女" :value="0"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="出生日期" prop="birth">
          <el-date-picker v-model="form.birth" type="date" placeholder="选择日期" value-format="yyyy-MM-dd">
          </el-date-picker>
        </el-form-item>
        <el-form-item label="地址" prop="addr">
          <el-input placeholder="请输入地址" v-model="form.addr"></el-input>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="cancel">取 消</el-button>
        <el-button type="primary" @click="submit">确 定</el-button>
      </span>
    </el-dialog>

    <div class="manage-header">
      <el-button type="primary" @click="handleAdd"> + 新增 </el-button>
      <!-- form搜索区 -->
      <el-form :inline="true" :model="userForm">
        <el-form-item>
          <el-input placeholder="请输入名称" v-model="userForm.name"></el-input>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="onSubmit">查询</el-button>
        </el-form-item>
      </el-form>
    </div>
    
    <div class="common-tabel">
      <el-table stripe="" height="90%" :data="tableData" style="width: 100%">
        <el-table-column prop="name" label="姓名"> </el-table-column>
        <el-table-column prop="sex" label="性别">
          <!-- 自定义列，进行过滤替换 -->
          <template slot-scope="scope">
            <span> {{ scope.row.sex == 1 ? "男" : "女" }} </span>
          </template>
        </el-table-column>
        <el-table-column prop="age" label="年龄"> </el-table-column>
        <el-table-column prop="birth" label="出生日期"> </el-table-column>
        <el-table-column prop="addr" label="地址"> </el-table-column>
        <el-table-column prop="addr" label="操作">
          <!-- 自定义列 -->
          <template slot-scope="scope">
            <el-button size="mini" @click="handleEdit(scope.row)">编辑</el-button>
            <el-button size="mini" @click="handleDelete(scope.row)" type="danger">删除</el-button>
          </template>
        </el-table-column>
      </el-table>
      <div class="pager">
        <el-pagination layout="prev, pager, next" :total="total" @current-change="handlePage">
        </el-pagination>
      </div>
    </div>


  </div>
</template>

<script>
import { getUser, addUser, editUser, delUser } from "../api";
export default {
  data() {
    return {
      dialogVisible: false,
      form: {
        name: "",
        age: "",
        sex: "",
        birth: "",
        addr: "",
      },
      rules: {
        name: [{ required: true, message: "请输入姓名" }],
        age: [{ required: true, message: "请输入年龄" }],
        sex: [{ required: true, message: "请选择性别" }],
        birth: [{ required: true, message: "请选择出生日期" }],
        addr: [{ required: true, message: "请输入地址" }],
      },
      tableData: [],
      modelType: 0, //0表示新增的弹窗，1表示编辑的弹窗
      total: 0,  //当前数据的总条数，默认为0
      pageData: {
        page: 1,
        limit: 10
      },
      userForm: {
        name: ''
      }
    };
  },
  methods: {
    // 提交用户表单
    submit() {
      //使用dom节点获取form表单，并使用elementUI提供的validate函数进行验证
      this.$refs.form.validate((valid) => {
        // console.log(valid, 'valid')
        // 如果通过了校验，valid为true，否则为false
        if (valid) {
          // 后续对表单数据的处理
          if (this.modalType === 0) {
            addUser(this.form).then(() => {
              // 重新获取列表的接口
              this.getList();
            });
          } else {
            editUser(this.form).then(() => {
              // 重新获取列表的接口
              this.getList();
            });
          }
          // 清空表单的数据
          this.$refs.form.resetFields();
          // 关闭弹窗
          this.dialogVisible = false;
        }
      });
      //   console.log(this.form);
    },
    // 弹窗关闭的时候，情况表单中的数据
    handleClose() {
      this.$refs.form.resetFields();
      this.dialogVisible = false;
    },
    //点击取消按钮的时候，调用弹窗关闭方法
    cancel() {
      this.handleClose();
    },
    handleEdit(row) {
      this.modalType = 1;
      this.dialogVisible = true;
      // 注意需要对当前行数据进行深拷贝，否则会出错
      this.form = JSON.parse(JSON.stringify(row));
    },
    handleDelete(row) {
      this.$confirm("此操作将永久删除该文件, 是否继续?", "提示", {
        confirmButtonText: "确定",
        cancelButtonText: "取消",
        type: "warning",
      })
        .then(() => {
          delUser({ id: row.id }).then(() => {
            this.$message({
              type: "success",
              message: "删除成功!",
            });
            // 重新获取列表的接口
            this.getList()
          })
        })
        .catch(() => {
          this.$message({
            type: "info",
            message: "已取消删除",
          });
        });
    },
    handleAdd() {
      this.modalType = 0;
      this.dialogVisible = true;
    },
    // 获取列表的数据
    getList() {
      getUser({ params: { ...this.userForm, ...this.pageData } }).then(({ data }) => {
        // console.log(data);
        this.tableData = data.list;
        this.total = data.count || 0;
      });
    },
    //选择页码的回调函数
    handlePage(val) {
      // console.log(val, 'val')
      this.pageData.page = val
      this.getList()
    },
    // 列表的查询
    onSubmit() {
      this.getList()
    }
  },
  mounted() {
    this.getList();
  },
};
</script>

<style lang="less" scoped>
.manage {
  height: 90%;

  .manage-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .common-tabel {
    position: relative;
    height: calc(100% - 62px); //根据父盒子的高度进行动态计算

    .pager {
      position: absolute;
      bottom: 0;
      right: 20px;
    }
  }
}
</style>
```

## 16、js-cookie

使用js-cookie来保存token，进行不同页面的数据传递

安装

```bash
yarn add @js-cookie@3.0.1
```

使用Cookie

```js
// token信息存入cookie用于不同页面间的通信
Cookie.set('token', data.data.token)
```



## 17、Login登录页面

### 17.1、创建组件添加路由

在router中的index.js添加登录页面的路由

router/index.js：

```js
import Login from '../views/Login.vue'	
	
	{
        path: '/login',
        name: 'login',
        component: Login
    }
```

![image-20221211150101757](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221211150101757.png)

views/Login.vue：

```vue
<template>
    <h1>我是登录页面</h1>
</template>
  
<script>
export default {
    data() {
        return {}
    }
}
</script>
  
<style>

</style>
```

![image-20221211150427474](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20221211150427474.png)

### 17.2、完成登录、权限、退出功能

**下面文字描述比较复杂，一定要参考下方代码进行理解！！！**

- 在登录页面增加一个form表单，用来接收用户名和密码，点击登录按钮，调用submit方法

- 在submit方法中如果输入内容通过了验证，则会调用api/mockServeData/permission.js中的getMenu()方法，此过程经过api/mock.js的拦截处理，故需要在当中进行一定的设置。

- getMenu()方法的结果中如果code码是20000（该数值是自定义的），那么说明正常，然后会将data中的token存储在cookie中，方便不同页面获取。

  - 至于data中的menu菜单数据，则要存储在store中，方便不同组件调用，因此要在store/tab.js文件中的state中增加menu属性，然后设定setMenu(state,val)方法，并将menu数据保存在Cookie中放置刷新页面后数据丢失
  - 此外还需要动态设置路由，使得登录的角色不同就有着不同的功能，因为路由也是不同组件所共享的，所以仍然要在store/tab.js中进行设置。构建addMenu(state,router)动态路由注册函数，在使用的时候需要传递router对象进来，即this.$store.commit('addMenu', this.$router)。组装过程中如果含有children子菜单，需要为每个子菜单增加component属性，即对应的路由组件，若没有则直接为菜单绑定对应的路由item.component = () => import(`../views/${item.url}`)。然后针对存放所有路由的menuArray数组进行动态添加，使用的方法是router对象的addRoute()方，均添加到主路由'Main'下（提前在router/index.js中定义好名字），即router.addRoute('Main', item)
  - 在设置完菜单以及动态添加路由后，应跳转至首页：this.$router.push('/home')
  - 如果有问题，比方说密码错误，应当弹出提示：this.$message.error(data.data.message);

- 此外应该在main.js中添加全局前置导航守卫，首先判断token是否存在，若不存在，说明当前用户未登录，应该跳转至登录页，若存在且来源是登录页则跳转至首页，其余情况则不做修改。并且为解决刷新后，路由丢失的问题，应该在new Vue时调用store/tab.js中的addMenu方法，即

  ```js
    created() {
      store.commit('addMenu', router)
    }
  ```

- 在侧边栏组件CommonAside.vue中，可以不用在data()中定义menuData了，而是在计算属性中定义menuData()，如果缓存中没有，则去store中获取

  ```js
  	menuData() {
        // 判断当前数据,如果缓存中没有,当前store中去获取
        return JSON.parse(Cookie.get('menu')) || this.$store.state.tab.menu
      },
  ```

- 由于现在是动态获取路由，那么router/index.js中Main主路由下的子路由需要全部注释掉

- 完成CommonHeader.vue中的退出功能，由于账号退出是在下拉菜单中，不能够直接使用@click，需要在\<el-dropdown>标签中使用@command="handleClick"，然后在退出的标签中，声明command="cancel"，即：\<el-dropdown-item command="cancel">退出\</el-dropdown-item>。之后在methods中定义handleClick(command)方法，再根据具体的参数例如“cancel”实现对应的功能，退出时需要清空cookie中的token以及menu，并跳转至login登录页面

#### 17.2.1、components/Login.vue

```vue
<template>
    <el-form ref="form" label-width="70px" :inline="true" class="login-container" :model="form" :rules="rules">
        <h3 class="login_title">系统登录</h3>
        <el-form-item label="用户名" prop="username">
            <el-input v-model="form.username" placeholder="请输入账号"></el-input>
        </el-form-item>
        <el-form-item label="密码" prop="password">
            <el-input type="password" v-model="form.password" placeholder="请输入密码"></el-input>
        </el-form-item>
        <el-form-item>
            <el-button @click="submit" style="margin-left: 105px;margin-top: 10px;" type="primary">登录</el-button>
        </el-form-item>
    </el-form>
</template>
<script>
import Mock from 'mockjs'
import Cookie from 'js-cookie'
import { getMenu } from '../api' 
export default {
    data() {
        return {
            form: {
                username: '',
                password: ''
            },
            rules: {
                username: [
                    { required: true, trigger: 'blur', message: '请输入用户名' }
                ],
                password: [
                    { required: true, trigger: 'blur', message: '请输入密码' }
                ]
            }
        }
    },
    methods: {
        // 登录
        submit() {
            // // token信息
            // const token = Mock.Random.guid()
            
            // 校验通过
            this.$refs.form.validate((valid) => {
                if (valid) {
                    getMenu(this.form).then(({ data }) => {
                        console.log(data)
                        if (data.code === 20000) {
                            // token信息存入cookie用于不同页面间的通信
                            Cookie.set('token', data.data.token)

                            // 获取菜单的数据，存入store中
                            this.$store.commit('setMenu', data.data.menu)
                            this.$store.commit('addMenu', this.$router)
                            // 跳转到首页
                            this.$router.push('/home')
                        } else {
                            this.$message.error(data.data.message);
                        }
                    })
                }
            })
        }
    }
}
</script>
<style lang="less" scoped>
.login-container {
    width: 350px;
    border: 1px solid #eaeaea;
    margin: 180px auto;
    padding: 35px 35px 15px 35px;
    background-color: #fff;
    border-radius: 15px;
    box-shadow: 0 0 25px #cac6c6;
    box-sizing: border-box;
    .login_title {
        text-align: center;
        margin-bottom: 40px;
        color: #505458;
    }
    .el-input {
        width: 198px;
    }
}
</style>
```

#### 17.2.2、api/index.js

```js
import http from '../utils/requests'

//请求首页数据的接口
export const getData = () => {
    //返回一个promise对象
    return http.get('/home/getData')
}

export const getUser = (params) => {
    console.log(params, 'params')
    // 返回用户列表
    return http.get('/user/getUser', params)
}

export const addUser = (data) => {
    return http.post('/user/add', data)
}

export const editUser = (data) => {
    return http.post('/user/edit', data)
}

export const delUser = (data) => {
    return http.post('/user/del', data)
}

export const getMenu = (data) => {
    return http.post('/permission/getMenu', data)
}
```

#### 17.2.3、api/mock.js

```js
import Mock from 'mockjs'
import homeApi from './mockServeData/home'
import user from './mockServeData/user'
import permission from './mockServeData/permission'

//定义mock的请求拦截
// Mock.mock('/api/home/getData','get',function(){
     // console.log('拦截到了');
// })
Mock.mock('/api/home/getData','get',homeApi.getStatisticalData)

// 用户列表的数据
Mock.mock('/api/user/add', 'post', user.createUser)
Mock.mock('/api/user/edit', 'post', user.updateUser)
Mock.mock('/api/user/del', 'post', user.deleteUser)
Mock.mock(/api\/user\/getUser/, user.getUserList)

Mock.mock(/api\/permission\/getMenu/, 'post',permission.getMenu)
```

#### 17.2.4、api/mockServeData/permission.js

```js
import Mock from 'mockjs'
export default {
  getMenu: config => {
    const { username, password } = JSON.parse(config.body)
    // 先判断用户是否存在
    // 判断账号和密码是否对应
    if (username === 'admin' && password === 'admin') {
      return {
        code: 20000,
        data: {
          menu: [
            {
              path: '/home',
              name: 'home',
              label: '首页',
              icon: 's-home',
              url: 'Home.vue'
            },
            {
              path: '/mall',
              name: 'mall',
              label: '商品管理',
              icon: 'video-play',
              url: 'Mall.vue'
            },
            {
              path: '/user',
              name: 'user',
              label: '用户管理',
              icon: 'user',
              url: 'User.vue'
            },
            {
              label: '其他',
              icon: 'location',
              children: [
                {
                  path: '/page1',
                  name: 'page1',
                  label: '页面1',
                  icon: 'setting',
                  url: 'PageOne.vue'
                },
                {
                  path: '/page2',
                  name: 'page2',
                  label: '页面2',
                  icon: 'setting',
                  url: 'PageTwo.vue'
                }
              ]
            }
          ],
          token: Mock.Random.guid(),
          message: '获取成功'
        }
      }
    } else if (username === 'xiaoxiao' && password === 'xiaoxiao') {
      return {
        code: 20000,
        data: {
          menu: [
            {
              path: '/home',
              name: 'home',
              label: '首页',
              icon: 's-home',
              url: 'Home.vue'
            },
            {
              path: '/video',
              name: 'video',
              label: '商品管理',
              icon: 'video-play',
              url: 'Mall.vue'
            }
          ],
          token: Mock.Random.guid(),
          message: '获取成功'
        }
      }
    } else {
      return {
        code: -999,
        data: {
          message: '密码错误'
        }
      }
    }
  }
}
```

#### 17.2.5、store/tab.js

```js
import Cookie from "js-cookie"
//管理菜单侧边栏中的数据
export default {
    //定义属性数据
    state:{
        isCollapse:false,    //用于控制菜单的展开与收起的属性
        tabsList: [
            {
                path: "/",
                name: "home",
                label: "首页",
                icon: "s-home",
                url: "Home/Home",
            }
        ], // 面包屑数据
        menu: []
    },
    //定义修改方法
    mutations: {
        //修改菜单展开与收起的方法
        collapseMenu(state){
            state.isCollapse = !state.isCollapse
        },
        // 更新面包屑数据
        selectMenu(state, val) {
            // console.log(val, 'val')
            // 判断添加的数据是否为首页
            if (val.name !== 'home') {
                const index = state.tabsList.findIndex(item => item.name === val.name)
                // 如果不存在
                if (index === -1) {
                    state.tabsList.push(val)
                }
            }
        },
        // 删除指定的tag数据
        closeTag(state, item) {
            // console.log(item, 'item')
            const index = state.tabsList.findIndex(val => val.name === item.name)
            state.tabsList.splice(index, 1)
        },
        // 设置menu的数据
        setMenu(state, val) {
            state.menu = val
            Cookie.set('menu', JSON.stringify(val))
        },
        // 动态注册路由
        addMenu(state, router) {
            // 判断缓存中是否有数据
            if (!Cookie.get('menu')) return
            const menu = JSON.parse(Cookie.get('menu'))
            state.menu = menu
            // 组装动态路由的数据
            const menuArray = []
            menu.forEach(item => {
              if (item.children) {
                item.children =  item.children.map(item => {
                    console.log(item.url)
                    item.component = () => import(`../views/${item.url}`)
                    return item
                })
                menuArray.push(...item.children)
              } else {
                console.log(item.url)
                item.component = () => import(`../views/${item.url}`)
                menuArray.push(item)
              }
            })
            console.log(menuArray, 'menuArray')
            // 路由的动态添加
            menuArray.forEach(item => {
                router.addRoute('Main', item)
            })
        }
    }
}
```

#### 17.2.6、main.js

```js
import Vue from 'vue'
import App from './App.vue'
import ElementUI from 'element-ui';
// import {Row,Button} from 'element-ui'
import 'element-ui/lib/theme-chalk/index.css';

import router from './router'

import store from './store'

import './api/mock'

import Cookie from 'js-cookie'

Vue.config.productionTip = false

Vue.use(ElementUI);
// Vue.use(Row)
// Vue.use(Button)

// 添加全局前置导航守卫
router.beforeEach((to, from, next) => {
  // 判断token存不存在
  const token = Cookie.get('token')
  // token不存在，说明当前用户是未登录，应该跳转至登录页
  if (!token && to.name !== 'login') {
    next({ name: 'login' })
  } else if (token && to.name === 'login'){ // token存在，说明用户登录，此时跳转至首页
    next({ name: 'home' })
  } else {
    next()
  }
})

new Vue({
  router,
  store,
  render: h => h(App),
  created() {
    store.commit('addMenu', router)
  }
}).$mount('#app')
```

#### 17.2.7、router/index.js

```js
import Vue from 'vue'
import VueRouter from 'vue-router';
import Home from '../views/Home.vue';
import User from '../views/User.vue';
import Main from '../views/Main.vue';
import Mall from '../views/Mall.vue';
import PageOne from '../views/PageOne.vue';
import PageTwo from '../views/PageTwo.vue';
import Login from '../views/Login.vue'


Vue.use(VueRouter);

//1.创建路由组件

//2.将路由与组件进行映射
const routes = [
    //主路由
    {
        path:'/',
        component: Main,
        name: 'Main',
        redirect:'/home',      //重定向跳转至home
        children: [
            //子路由
            // {path:'home',name:'home',component: Home}, //首页
            // {path:'user',name:'user',component: User}, //用户管理
            // {path:'mall',name:'mall',component: Mall}, //商品管理
            // {path:'page1',name:'page1',component: PageOne}, //页面1
            // {path:'page2',name:'page2',component: PageTwo}, //页面2
        ]
    },
    // {path:'/home',component: Home},
    // {path:'/user',component: User}
    {
        path: '/login',
        name: 'login',
        component: Login
    }
]

//3.创建router实例
const router = new VueRouter({
    routes
})

// 4. 创建和挂载根实例。
// 记得要通过 router 配置参数注入路由，
// 从而让整个应用都有路由功能
export default router
```

#### 17.2.8、components/CommonAside.vue

```vue
<template>
  <el-menu
    default-active="1-4-1"
    class="el-menu-vertical-demo"
    @open="handleOpen"
    @close="handleClose"
    :collapse="isCollapse"
    background-color="#545c64"
    text-color="#fff"
    active-text-color="#ffd04b"
    >
    <h3>{{isCollapse ? '后台' : '通用后台管理系统'}}</h3>
    <el-menu-item
      @click="clickMenu(item)"
      v-for="item in noChildren"
      :key="item.name"
      :index="item.name"
    >
      <!-- <i class="el-icon-menu"></i> -->
      <i :class="`el-icon-${item.icon}`"></i>
      <span slot="title">{{ item.label }}</span>
    </el-menu-item>

    <el-submenu
      v-for="item in hasChildren"
      :key="item.label"
      :index="item.label"
    >
      <template slot="title">
        <i :class="`el-icon-${item.icon}`"></i>
        <span slot="title">{{ item.label }}</span>
      </template>
      <el-menu-item-group v-for="subItem in item.children" :key="subItem.name">
        <el-menu-item @click="clickMenu(subItem)" index="subItem.name">{{ subItem.label }}</el-menu-item>
      </el-menu-item-group>
    </el-submenu>
  </el-menu>
</template>

<style lang="less" scoped>
.el-menu-vertical-demo:not(.el-menu--collapse) {
  width: 200px;
  min-height: 400px;
}
.el-menu{
    height:100vh;
    h3{
        color:#fff;
        text-align: center;
        line-height:48px;
        font-size:16px;
        font-weight: 400;
    };
    border-right:none;
}
</style>

<script>
import Cookie from "js-cookie"
export default {
  data() {
    return {};
  },
  methods: {
    handleOpen(key, keyPath) {
      console.log(key, keyPath);
    },
    handleClose(key, keyPath) {
      console.log(key, keyPath);
    },
    //点击菜单
    clickMenu(item){
      // console.log(item)
      //当页面的路由与跳转的路由不一致时才能跳转
      if(this.$route.path !== item.path && !(this.$route.path === '/home' && (item.path === '/'))){
        this.$router.push(item.path);
      }
      this.$store.commit('selectMenu', item)
    }
  },
  computed: {
    //对数据进行过滤，分成两组，一组有子菜单，一组没有子菜单
    //没有子菜单
    noChildren() {
      //使用filter进行过滤，filter的参数是一个函数，根据这个函数是true或者false进行判断
      return this.menuData.filter((item) => !item.children);
    },
    //有子菜单
    hasChildren() {
      //使用filter进行过滤，filter的参数是一个函数，根据这个函数是true或者false进行判断
      return this.menuData.filter((item) => item.children);
    },
    isCollapse() {
      return this.$store.state.tab.isCollapse
    },
    menuData() {
      // 判断当前数据,如果缓存中没有,当前store中去获取
      return JSON.parse(Cookie.get('menu')) || this.$store.state.tab.menu
    },
  },
};
</script>
```

#### 17.2.9、components/CommonHeader.vue

```vue
<template>
  <div class="header-container">
    <div class="l-content">
        <el-button style="margin-right:20px" @click="handleMenu" icon="el-icon-menu" size="mini" ></el-button>
        <!-- 面包屑区 -->
        <el-breadcrumb separator="/">
            <el-breadcrumb-item v-for="item in tags" :key="item.path" :to="{ path: item.path }">{{ item.label }}</el-breadcrumb-item>
        </el-breadcrumb>
    </div>
    <div class="r-content">
        <el-dropdown @command="handleClick">
            <span class="el-dropdown-link">
                <img class="user" src="../assets/images/user.png" alt="">
            </span>
            <el-dropdown-menu slot="dropdown">
                <el-dropdown-item>个人中心</el-dropdown-item>
                <el-dropdown-item command="cancel">退出</el-dropdown-item>
            </el-dropdown-menu>
         </el-dropdown>
    </div>
  </div>
</template>

<script>
//使用辅助函数
import { mapState } from 'vuex'
import Cookie from 'js-cookie'
export default {
    data(){
        return {}
    },
    methods:{
        handleMenu(){
            this.$store.commit('collapseMenu')
        },
        handleClick(command) {
            if (command === 'cancel') {
                console.log('登出')
                // 清除cookie中的token
                Cookie.remove('token')
                // 清除cookie中的menu
                Cookie.remove('menu')
                // 跳转到登录页
                this.$router.push('/login')
            }
        }
    },
    computed: {
        ...mapState({       //...为扩展运算符，将mapState对象解构
            tags: state => state.tab.tabsList
        })
    }
}
</script>

<style lang="less" scoped>
.header-container{
    padding: 0 20px;
    background-color:#333;
    height:60px;
    display:flex;
    justify-content: space-between;
    align-items: center;
    .text{
        color: #fff;
        font-size: 14px;
        margin-left: 10px;
    };
    .r-content{
        .user{
            widows: 40px;
            height: 40px;
            border-radius: 50%;
        }
    }
    .l-content{
        display: flex;
        align-items: center;
        /deep/.el-breadcrumb__item {    //样式的穿刺
            .el-breadcrumb__inner {
                font-weight: normal;
                &.is-link {             //& 表示并且关系
                    color: #666
                }
            }
            &:last-child {      //使用伪类
                .el-breadcrumb__inner {
                    color: #fff
                }
            }
        }
    }
}
</style>
```

# 









































