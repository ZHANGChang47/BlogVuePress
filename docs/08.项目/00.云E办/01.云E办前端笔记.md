---
title: 云E办前端笔记
date: 2023-02-03 23:00:00
permalink: /pages/613e0b/
categories:
  - 项目
  - 云E办
tags:
  - 
---
# 云E办前端笔记

## 1、项目介绍

本项目目的是实现中小型企业的在线办公系统，云E办在线办公系统是一个用来管理日常的办公事务的一个系统，他能够管的内容有：日常的各种流程审批，新闻，通知，公告，文件信息，财务，人事，费用，资产，行政，项目，移动办公等等。它的作用就是通过软件的方式，方便管理，更加简单，更加扁平。更加高效，更加规范，能够提高整体的管理运营水平。

本项目在技术方面采用最主流的前后端分离开发模式，使用业界最流行、社区非常活跃的开源框架Vue来构建前端，旨在实现云E办在线办公系统。包括职位管理、职称管理、部门管理、员工管理、工资管理、在线聊天等模块。项目中还会使用业界主流的第三方组件扩展大家的知识面和技能池。

本项目主要模块及技术点如图：

![image-20230117105732112](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117105732112.png)

## 2、搭建项目

### 2.1、环境准备

- 安装Node.js
- 安装Vue-cli

![image-20230117110555612](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117110555612.png)

### 2.2、项目创建

1. 选择好项目创建的位置，例如放在桌面：

   ```bash
   cd .\Desktop\
   ```

2. 然后使用vue创建项目yeb

   ```bash
   vue create yeb
   ```

   ![image-20230117112121564](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117112121564.png)

3. 选择Manually select features，进入以下页面，确定项目要用的组件，当然后期可以自行添加，此处选择时，方向键控制上下，空格键控制是否选中，选择完毕后回车确认，其中选择的有：Babel、Router

   ![image-20230117113840489](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117113840489.png)

4. 由于电脑上同时安装了vue2与vue3，此时选择vue2进行创建

   ![image-20230117112328204](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117112328204.png)

5. 然后不使用history模式，所以选择n

   ![image-20230117112412931](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117112412931.png)

6. 配置信息存储位置，选择放在package.json中

   ![image-20230117112508941](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117112508941.png)

7. 是不是作为一个模板为以后使用，选择：n

   ![image-20230117112549408](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117112549408.png)

8. 然后选择包管理工具，个人倾向使用yarn

   ![image-20230117112709877](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117112709877.png)

9. 出现以下页面表示项目创建成功

   ![image-20230117112900424](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117112900424.png)

10. 根据提示，可以进入yeb文件夹，然后开启服务

    ```bash
    cd ./yeb
    
    yarn servr
    ```

    ![image-20230117113035839](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117113035839.png)

    ![image-20230117113105258](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117113105258.png)

23. 使用Ctrl+C可以退出

## 3、登录页面功能实现

### 3.1、安装Element-UI

#### 3.1.1、安装命令

```bash
yarn add element-ui
```

![image-20230117190139751](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117190139751.png)

#### 3.1.2、全局引入ElementUI

在`src/main.js`中添加如下:

```js
import ElementUI from 'element-ui';
import 'element-ui/lib/theme-chalk/index.css';

Vue.use(ElementUI)
```

![image-20230117190455274](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117190455274.png)

### 3.2、简化项目结构

#### 3.2.1、简化处理App.vue

将App.vue中多余的代码删去，留下的`<router-view/>`用来指定路由匹配组件显示渲染的位置

![image-20230117190653835](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117190653835.png)

#### 3.2.1、删掉默认组件

删掉views中的组件以及components中的组件，并将`router/index.js`中`const routes`中的内容删掉

![image-20230117191321864](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117191321864.png)

### 3.3、form表单开发

#### 3.3.1、创建组件Login.vue

在`views`中创建`Login.vue`，用来作为登录组件

![image-20230117193405683](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117193405683.png)

#### 3.3.2、设置路由router

在`router/index.js`设置`Login.vue`组件的路由：首先从同级目录中引用，然后编写对应的path、name、component

![image-20230117193535205](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117193535205.png)

启动项目后可以在浏览器的根页面中看到“Login”

![image-20230117193721918](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117193721918.png)

#### 3.3.3、Login.vue表单内容

- 在组件当中主要使用`<el-form></el-form>`包裹住表单中的所有内容，在其中：
  - 使用`:rules`指定表单验证的规则
  - 使用`:ref`指定如何找到表单
  - 使用`:model`指定表单中绑定的数据
- 使用`<el-form-item></el-form-item>`来指定表单中具体每一行，在其中：
  - 使用`lable`指定该行的名称
- 使用`<el-input></el-input>`指定表单中具体的输入内容，在其中：
  - 使用`type`指定该行数据输入的类型，可以是“text”文本，也可以是“password”密码
  - 使用`auto-complete`规定是否自动补全，false代表不进行自动补全
  - 使用`placeholder`指定该行提示内容信息
  - 使用`v-model`**绑定`:model`中的具体数据**
- 使用`<el-checkbox></el-checkbox>`来编写单选框，**与`<el-input></el-input>`同级**
- 使用`<el-button></el-button>`来编写按钮，**与`<el-input></el-input>`同级**，在其中：
  - 使用`type`指定其样式，常用的有primary
  - 使用`@click`指定提交方法，在用户提交表单的处理方法中要先对其内容进行验证
  - 使用`this.$message.error('请输入所有字段')`指定验证不通过的信息，可以在ElementUI的Message中查找其他类型内容

Logim.vue：

```vue
<template>
    <div>
        <el-form :rules="rules" ref="loginForm" :model="loginForm" class="loginContainer">
            <h3 class="loginTitle">系统登录</h3>
            <el-form-item label="姓名" prop="username">
                <el-input type="text" auto-complete="false" placeholder="请输入姓名" v-model="loginForm.username"></el-input>
            </el-form-item>
            <el-form-item label="密码" prop="password">
                <el-input type="password" auto-complete="false" placeholder="请输入密码" v-model="loginForm.password"></el-input>
            </el-form-item>
            <el-form-item label="验证码" prop="code">
                <br>
                <div class="loginCode">
                    <el-input type="text" auto-complete="false" placeholder="点击图片更新验证码" v-model="loginForm.code" style="width:250px;margin-right:5px"></el-input>
                    <img :src="captchaUrl" />
                </div>
            </el-form-item>
            <el-checkbox v-model="checked" class="loginRemember">记住我</el-checkbox>
            <el-button type="primary" style="width:100%" @click="submitLogin">登录</el-button>
        </el-form>
    </div>
</template>

<script>
export default {
    name: 'Login',
    data(){
        return{
            captchaUrl:"",
            loginForm:{
                username:'admin',
                password:'123',
                code:''             //验证码，可以先空着
            },
            //默认“记住我”
            checked:true,
            //校验规则
            rules:{
                username:[{required:true,message:'请输入用户名',trigger:'blur'}],
                password:[{required:true,message:'请输入用密码',trigger:'blur'}],
                code:[{required:true,message:'请输入验证码',trigger:'blur'}]
            }
        }
    },
    methods:{
        //用户提交表单
        submitLogin(){
            //先通过表单中的ref属性找到对应的表单
            this.$refs.loginForm.validate((valid) => {
                // console.log(valid, 'valid')
                // 如果通过了校验，valid为true，否则为false
                if (valid) {
                    alert('submit!')
                }else{
                    //使用ElementUI中的弹出信息
                    this.$message.error('请输入所有字段')
                    return false
                }
            });
        }
    }
};
</script>

<style>
.loginContainer{
    border-radius: 15px;
    background-clip: padding-box;
    margin: 180px auto;
    width: 350px;
    padding: 15px 35px 15px 35px;
    background: #fff;
    border: 1px solid #eaeaea;
    box-shadow: 0 0 25px #cac6c6;
}
.loginTitle{
    margin: 0px auto 40px auto;
    text-align: center;
}
.loginRemember{
    text-align: left;
    margin: 0px 0px 15px 0px;
}
.loginCode{
    display: flex;
    align-items: center;
}
</style>
```

![image-20230117232107730](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117232107730.png)

### 3.4、axios请求数据

#### 3.4.1、axios安装

安装axios的0.19.2版本：

```bash
yarn add axios@0.19.2
```

#### 3.4.2、axios封装拦截

- 在`src`目录下新建`utils`文件夹，然后在`utils`文件夹中新建`api.js`
- 在其中引入`axios`、`Message`、`router`
- 首先配置添加响应拦截器，分接口调用成功以及接口调用失败，针对接口调用成功要再根据后端自定义状态码进行判断处理
- 使用`base`指定通用请求的地址前缀，可以替换为后端的地址
- 然后规定好传送json格式的post请求，调用参数包括url与params，其中的url需要进行拼接

`src/utils/api.js`：

```js
import axios from 'axios'
//单独引用Message
import { Message } from 'element-ui'
//导入跳转路由，如果没有登录，跳转至登录页面
import router from '../router';


//添加响应拦截器
axios.interceptors.response.use(success=>{
    //上一行的success表示成功过调到接口

    //业务逻辑错误
    // 外层的if是对浏览器给的状态进行判断，内层的if是对后端自定义的状态进行判断
    if(success.status && success.status===200){
        if(success.data.code==500 || success.data.code==401 || success.data.code==403){
            Message.error({message:success.data.message});
            return;
        }
        if(success.data.message){
            Message.success({message:success.data.message});
        }
    }
    return success.data;
},error=>{
    //接口访问失败，例如服务器挂机

    if(error.response.code==504 || error.response==code==404){
        Message.error({message:'服务器运行有问题'});
    }else if(error.response.code==403){
        Message.error({message:'权限不足，请联系管理员！'});
    }else if(error.response.code==401){
        Message.error({message:'尚未登录'});
        router.replace('/');    //跳转至根目录
    }else{
        if(error.response.data.message){
            Message.error({message:error.response.data.message});
        }else{
            Message.error({message:'未知错误'});
        }
    }
    return;
});

//通用请求的地址前缀，可以替换为后端的地址
let base = '';

//传送json格式的post请求
export const postRequest = (url,params) => {
    return axios({
        method:'post',
        url:`${base}${url}`,
        data:params
    })
}

//传送json的Put请求
export const putRequest = (url,params) => {
    return axios({
        method:'put',
        url:`${base}${url}`,
        data:params
    })
}

//传送json的Get请求
export const getRequest = (url,params) => {
    return axios({
        method:'get',
        url:`${base}${url}`,
        data:params
    })
}

//传送json的Delete请求
export const deleteRequest = (url,params) => {
    return axios({
        method:'delete',
        url:`${base}${url}`,
        data:params
    })
}
```

### 3.5、跨域问题解决

修改根目录下`vue.config.js`中的内容，通过代理进行转发

```js
// const { defineConfig } = require('@vue/cli-service')
// module.exports = defineConfig({
//   transpileDependencies: true
// })

//新建一个代理对象
let proxyObj = {}

//代理路径是'/'
proxyObj['/']={
  //websocket关闭，先只做一个普通的代理
  ws:false,
  //代理到哪里去
  target:'http://localhost:8081',
  //发送请求头host会被设置为target
  changeOrigin:true,
  //不重写请求地址
  pathReWrite:{
    '^/':'/'
  }
}

module.exports={
  devServer:{
    host:'localhost',
    //前端访问8080,后端转发到8081
    port:8080,
    proxy:proxyObj
  }
}
```

### 3.6、验证码完善

对于`Login.vue`中的验证码，其图片请求地址动态绑定`captchaUrl`，并且添加点击更新的方法`updateCaptcha`

```vue
<img :src="captchaUrl" @click="updateCaptcha"/>
```

```vue
captchaUrl:'/captcha?time='+new Date(),
```

```vue
		//更新验证码
        updateCaptcha(){
            this.captchaUrl='/captcha?time='+new Date();
        },
```

![image-20230117232507145](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230117232507145.png)

![image-20230124163250567](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124163250567.png)

### 3.7、登录post请求发送

- 将存储在`loginForm`对象中的username、password、code以post请求调用，后端接口，然后使用JSON解析返回内容，并以alert弹窗的形式展示。
- 实现途径是修改`submitLogin()`方法中的内容
- 当拦截到后端返回内容时，会进入到`3.4.2、axios封装拦截`的拦截器中

```js
	methods:{
        //更新验证码
        updateCaptcha(){
            this.captchaUrl='/captcha?time='+new Date();
        },
        //用户提交表单
        submitLogin(){
            //先通过表单中的ref属性找到对应的表单
            this.$refs.loginForm.validate((valid) => {
                // console.log(valid, 'valid')
                // 如果通过了校验，valid为true，否则为false
                if (valid) {
                    postRequest('/login',this.loginForm).then(resp=>{
                        alert(JSON.stringify(resp));
                    })
                }else{
                    //使用ElementUI中的弹出信息
                    this.$message.error('请输入所有字段')
                    return false
                }
            });
        }
    }
```

![image-20230124163743234](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124163743234.png)

![image-20230124163908451](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124163908451.png)

### 3.8、页面跳转Home

- 在`views`中新建Home组件`Home.vue`

```vue
<template>
    <div>
        <h1>Home.vue</h1>
    </div>
</template>

<script>

</script>

<style>

</style>
```

- 然后在`router/index.js`中增加Home组件的路由

```js
import Home from '../views/Home'

	{
        path:'/home',
        name:'Home',
        component:Home
      }
```

![image-20230124164541734](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124164541734.png)

- 再次修改`views/Login.vue`组件中的`submitLogin()`方法，在成功获取到后端返回的Token时跳转至Home页面
- 使用`this.$router`路由跳转有两种方式，使用`replace`没有后退按钮，使用`push`有后退按钮

![image-20230124165206861](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124165206861.png)

![image-20230124164910612](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124164910612.png)

- 补充重定向，如果在浏览器中输入`localhost:8080/#/sys/basic`，在登录后就不是直接进入首页，而是重定向跳转至相应页面

  ```js
  				   // 使用this.$router路由跳转有两种方式，使用replace没有后退按钮，使用push有后退按钮
                              // 跳转首页或者重定向到某个路径
                              // 获取重定向路径
                              let path = this.$route.query.redirect;
                              this.$router.replace((path=='/'||path==undefined)?'/home':path);
  ```

  ![image-20230125013842812](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230125013842812.png)

### 3.9、请求头携带Token

- 首先获取到token字符串，然后将其存储到session当中

```js
//存储用户token到session中方便在请求拦截器中获取使用
const tokenStr = resp.obj.tokenHead + resp.obj.token;
window.sessionStorage.setItem('tokenStr',tokenStr);
```

![image-20230124171507486](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124171507486.png)

- 在axios的封装文件`utils/api.js`中增加请求拦截器，从session中获取`tokenStr`，然后放到请求中

```js
//添加请求拦截器
axios.interceptors.request.use(config=>{
    //如果存在token，请求会携带这个token
    if(window.sessionStorage.getItem('tokenStr')){
        config.headers['Authorization']=window.sessionStorage.getItem('tokenStr');
    }
    return config;
},error=>{
    console.log(error);
})
```

![image-20230124171629735](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124171629735.png)

- 再次登录后，可以在浏览器中看到存储的session

![image-20230124170504345](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124170504345.png)

### 3.10、添加请求等待动画

- 查询ElementUI官网中有关`loading`的组件，对其文件进修，然后添加至`views/Login.vue`组件的`<el-form>`标签中

  ```vue
  					v-loading="loading"
                      element-loading-text="正在登录..."
                      element-loading-spinner="el-icon-loading"
                      element-loading-background="rgba(0, 0, 0, 0.8)"
  ```

  ![image-20230124172114166](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124172114166.png)

- 该动画由`loading`进行控制，若为false是关闭，若为true是开启：在`data`中定义，在`submitLogin`中判断开启与关闭

  ![image-20230124172312339](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124172312339.png)

### 3.11、全局引入axios请求

> 以插件的方式实现全局引入方法请求

- 在之前的登录实现过程中是局部引入封装的`axios请求（postRequest）`，如果不做修改，那么后续所有组件都要引入

  ![image-20230124172946967](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124172946967.png)

- 在`main.js`中全局引入axios请求

  ```js
  import { postRequest } from '@/utils/api';
  import { putRequest } from '@/utils/api';
  import { getRequest } from '@/utils/api';
  import { deleteRequest } from '@/utils/api';
  
  Vue.prototype.postRequest = postRequest;
  Vue.prototype.putRequest = putRequest;
  Vue.prototype.getRequest = getRequest;
  Vue.prototype.deleteRequest = deleteRequest;
  ```

  ![image-20230124173203770](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124173203770.png)

- 组件中使用axios封装请求

  在单个组件中不再需要单个引入，直接使用`this.postRequest()`即可

  ![image-20230124173342182](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124173342182.png)

## 4、首页导航菜单功能实现

### 4.1、首页布局并循环路由展示

- 使用ElementUI中的布局组件：

  ```vue
  	<el-menu :default-openeds="['1', '3']">
        <el-submenu index="1">
          <template slot="title"><i class="el-icon-message"></i>导航一</template>
          <el-menu-item-group>
            <template slot="title">分组一</template>
            <el-menu-item index="1-1">选项1</el-menu-item>
            <el-menu-item index="1-2">选项2</el-menu-item>
          </el-menu-item-group>
        </el-submenu>
  	</el-menu>   
  ```

- 创建两个将要实现的并且放在导航栏中的组件Test1.vue、Test2.vue

  `views/Test1.vue`：

  ```vue
  <template>
      <div>组件1</div>
  </template>
  
  <script>
      export default{
          name : "Test1"
      }
  </script>
  
  <style scoped>
  </style>
  ```

  `views/Test2.vue`：

  ```vue
  <template>
      <div>组件2</div>
  </template>
  
  <script>
      export default{
          name : "Test2"
      }
  </script>
  
  <style scoped>
  </style>
  ```

- 将两个新组建的路由作为Home组件的子路由，并且将它们的名字（name）属性，将会直接展示在页面中，所以可以直接使用汉字进行描述。此外与Home组件同一级的Login组件，并不希望它也被展示在侧边栏，所以可以给它增加一个`hidden:true`，在后续循环遍历时进行判断

  `router/index.js`

  ```js
  import Vue from 'vue'
  import VueRouter from 'vue-router'
  import Login from '../views/Login'
  import Home from '../views/Home'
  import Test1 from '../views/Test1'
  import Test2 from '../views/Test2'
  
  Vue.use(VueRouter)
  
  const routes = [
    {
      path:'/',
      name:'Login',
      component:Login,
      hidden:true
    },
    {
      path:'/home',
      name:'导航1',
      component:Home,
      children:[
        {
          path:'/test1',
          name:'选项1',
          component:Test1
        },
        {
          path:'/test2',
          name:'选项2',
          component:Test2
        }
      ]
    },
  ]
  
  const router = new VueRouter({
    routes
  })
  
  export default router
  ```

- Home.vue组件的实现：

  - 在`<el-menu>`标签添加`router`，这样就可以根据`<el-menu-item>`标签中的`index`进行不同路由的跳转，然后将对应页面的内容展示在`<el-main>`标签的`<router-view />`中
  - 之后在`<el-submenu>`标签中使用`v-for`循环遍历`router/index.js`中的所有路由，并且使用`v-if`将含有`hidden:true`的路由不进行展示
  - 在`<el-menu-item>`中针对二级路由再次使用`v-for`进行循环，为其中的`:index`进行赋值

  `views/Home.vue`

  ```vue
  <template>
      <div>
          <el-container>
              <el-header>Header</el-header>
              <el-container>
                  <el-aside width="200px">
                      <el-menu router>
                          <el-submenu index="1" 
                                      v-for="(item,index) in this.$router.options.routes" 
                                      :key="index" 
                                      v-if="!item.hidden">
                              <template slot="title">
                                  <i class="el-icon-location"></i>
                                  <span>{{item.name}}</span>
                              </template>
                              <el-menu-item :index="children.path" 
                                            v-for="(children,index) in item.children">
                                  {{ children.name }}
  							</el-menu-item>
                          </el-submenu>
                      </el-menu>            
                  </el-aside>
                  <el-main>
                      <router-view />
                  </el-main>
              </el-container>
          </el-container>
      </div>
  </template>
  
  <script>
  
      export default {
          name:"Home",
          
      }
  
  </script>
  
  <style>
  
  </style>
  ```

  ![image-20230124190023489](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124190023489.png)

### 4.2、Vuex进行状态信息管理

#### 4.2.1、添加依赖

```shell
yarn add vuex@3.4.0
```

#### 4.2.2、配置Vuex

- 在`src`目录下新建`store`目录，并创建`index.js`文件

  ```js
  import Vue from 'vue'
  import Vuex from 'vuex'
  
  Vue.use(Vuex);
  
  export default new Vuex.Store({
      //state可以理解为一个全局的对象，用来保存组件的一些公共数据
      state:{
          routes:[]
      },
  
      //同步执行，可以改变state里面值的一些方法
      mutations:{
          //初始化路由方法
          initRoutes(state,data){
              state.routes=data;
          }
      }
  })
  ```

- 在`main.js`中引入`store`中的`index.js`

  ```js
  import store from './store'
  
  new Vue({
    router,
    store,
    render: h => h(App)
  }).$mount('#app')
  ```

  ![image-20230124192020061](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124192020061.png)

### 4.3、根据数据库内容创建组件

- 在`yeb`数据库的`t_menu`表中，根据`path`、`component`、`name`字段在不同文件夹下创建`.vue`组件

  ![image-20230124211007544](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124211007544.png)

  ![image-20230125022203070](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230125022203070.png)

### 4.4、封装菜单请求工具类

在`utils`中创建`menus.js`文件，使用`GetRequest`请求调用后端的接口`/system/cfg/menu`，对获取的数据进行一定的格式化处理（例如获取的component是一个字符串，但vue中需要的是一个对象，并且该对象存放在不同的文件夹中），然后将将数据放入`router`与`store`中

`src/utils/menus.js`：

```js
//封装菜单请求工具类
//后端返回的component是一个字符串，而前端则是导入的对象

//获取下get请求，去调用后端接口，由于现在是js文件，而不是vue文件，所以需要导入
import { getRequest } from "./api";


//获取数据后放在router和store中
export const initMenu = (router,store) => {
    //如果routes的长度大于0，说明不用初始化
    if(store.state.routes.length>0){
        return;
    }

    getRequest('/system/config/menu').then(data=>{
        if(data){
            //如果能获取到数据那么就要进行格式化
            let fmtRoutes = formatRoutes(data);
            //添加到router
            // router.addRoutes(fmtRoutes);
            for(let i=0,length=fmtRoutes.length;i<length;i+=1){
                const element = fmtRoutes[i];
                router.addRoute(element);
            }
            //将数据存入vuex，调用store的路由初始化方法
            store.commit('initRoutes',fmtRoutes);
        }
    })
}

//格式化路由函数
export const formatRoutes = (routes) => {
    let fmtRoutes = [];
    routes.forEach(router => {
        let {
            path,
            component,
            name,
            iconCls,
            children
        } = router;
        if(children && children instanceof Array){
            //递归
            children = formatRoutes(children);
        }
        let fmtRoute = {
            path:path,
            name:name,
            iconCls:iconCls,
            children:children,
            component(resolve){
                if(component.startsWith('Home')){
                    require(['../views/'+component+'.vue'],resolve);
                }else if(component.startsWith('Emp')){
                    require(['../views/emp/'+component+'.vue'],resolve);
                }else if(component.startsWith('Per')){
                    require(['../views/per/'+component+'.vue'],resolve);
                }else if(component.startsWith('Sal')){
                    require(['../views/sal/'+component+'.vue'],resolve);
                }else if(component.startsWith('Sta')){
                    require(['../views/sta/'+component+'.vue'],resolve);
                }else if(component.startsWith('Sys')){
                    require(['../views/sys/'+component+'.vue'],resolve);
                }
                
            }
        }
        fmtRoutes.push(fmtRoute)
    });
    return fmtRoutes;
}
```

### 4.5、设置前置路由守卫

在`main.js`中设置前置路由守卫，实现能够在全局获取路由

```js
//设置全局的前置路由首位
//to是即将要进入的目标路由对象
//from是要离开的路由对象
//next是用来跳入到to路由的方法，没有next()则无法跳转
router.beforeEach((to,from,next)=>{
  //首先根据能否获取到token去判断是否已经登录，获取不到就去判断是不是从登录页过来
  if(window.sessionStorage.getItem('tokenStr')){
    initMenu(router,store)
    next();
  }else{
    if(to.path=='/'){
      // 如果是登录页，next()直接放行
      next();
    }else{
      next('/?redirect='+to.path);
    }
  }
})
```

![image-20230124232617403](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124232617403.png)

- 在`<el-menu>`标签上增加`<unique-opened>`，并修改`<el-submenu>`中的`index=1`为`:index="index+''"`，这样可以使得菜单不同时展开

  ![image-20230124235714565](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124235714565.png)

### 4.6、使用font-awesome图标

- 为使用数据库中定义的图标UI，需要安装`font-awesome`

  ```shell
  yarn add font-awesome@4.7.0
  ```

- 在`main.js`加入引用

  ```js
  import 'font-awesome/css/font-awesome.css';
  ```

  ![image-20230124235332739](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124235332739.png)

- 将`Home.vue`中`<template>`标签中`<i>`标签内的`class="el-icon-location"`修改为`:class="item.iconCls"`，并加上样式`style="color:#1accff;margin-right:5px"`

  ![image-20230124235306113](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230124235306113.png)

### 4.7、下拉菜单组件存放用户信息

> 修改Home.vue组件中的Header
>
> 在`<el-header>`中增加下拉菜单`<el-dropdown>`
>
> 需要获取用户登录的信息，通过前置路由守卫来实现

- 使用`main.js`中的前置路由守卫获取用户信息，将用户信息以字符串的形式存放到session中

  ```java
  //设置全局的前置路由首位
  //to是即将要进入的目标路由对象
  //from是要离开的路由对象
  //next是用来跳入到to路由的方法，没有next()则无法跳转
  router.beforeEach((to,from,next)=>{
    //首先根据能否获取到token去判断是否已经登录，获取不到就去判断是不是从登录页过来
    if(window.sessionStorage.getItem('tokenStr')){
      initMenu(router,store);
      //判断用户信息是否存在，如果不存在则调用后端接口获取用户信息
      if(!window.sessionStorage.getItem('user')){
        return getRequest('/admin/info').then(resp=>{
          if(resp){
            //存入用户信息，只能存放字符串
            window.sessionStorage.setItem('user',JSON.stringify(resp));
            next(to);
          }
        })
      }
      next();
    }else{
      if(to.path=='/'){
        // 如果是登录页，next()直接放行
        next();
      }
    }
  })
  ```

- 在`public/index.html`的`<body>`标签中加入样式：`style="margin: 0px;padding: 0px;"`，避免它对后面样式调整产生影响

  ![image-20230125003415971](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230125003415971.png)

- 将`Home.vue`中的`<el-header>Header</el-header>`替换为以下内容：

  ```vue
  			<el-header class="homeHeader">
                  <div class="title">
                      云E办
                  </div>
                  <el-dropdown>
                      <span class="el-dropdown-link">
                          {{ user.name }}<i><img :src="user.userFace"/></i>
                      </span>
                      <el-dropdown-menu slot="dropdown">
                          <el-dropdown-item>个人中心</el-dropdown-item>
                          <el-dropdown-item>设置</el-dropdown-item>
                          <el-dropdown-item>注销登录</el-dropdown-item>
                      </el-dropdown-menu>
                  </el-dropdown>
              </el-header>
  ```

- 为`<router-view>`标签添加类名：`<router-view class="homeRouterView"/>`

- 针对`Home.vue`中新增的类添加css样式：

  ```css
  <style>
  .homeHeader {
      background: #409eff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
      box-sizing: border-box;
  }
  
  .homeHeader .title {
      font-size: 30px;
      font-family: 华文楷体;
      color: white;
  }
  
  .homeHeader .userInfo{
      cursor:pointer;
  }
  
  .el-dropdown-link{
      display: flex;
      align-items: center;
      justify-content: center;
  }
  
  .el-dropdown-link img{
      width: 48px;
      height: 48px;
      border-radius: 24px;
      margin-left: 8px;
  }
  
  .homeRouterView{
      margin-top: 10px;
  }
  </style>
  ```
  
  ![image-20230125003659054](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230125003659054.png)

### 4.8、注销登录功能实现

-   为下拉菜单中的每一个选项都增加`command`属性，然后为`<el-dropdown>`增加`@command="commandHandler"`方法，这样在点击每个选项的时候，可以根据`command`属性去执行不同的操作

  ```vue
  			<el-header class="homeHeader">
                  <div class="title">
                      云E办
                  </div>
                  <el-dropdown class="userInfo" @command="commandHandler">
                      <span class="el-dropdown-link">
                          {{ user.name }}<i><img :src="user.userFace" /></i>
                      </span>
                      <el-dropdown-menu slot="dropdown">
                          <el-dropdown-item command="userinfo">个人中心</el-dropdown-item>
                          <el-dropdown-item command="setting">设置</el-dropdown-item>
                          <el-dropdown-item command="logout">注销登录</el-dropdown-item>
                      </el-dropdown-menu>
                  </el-dropdown>
              </el-header>
  ```

- 在`methods`方法中完成对`commandHandler`的具体定义，其中使用`this.$confirm`消息提示用来确定是否注销，如果注销，就要移除`session`中的用户信息以及Token值，还要清除`vuex`中`store`存放的菜单数据，之后页面跳转至登录页面

  ```js
  	methods: {
          commandHandler(command) {
              if (command == 'logout') {
                  //this.$confirm提供一个确认框，用来确定是否退出登录
                  this.$confirm('此操作将注销登录, 是否继续?', '提示', {
                      confirmButtonText: '确定',
                      cancelButtonText: '取消',
                      type: 'warning'
                  }).then(() => {
                      //注销登录
                      this.postRequest('/logout');
                      //移除session中的user用户信息以及Token
                      window.sessionStorage.removeItem('user');
                      window.sessionStorage.removeItem('tokenStr');
                      //清除vuex中存放的菜单数据
                      this.$store.commit('initRoutes',[]);
                      //页面跳转至登录页面
                      this.$router.replace('/');
                  }).catch(() => {
                      this.$message({
                          type: 'info',
                          message: '已取消操作'
                      });
                  });
              }
          }
      }
  ```

  ![image-20230125011606335](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230125011606335.png)

### 4.9、添加面包屑组件

在`<el-main>`中添加面包屑组件，并且指定首页内容：

```vue
				<el-main>
                    <el-breadcrumb separator-class="el-icon-arrow-right" 
                                   v-if="this.$router.currentRoute.path!='/home'">
                        <el-breadcrumb-item :to="{ path: '/home' }">首页</el-breadcrumb-item>
                        <el-breadcrumb-item>
                            {{ this.$router.currentRoute.name }}
                        </el-breadcrumb-item>
                    </el-breadcrumb>
                    <div class="homeWelcome" v-if="this.$router.currentRoute.path=='/home'">
                        欢迎来到云E办系统！
                    </div>
                    <router-view />
                </el-main>
```

  在`<style>`中补充样式

```css
.homeWelcome{
    text-align: center;
    font-size: 30px;
    font-family: 华文楷体;
    color: #409eff;
    padding-top: 50px;
}
```

![image-20230125011507926](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230125011507926.png)



![image-20230125011518327](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230125011518327.png)

## 5、基础信息设置框架搭建

> 基础信息设置功能实现包括部门管理、职位管理、职称管理、奖惩规则、权限组
>

在`src/components/sys/basic`中针对上述内容分别新建组件

![image-20230125020640874](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230125020640874.png)

- 在`views/sys/SysBasic.vue`中引入Tabs标签页组件，用来分隔内容上有关联但属于不同类别的数据集合。

- 然后将刚才创建的`.vue`文件引入进来，并作为components中的内容，然后设定在`<el-tab-pane>`标签的`name`属性上

- 使用`v-model="activeName"`可以指定页面打开时默认展示的内容

  ```vue
  <template>
      <div>
          <el-tabs v-model="activeName" type="card">
              <el-tab-pane label="部门管理" name="DepMana"><DepMana></DepMana></el-tab-pane>
              <el-tab-pane label="职位管理" name="PosMana"><PosMana></PosMana></el-tab-pane>
              <el-tab-pane label="职称管理" name="JoblevelMana"><JoblevelMana></JoblevelMana></el-tab-pane>
              <el-tab-pane label="奖惩规则" name="EcMana"><EcMana></EcMana></el-tab-pane>
              <el-tab-pane label="权限组" name="PermissMana"><PermissMana></PermissMana></el-tab-pane>
          </el-tabs>
      </div>
  </template>
  
  <script>
  import DepMana from '../../components/sys/basic/DepMana.vue'
  import EcMana from '../../components/sys/basic/EcMana.vue'
  import JoblevelMana from '../../components/sys/basic/JoblevelMana.vue'
  import PermissMana from '../../components/sys/basic/PermissMana.vue'
  import PosMana from '../../components/sys/basic/PosMana.vue'
  
  export default {
  
      name: 'SysBasic',
      data(){
          return{
              activeName:'PosMana'
          }
      },
      components:{
          DepMana,
          EcMana,
          JoblevelMana,
          PermissMana,
          PosMana
      }
  };
  </script>
  
  <style lang="scss" scoped>
  
  </style>
  ```

  ![image-20230125021042883](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230125021042883.png)

## 6、职位管理功能实现

### 6.1、职位管理页面设计

- 使用`<el-input>`输入框标签，与`pos.name`双向绑定
- 使用`<el-button>`按钮标签
- 使用`<el-table>`表格标签，`stripe`开启斑马线，`border`开启边框，与`positions`这个列表双向绑定
- 使用`<el-table-column>`表格单列标签

`src/components/sys/basic/PosMana.vue`

```vue
<template>
    <div>
        <div>
            <el-input size="small" class="addPosInput" placeholder="添加职位..." suffix-icon="el-icon-plus"
                v-model="pos.name">
            </el-input>
            <el-button size="small" icon="el-icon-plus" type="primary">添加</el-button>
        </div>
        <div class="posManaMain">
            <el-table stripe border :data="positions" style="width: 70%">
                <el-table-column prop="id" label="编号" width="55">
                </el-table-column>
                <el-table-column prop="name" label="职位" width="120">
                </el-table-column>
                <el-table-column prop="createDate" label="创建时间" width="200">
                </el-table-column>
            </el-table>
        </div>
    </div>
</template>

<script>
export default {
    name: 'PosMana',
    data() {
        return {
            pos: {
                name: ''
            },
            positions:[],
            
        }
    }
};
</script>

<style scoped>
.addPosInput {
    width: 300px;
    margin-right: 10px;
}
.posManaMain{
    margin-top: 10px;
}
</style>
```

![image-20230125023658897](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230125023658897.png)

### 6.2、职位查询、添加、删除功能实现

- 在`methods`中提供`addPosition()`作为添加方法、`handleDelete`作为删除方法、`initPositions`作为查询方法

- 在`addPosition()`中传入与职位名称双向绑定的`pos对象`，用post请求调用后端的接口，调用成功后`再次刷新表格`，并且将输入框中的内容清除：`this.pos.name = '';`、`@keydown.enter.native="addPosition"`加在`<el-input>`标签里面

- 在`handleDelete(index，data)`中`index`是该行的索引、`data`是该行数据的内容，例如`data.id`、`data.name`，使用`MessageBox`组件中的`this.$confirm`来让用户确认是否删除

- 在`initPositions()`方法发出get请求，将获取的数据与表格中的数据`positions`进行绑定

- 添加多选框是在`<el-table>`内新增一列

  ```vue
  <el-table-column type="selection" width="55"></el-table-column>
  ```

`src/components/sys/basic/PosMana`

```vue
<template>
    <div>
        <div>
            <el-input size="small" 
                      class="addPosInput" 
                      placeholder="添加职位..." 
                      suffix-icon="el-icon-plus"
                	  @keydown.enter.native="addPosition" 
                      v-model="pos.name">
            </el-input>
            <el-button size="small" 
                       icon="el-icon-plus" 
                       type="primary" 
                       @click="addPosition">
                添加
    		</el-button>
        </div>
        <div class="posManaMain">
            <el-table stripe border :data="positions" style="width: 70%">
                <el-table-column type="selection" width="55">
                </el-table-column>
                <el-table-column prop="id" label="编号" width="55">
                </el-table-column>
                <el-table-column prop="name" label="职位" width="120">
                </el-table-column>
                <el-table-column prop="createDate" label="创建时间" width="200">
                </el-table-column>
                <el-table-column label="操作" width="200">
                    <template slot-scope="scope">
                        <el-button size="mini" 
                                   @click="handleEdit(scope.$index, scope.row)">
                            编辑
                        </el-button>
                        <el-button size="mini" type="danger" 
                                   @click="handleDelete(scope.$index, scope.row)">
                            删除
                        </el-button>
                    </template>
                </el-table-column>
            </el-table>
        </div>
    </div>
</template>

<script>
export default {
    name: 'PosMana',
    data() {
        return {
            pos: {
                name: ''
            },
            positions: [],
        }
    },
    mounted() {
        this.initPositions();
    },
    methods: {
        //添加方法
        addPosition() {
            if (this.pos.name) {
                this.postRequest('/system/basic/pos/', this.pos).then(resp => {
                    //成功调用接口后，再次刷新表格
                    this.initPositions();
                    //调用成功后，将输入框中的内容删除
                    this.pos.name = '';
                })
            } else {
                this.$message.error("职位名称为空")
            }
        },
        //编辑方法
        handleEdit(index, data) {

        },
        //删除方法
        handleDelete(index, data) {
            this.$confirm('此操作将永久删除['+data.name+'], 是否继续?', '提示', {
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {
                this.deleteRequest('/system/basic/pos/'+data.id).then(resp=>{
                    if(resp){
                        this.initPositions();
                    }
                });
            }).catch(() => {
                this.$message({
                    type: 'info',
                    message: '已取消删除'
                });
            });

        },
        //初始化表格方法，在mounted中调用
        initPositions() {
            this.getRequest('/system/basic/pos/').then(resp => {
                if (resp) {
                    this.positions = resp;
                }
            })
        }
    }
};
</script>

<style scoped>
.addPosInput {
    width: 300px;
    margin-right: 10px;
}

.posManaMain {
    margin-top: 10px;
}
</style>
```

### 6.3、职位的编辑、批量删除功能实现

- 点击`编辑`按钮，调用`showEditView(index,data)`会出现`<el-dialog>`对话框，并采用拷贝的方式允许将该行数据的某项内容回显在对话框上，由于创建时间类型和后端不是很兼容，所以可以将其赋值为0，之后点击对话框的确认按钮，执行更新方法，该方法会调用后端的更新数据接口，之后关闭对话框
- 使用`<el-button>`标签制作批量删除按钮，根据多选框内容数组列表的长度来判断该批量删除按钮是否启用，并为该按钮绑定删除方法`deleteMany()`。由于批量删除的参数是一个数组，例如：`?ids=20&ids=21&`，因此可以使用拼接的方式进行

`src/components/sys/basic/PosMana`

```vue
<template>
    <div>
        <div>
            <el-input size="small" 
                      class="addPosInput" 
                      placeholder="添加职位..." 
                      suffix-icon="el-icon-plus"
                      @keydown.enter.native="addPosition" 
                      v-model="pos.name">
            </el-input>
            <el-button size="small" 
                       icon="el-icon-plus" 
                       type="primary" 
                       @click="addPosition">
                添加
    		</el-button>
        </div>
        <div class="posManaMain">
            <el-table stripe border 
                      :data="positions" 
                      @selection-change="handleSelectionChange"
                      style="width: 70%">
                <el-table-column type="selection" width="55">
                </el-table-column>
                <el-table-column prop="id" label="编号" width="55">
                </el-table-column>
                <el-table-column prop="name" label="职位" width="120">
                </el-table-column>
                <el-table-column prop="createDate" label="创建时间" width="200">
                </el-table-column>
                <el-table-column label="操作" width="200">
                    <template slot-scope="scope">
                        <el-button size="mini" 
                                   @click="showEditView(scope.$index, scope.row)">
                            编辑
                        </el-button>
                        <el-button size="mini" type="danger" 
                                   @click="handleDelete(scope.$index, scope.row)">
                            删除
                        </el-button>
                    </template>
                </el-table-column>
            </el-table>
        </div>
        <el-button type="danger" size="small" style="margin-top:8px" 
                   :disabled="this.multipleSelection.length==0" 
                   @click="deleteMany">
            批量删除
		</el-button>
        <el-dialog title="编辑职位" 
                    :visible.sync="dialogVisible" 
                    width="30%">
            <div>
                <el-tag>职位名称</el-tag>
                <el-input v-model="updatePos.name" 
                          size="small" 
                          class="updatePosInput">
                </el-input>
            </div>
            <span slot="footer" class="dialog-footer">
                <el-button size="small" @click="dialogVisible = false">取 消</el-button>
                <el-button size="small" type="primary" @click="doUpdate">确 定</el-button>
            </span>
        </el-dialog>
    </div>
</template>

<script>
export default {
    name: 'PosMana',
    data() {
        return {
            //添加对象
            pos: {
                name: ''
            },
            //表格数据对象
            positions: [],
            //是否展开对话框
            dialogVisible:false,
            //更新对象
            updatePos:{
                name:''
            },
            //表格多选内容
            multipleSelection:[],
        }
    },
    mounted() {
        this.initPositions();
    },
    methods: {
        //批量删除方法
        deleteMany(){
            this.$confirm('此操作将永久删除[' + this.multipleSelection.length + ']条职位, 是否继续?', '提示', {
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {
                //制作批量删除数组，例如：?ids=20&ids=21&
                let ids = '?';
                this.multipleSelection.forEach(item=>{
                    ids+='ids='+item.id+'&';
                });
                console.log(ids)
                this.deleteRequest('/system/basic/pos/' + ids).then(resp => {
                    if (resp) {
                        this.initPositions();
                    }
                });
            }).catch(() => {
                this.$message({
                    type: 'info',
                    message: '已取消删除'
                });
            });
        },
        //获得多选内容，并根据多选内容数组的长度判断受否禁用批量删除
        handleSelectionChange(val){
            this.multipleSelection=val;
        },
        //添加方法
        addPosition() {
            if (this.pos.name) {
                this.postRequest('/system/basic/pos/', this.pos).then(resp => {
                    //成功调用接口后，再次刷新表格
                    this.initPositions();
                    //调用成功后，将输入框中的内容删除
                    this.pos.name = '';
                })
            } else {
                this.$message.error("职位名称为空")
            }
        },
        //显示编辑框方法
        showEditView(index, data) {
            //回显：拷贝之前的数据
            Object.assign(this.updatePos,data);
            this.updatePos.createDate='';
            //打开编辑框
            this.dialogVisible=true;
        },
        //更新方法
        doUpdate(){
            this.putRequest('/system/basic/pos/',this.updatePos).then(resp=>{
                if(resp){
                    this.initPositions();
                    this.dialogVisible=false;
                }
            })
        },
        //删除方法
        handleDelete(index, data) {
            this.$confirm('此操作将永久删除[' + data.name + ']职位, 是否继续?', '提示', {
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {
                this.deleteRequest('/system/basic/pos/' + data.id).then(resp => {
                    if (resp) {
                        this.initPositions();
                    }
                });
            }).catch(() => {
                this.$message({
                    type: 'info',
                    message: '已取消删除'
                });
            });
        },
        //初始化表格方法，在mounted中调用
        initPositions() {
            this.getRequest('/system/basic/pos/').then(resp => {
                if (resp) {
                    this.positions = resp;
                }
            })
        }
    }
};
</script>

<style scoped>
.addPosInput {
    width: 300px;
    margin-right: 10px;
}
.posManaMain {
    margin-top: 10px;
}
.updatePosInput{
    width: 200px;
    margin-left: 8px;
}
</style>
```

![image-20230126123809370](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230126123809370.png)

## 7、职称管理功能实现

> 与`5.2、职位管理功能实现大致相同`，不同之处在于
>
> - 添加`<el-select>`制作下拉选项，选择何种职称等级
> - 使用`<template slot-scope="scope">`模板写法来针对性的根据enabled显示是否启用
> - 不是在添加完以后置空内容，而是在获取表格数据时置空
> - 

```vue
			<el-select size="small" v-model="jl.titleLevel" placeholder="职称等级"
                style="margin-left: 6px;margin-right: 6px;">
                <el-option v-for="item in titleLevels" :key="item" :label="item" :value="item">
                </el-option>
            </el-select>
```

`src/components/sys/basic/JoblevelMana`

```vue
<template>
    <div>
        <div>
            <el-input v-model="jl.name" 
                      placeholder="添加职称等级..." 
                      prefix-icon="el-icon-plus" 
                      style="width:300px"
                	  size="small"></el-input>
            <el-select size="small" 
                       v-model="jl.titleLevel" 
                       placeholder="职称等级"
                	   style="margin-left: 6px;margin-right: 6px;">
                <el-option v-for="item in titleLevels" :key="item" :label="item" :value="item">
                </el-option>
            </el-select>
            <el-button size="small" type="primary" icon="el-icon-plus" @click="addJoblevel">
                添加
    		</el-button>
        </div>
        <div style="margin-top:10px">
            <el-table :data="jls" 
                      stripe border style="width: 70%" 
                      @selection-change="handleSelectionChange">
                <el-table-column type="selection" width="55">
                </el-table-column>
                <el-table-column prop="id" label="编号" width="55">
                </el-table-column>
                <el-table-column prop="name" label="职称名称" width="150">
                </el-table-column>
                <el-table-column prop="titleLevel" label="职称等级" width="150">
                </el-table-column>
                <el-table-column prop="createDate" label="创建日期" width="150">
                </el-table-column>
                <el-table-column prop="enabled" label="是否启用" width="150">
                    <template slot-scope="scope">
                        <el-tag v-if="scope.row.enabled" type="success">已启用</el-tag>
                        <el-tag v-else type="danger">未启用</el-tag>
                    </template>
                </el-table-column>
                <el-table-column label="操作">
                    <template slot-scope="scope">
                        <el-button size="mini" @click="showEditView(scope.row)">
                            编辑
                        </el-button>
                        <el-button size="mini" type="danger" @click="deleteHandler(scope.row)">
                            删除
                        </el-button>
                    </template>
                </el-table-column>
            </el-table>
            <el-button type="danger" 
                       size="small" 
                       style="margin-top:10px" 
                       :disabled="this.multipleSelection.length==0" 
                       @click="deleteMany">批量删除</el-button>
        </div>
        <el-dialog title="编辑职称" :visible.sync="dialogVisible" width="30%">
            <table>
                <tr>
                    <td>
                        <el-tag>职称名称</el-tag>
                    </td>
                    <td>
                        <el-input v-model="updateJl.name" 
                                  size="small" 
                                  style="margin-left: 6px;">
                        </el-input>
                    </td>
                </tr>
                <tr>
                    <td>
                        <el-tag>职称等级</el-tag>
                    </td>
                    <td>
                        <el-select size="small" 
                                   v-model="updateJl.titleLevel" 
                                   placeholder="职称等级"
                            	   style="margin-left: 6px;margin-right: 6px;">
                            <el-option v-for="item in titleLevels" 
                                       :key="item" :label="item" 
                                       :value="item">
                            </el-option>
                        </el-select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <el-tag>是否启用</el-tag>
                    </td>
                    <td>
                        <el-switch  v-model="updateJl.enabled"
                                    active-color="#13ce66"
                                    inactive-color="#ff4949"
                                    active-text="已启用"
                                    inactive-text="未启用"
                                    style="margin-left:6px">
                        </el-switch>
                    </td>
                </tr>
            </table>
            <span slot="footer" class="dialog-footer">
                <el-button size="small" @click="dialogVisible = false">取 消</el-button>
                <el-button size="small" type="primary" @click="doUpdate">确 定</el-button>
            </span>
        </el-dialog>
    </div>
</template>

<script>
export default {
    name: 'JoblevelMana',
    data() {
        return {
            //添加数据的jl对象
            jl: {
                name: '',
                titleLevel: ''
            },
            //可选职称
            titleLevels: [
                '正高级',
                '副高级',
                '中级',
                '初级',
                '员级'
            ],
            //后端返回的职称对象列表
            jls: [],
            //对话框是否展开
            dialogVisible: false,
            //更新职称对象
            updateJl: {
                name: '',
                titleLevel: '',
                enabled:false,
            },
            //表格多选内容
            multipleSelection:[],
        }
    },
    mounted() {
        this.initJls();
    },
    methods: {
        //批量删除
        deleteMany(){
            this.$confirm('此操作将永久删除[' + this.multipleSelection.length + ']条职称, 是否继续?', '提示', {
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {
                //制作批量删除数组，例如：?ids=20&ids=21&
                let ids = '?';
                this.multipleSelection.forEach(item=>{
                    ids+='ids='+item.id+'&';
                });
                this.deleteRequest('/system/basic/joblevel/' + ids).then(resp => {
                    if (resp) {
                        this.initJls();
                    }
                });
            }).catch(() => {
                this.$message({
                    type: 'info',
                    message: '已取消删除'
                });
            });
        },
        //处理选中事件
        handleSelectionChange(val){
            this.multipleSelection=val;
        },
        //更新数据
        doUpdate(){
            this.putRequest('/system/basic/joblevel/',this.updateJl).then(resp=>{
                if(resp){
                    this.initJls();
                    this.dialogVisible=false;
                }
            })  
        },
        //打开对话框函数
        showEditView(data) {
            Object.assign(this.updateJl,data);
            this.updateJl.createDate='';
            this.dialogVisible = true;
        },
        //删除职称
        deleteHandler(data) {
            this.$confirm('此操作将永久删除[' + data.name + ']职称, 是否继续?', '提示', {
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {
                this.deleteRequest('/system/basic/joblevel/' + data.id).then(resp => {
                    if (resp) {
                        this.initJls();
                    }
                });
            }).catch(() => {
                this.$message({
                    type: 'info',
                    message: '已取消删除'
                });
            });
        },
        //添加职称
        addJoblevel() {
            if (this.jl.name && this.jl.titleLevel) {
                this.postRequest('/system/basic/joblevel/', this.jl).then(resp => {
                    if (resp) {
                        this.initJls();
                    }
                })
            } else {
                this.$message.error('字段不能为空')
            }
        },
        //获取表格数据
        initJls() {
            this.getRequest('/system/basic/joblevel/').then(resp => {
                if (resp) {
                    this.jls = resp;
                    this.jl.name = '';
                    this.jl.titleLevel = '';
                }
            })
        }
    }
};
</script>

<style lang="scss" scoped>

</style>
```

![image-20230126141036767](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230126141036767.png)

## 8、权限组功能实现

- 使用`<template slot="prepend">`标签设置前缀

  ```vue
  <el-input size="small" placeholder="请输入角色英文名" v-model="role.name">
  	<template slot="prepend">ROLE_</template>
  </el-input>
  ```

- 使用`<el-collapse v-model="activeName" accordion>`手风琴样式

  ```vue
  <template>
      <div>
          <div class="permissManaTool">
              <el-input size="small" placeholder="请输入角色英文名" v-model="role.name">
                  <template slot="prepend">ROLE_</template>
              </el-input>
              <el-input size="small" placeholder="请输入角色中文名" v-model="role.nameZh">
              </el-input>
              <el-button size="small" type="primary" icon="el-icon-plus">添加角色</el-button>
          </div>
          <div class="permissManaMain">
              <el-collapse v-model="activeName" accordion>
                  <el-collapse-item title="一致性 Consistency" name="1">
                      <div>与现实生活一致：与现实生活的流程、逻辑保持一致，遵循用户习惯的语言和概念；</div>
                      <div>在界面中一致：所有的元素和结构需保持一致，比如：设计样式、图标和文本、元素的位置等。</div>
                  </el-collapse-item>
                  <el-collapse-item title="反馈 Feedback" name="2">
                      <div>控制反馈：通过界面样式和交互动效让用户可以清晰的感知自己的操作；</div>
                      <div>页面反馈：操作后，通过页面元素的变化清晰地展现当前状态。</div>
                  </el-collapse-item>
                  <el-collapse-item title="效率 Efficiency" name="3">
                      <div>简化流程：设计简洁直观的操作流程；</div>
                      <div>清晰明确：语言表达清晰且表意明确，让用户快速理解进而作出决策；</div>
                      <div>帮助用户识别：界面简单直白，让用户快速识别而非回忆，减少用户记忆负担。</div>
                  </el-collapse-item>
                  <el-collapse-item title="可控 Controllability" name="4">
                      <div>用户决策：根据场景可给予用户操作建议或安全提示，但不能代替用户进行决策；</div>
                      <div>结果可控：用户可以自由的进行操作，包括撤销、回退和终止当前操作等。</div>
                  </el-collapse-item>
              </el-collapse>
          </div>
      </div>
  </template>
  ```

  ![image-20230126143123697](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230126143123697.png)

- 卡片控件`<el-card>`

- 树形控件`<el-tree>`，其中使用`show-checkbox`可以指定多选框，使用`:default-checked-keys="selectedMenus"`可以指定选择有哪几项，要完成这个必须要加入`ref="tree"`

> 权限组涉及所有代码

`components/sys/basic/PermissMana`

```vue
<template>
    <div>
        <div class="permissManaTool">
            <el-input size="small" 
                      placeholder="请输入角色英文名" 
                      v-model="role.name">
                <template slot="prepend">ROLE_</template>
            </el-input>
            <el-input size="small" 
                      placeholder="请输入角色中文名" 
                      v-model="role.nameZh" 
                      @keydown.enter.native="doAddRole">
            </el-input>
            <el-button size="small" 
                       type="primary" 
                       icon="el-icon-plus" 
                       @click="doAddRole">
                添加角色
			</el-button>
        </div>
        <div class="permissManaMain">
            <el-collapse v-model="activeName" accordion @change="change">
                <el-collapse-item :title="r.nameZh" 
                                  :name="r.id" 
                                  v-for="(r, index) in roles" 
                                  :key="index">
                    <el-card class="box-card">
                        <div slot="header" class="clearfix">
                            <span>可访问资源</span>
                            <el-button style="float: right; padding: 3px 0;color: #ff0000;" 
                                       type="text" 
                                       icon="el-icon-delete" 
                                       @click="doDeleteRole(r)">
                            </el-button>
                        </div>
                        <div>
                            <el-tree :data="allMenus" 
                                     :props="defaultProps" 
                                     show-checkbox
                                     ref="tree"
                                     node-key="id"
                                     :key="index"
                                     :default-checked-keys="selectedMenus">
                            </el-tree>
                            <div style="display:flex;justify-content:flex-end">
                                <el-button size="mini" 
                                           @click="cancelUpdate">
                                    取消修改
                                </el-button>
                                <el-button size="mini" 
                                           type="primary" 
                                           @click="doUpdate(r.id,index)">
                                    确认修改
                                </el-button>
                            </div>
                        </div>
                    </el-card>
                </el-collapse-item>
            </el-collapse>
        </div>
    </div>
</template>

<script>
import { getRequest } from '@/utils/api';

export default {
    name: 'PermissMana',
    data() {
        return {
            //添加的角色对象
            role: {
                name: '',
                nameZh: '',
            },
            //展示后端查询到的角色数组
            roles: [],
            //树形控件要展示的所有菜单
            allMenus:[],
            defaultProps:{
                children:'children',
                label:'name',
            },
            //选择的菜单id
            selectedMenus:[],
            //默认打开的手风琴是哪个
            activeName:-1,
        }
    },
    mounted() {
        this.initRoles();
    },
    methods: {
        //删除角色
        doDeleteRole(role){
            this.$confirm('此操作将永久删除[' + role.nameZh + ']角色, 是否继续?', '提示', {
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {
                this.deleteRequest('/system/basic/permission/role/' + role.id).then(resp => {
                    if (resp) {
                        this.initRoles();
                    }
                });
            }).catch(() => {
                this.$message({
                    type: 'info',
                    message: '已取消删除'
                });
            });
        },
        //添加角色
        doAddRole(){
            if(this.role.name && this.role.nameZh){
                this.postRequest('/system/basic/permission/role',this.role).then(resp=>{
                    if(resp){
                        this.initRoles();
                        this.role.name='';
                        this.role.nameZh='';
                    }
                })
            }else{
                this.$message.error("所有字段不能为空")
            }
        },
        //取消更新
        cancelUpdate(){
            this.activeName=-1;
        },
        //更新某个角色下的所有菜单
        doUpdate(rid,index){
            //获取树
            let tree=this.$refs.tree[index]
            //获取叶子节点的id，如果没有加true，那么会获取所有的id
            let selectedKeys = tree.getCheckedKeys(true);
            // console.log(selectedKeys)
            //循环添加至url中
            let url='/system/basic/permission/?rid='+rid;
            selectedKeys.forEach(key=>{
                url += '&mids=' + key;
            });
            // console.log(url);
            this.putRequest(url).then(resp=>{
                if(resp){
                    this.initRoles();
                    this.activeName=-1;
                }
            })
        },
        //改变手风琴面板选择时的方法，参数是每个手风琴的“:name="r.id"”
        change(rid){
            if(rid){
                // alert(rid);
                this.initAllMenus();
                this.initSelectedMenus(rid);
            }
        },
        //调用后端接口，根据角色id查询菜单id
        initSelectedMenus(rid){
            getRequest('/system/basic/permission/mid/'+rid).then(resp=>{
                if(resp){
                    this.selectedMenus = resp;
                }
            })
        },
        //获取所有菜单
        initAllMenus(){
            this.getRequest('/system/basic/permission/menus').then(resp=>{
                if(resp){
                    this.allMenus=resp;
                }
            })
        },
        //获取所有角色
        initRoles() {
            this.getRequest('/system/basic/permission/').then(resp => {
                if (resp) {
                    this.roles = resp;
                }
            })
        }
    }
};
</script>

<style scoped>
.permissManaTool {
    display: flex;
    justify-content: flex-start;
}

.permissManaTool .el-input {
    width: 300px;
    margin-right: 6px;
}

.permissManaMain {
    margin-top: 10px;
    width: 700px;
}
</style>
```

![image-20230126151116551](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230126151116551.png)

![image-20230126165159354](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230126165159354.png)

## 9、部门管理功能实现

![image-20230126205402287](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230126205402287.png)

> 新增特殊值之处有2：
>
> 1. 使用过滤器来完成对树形控件的搜索
> 2. 添加数据或者删除数据后，不重新从数据库中查询，而是手动增加或者删除已有的数据

`components/sys/basic/DepMana`

```vue
<template>
    <div style="width: 500px;">
        <el-input placeholder="请输入部门名称进行搜索..." 
                  prefix-icon="el-icon-search" 
                  v-model="filterText">
        </el-input>
        <el-tree :data="deps" 
                 :props="defaultProps" 
                 :filter-node-method="filterNode" 
                 :expand-on-click-node="false"
            	 ref="tree">
            <span class="custom-tree-node" 
                  slot-scope="{ node, data }"
                  style="display:flex;justify-content:space-between;width:100%">
                <span>{{ data.name }}</span>
                <span>
                    <el-button class="depBtn" 
                               type="primary" 
                               size="mini" 
                               @click="showAddDep(data)">
                        添加部门
                    </el-button>
                    <el-button class="depBtn" 
                               type="danger" 
                               size="mini" 
                               @click="deleteDep(data)">
                        删除部门
                    </el-button>
                </span>
            </span>
        </el-tree>
        <el-dialog title="添加部门" :visible.sync="dialogVisible" width="30%">
            <div>
                <table>
                    <tr>
                        <td>
                            <el-tag>上级部门</el-tag>
                        </td>
                        <td>
                            {{ pname }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <el-tag>部门名称</el-tag>
                        </td>
                        <td>
                            <el-input v-model="dep.name" placeholder="请输入部门名称...">
    						</el-input>
                        </td>
                    </tr>
                </table>
            </div>
            <span slot="footer" class="dialog-footer">
                <el-button @click="dialogVisible = false">取 消</el-button>
                <el-button type="primary" @click="doAddDep">确 定</el-button>
            </span>
        </el-dialog>
    </div>
</template>

<script>
export default {
    name: 'DepMana',
    data() {
        return {
            //要搜索的关键字
            filterText: '',
            //初始化时调用后端获得的部门数组
            deps: [],
            //展示时依据的属性
            defaultProps: {
                children: 'children',
                label: 'name'
            },
            //对话框是否展开 
            dialogVisible: false,
            //添加部门的对象
            dep: {
                name: '',
                parentId: -1,
            },
            //上级部门的名称
            pname: '',
        }
    },
    watch: {
        filterText(val) {
            this.$refs.tree.filter(val);
        }
    },
    mounted() {
        this.initDeps();
    },
    methods: {
        //添加部门后的初始化方法
        initDep() {
            this.dep = {
                name: '',
                parentId: -1
            }
            this.name = '';
        },
        //手动插入部门，然后页面显示
        addDep2Deps(deps, dep) {
            for (let i = 0; i < deps.length; i++) {
                let d = deps[i];
                if (d.id == dep.parentId) {
                    d.children = d.children.concat(dep);
                    if(d.children.length>0){
                        d.isParent = true;
                    }
                    return;
                } else {
                    this.addDep2Deps(d.children, dep);
                }
            }
        },
        //添加部门
        doAddDep() {
            this.postRequest('/system/basic/department/', this.dep).then(resp => {
                if (resp) {
                    this.addDep2Deps(this.deps, resp.obj);
                    this.initDep();
                    this.dialogVisible = false;
                }
            })
        },
        //添加对象弹窗打开
        showAddDep(data) {
            this.pname = data.name
            this.dep.parentId = data.id;
            this.dialogVisible = true;
        },
        //手动删除对象
        removeDepFromDeps(p,deps, id) {
            for(let i=0;i<deps.length;i++){
                let d=deps[i];
                if(d.id==id){
                    deps.splice(i,1);
                    if(deps.length==0){
                        p.isParent = false;
                    }
                    return;
                }else{
                    this.removeDepFromDeps(d,d.children,id);
                }
            }
        },
        //删除对象
        deleteDep(data) {
            if (data.isParent) {
                this.$message.error('父部门删除失败')
            } else {
                this.$confirm('此操作将永久删除该[' + data.name + ']部门, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    this.deleteRequest('/system/basic/department/' + data.id).then(resp => {
                        if (resp) {
                            this.removeDepFromDeps(null,this.deps, data.id);
                        }
                    });
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: '已取消删除'
                    });
                });
            }
        },
        //从后端获取初始化数据
        initDeps() {
            this.getRequest('/system/basic/department/').then(resp => {
                if (resp) {
                    this.deps = resp;
                }
            })
        },
        filterNode(value, data) {
            if (!value) return true;
            return data.name.indexOf(value) !== -1;
        }
    },
};
</script>

<style scoped>
.depBtn {
    padding: 2px;
}
</style>
```

## 10、操作员管理功能实现

> 使用卡片组件
>
> 使用Switch开关
>
> 使用popover弹出对话框
>
> 使用select下拉菜单

![image-20230126232109530](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230126232109530.png)

`views/sys/SysAdmin.vue`

```vue
<template>
    <div>
        <div style="display:flex;justify-content:center;margin-top: 10px;">
            <el-input placeholder="通过用户名搜索用户" 
                      prefix-icon="el-icon-search" 
                      style="width:400px;margin-right: 10px;"
                	  v-model="keywords">
    		</el-input>
            <el-button type="primary" icon="el-icon-search" @click="doSearch">搜索</el-button>
        </div>
        <div class="admin-container">
            <el-card class="admin-card" v-for="(admin, index) in admins" :key="index">
                <div slot="header" class="clearfix">
                    <span>{{ admin.name }}</span>
                    <el-button style="float: right; padding: 3px 0;color: red;" 
                               type="text" icon="el-icon-delete"
                        	   @click="deleteAdmin(admin)">
    				</el-button>
                </div>
                <div>
                    <div class="img-container">
                        <img :src="admin.userFace" 
                             :alt="admin.name" 
                             :title="admin.name" 
                             class="userFace-img" />
                    </div>
                </div>
                <div class="userinfo-container">
                    <div>用户名：{{ admin.name }}</div>
                    <div>手机号码：{{ admin.phone }}</div>
                    <div>电话号码：{{ admin.telephone }}</div>
                    <div>地址：{{ admin.address }}</div>
                    <div>用户状态：
                        <el-switch v-model="admin.enabled" 
                                   active-color="#13ce66" 
                                   inactive-color="#ff4949"
                                   @change="enabledChange(admin)" 
                                   active-text="启用" 
                                   inactive-text="紧用" 
                                   style="margin-left:6px">
                        </el-switch>
                    </div>
                </div>
                <div>
                    用户角色：
                    <el-tag style="margin-right: 4px;" 
                            type="success" 
                            v-for="(role, index) in admin.roles" 
                            :key="index">
                        {{ role.nameZh }}
                    </el-tag>
                    <el-popover placement="right" 
                                title="角色列表" 
                                width="200" 
                                trigger="click" 
                                @show="showPop(admin)" 
                                @hide="hidePop(admin)">
                        <el-select v-model="selectedRoles" 
                                   placeholder="请选择" 
                                   multiple>
                            <!---multiple开启多选-->
                            <el-option v-for="(r,index) in allRoles" 
                                        :key="index" 
                                        :label="r.nameZh" 
                                        :value="r.id">
                            </el-option>
                        </el-select>
                        <el-button type="text" slot="reference" icon="el-icon-more">
    				</el-button>
                    </el-popover>
                </div>
                <div>
                    备注：{{ admin.remark }}
                </div>
            </el-card>
        </div>
    </div>
</template>

<script>
export default {
    name: 'SysAdmin',
    data() {
        return {
            //查询出来的操作员
            admins: [],
            //搜索关键词
            keywords: '',
            //所有可选角色
            allRoles:[],
            //角色弹出框中选中的数组
            selectedRoles:[],
        }
    },
    mounted() {
        this.initAdmins();
    },
    methods: {
        //弹出框隐藏方法
        hidePop(admin){
            //获得角色对象列表
            let roles=[];
            Object.assign(roles,admin.roles);

            //根据长度是否相同，确定数据是否发生变化，进入决定是否要执行接下来的操作
            //如果个数相同，进一步通过双重循环判断内容是否发生变化
            let flag=false;
            if(roles.length != this.selectedRoles.length){
                flag=true
            }else{
                for(let i=0;i<roles.length;i++){
                    let role = roles[i];
                    for(let j=0;j<this.selectedRoles.length;j++){
                        let sr=this.selectedRoles[j];
                        if(role.id == sr){
                            roles.splice(i,1);
                            i--
                            break;
                        }
                    }
                }
                if(roles.length!=0){
                    flag=true;
                }
            }

            if(flag){
                //拼接url
                let url='/system/admin/role?adminId='+admin.id;
                this.selectedRoles.forEach(sr=>{
                    url += '&rids=' + sr;
                })
                this.putRequest(url).then(resp=>{
                    if(resp){
                        this.initAdmins();
                    }
                })
            }
        },
        //弹出框点击方法
        showPop(admin){
            this.initAllRoles();
            let roles = admin.roles;
            this.selectedRoles = [];
            roles.forEach(r=>{
                this.selectedRoles.push(r.id);
            });
        },
        //初始化获取所有角色
        initAllRoles(){
            this.getRequest('/system/admin/roles').then(resp=>{
                this.allRoles=resp;
            })
        },
        //修改启用状态
        enabledChange(admin) {
            this.putRequest('/system/admin/', admin).then(resp => {
                if (resp) {
                    this.initAdmins();
                }
            })
        },
        //删除操作员
        deleteAdmin(admin) {
            this.$confirm('此操作将删除操作员[' + admin.name + '], 是否继续?', '提示', {
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {
                this.deleteRequest('/system/admin/' + admin.id).then(resp => {
                    if (resp) {
                        this.initAdmins();
                    }
                });
            }).catch(() => {
                this.$message({
                    type: 'info',
                    message: '已取消删除'
                });
            });
        },
        //根据关键词查询操作员
        doSearch() {
            this.initAdmins();
        },
        //初始化查询操作员
        initAdmins() {
            this.getRequest('/system/admin/?keywords=' + this.keywords).then(resp => {
                if (resp) {
                    this.admins = resp;
                }
            })
        }
    }
};
</script>

<style scoped>
.admin-container {
    margin-top: 10px;
    display: flex;
    justify-content: space-around;
    /* 自动换行 */
    flex-wrap: wrap;
}

.admin-card {
    width: 350px;
    margin-bottom: 20px;
}

.userFace-img {
    width: 72px;
    height: 72px;
    border-radius: 72px;
}

.img-container {
    width: 100%;
    display: flex;
    justify-content: center;
}

.userinfo-container {
    font-size: 14px;
    color: #409eff;
}
</style>
```

## 11、员工资料功能实现

![image-20230127193408958](https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230127193408958.png)

安装下载支持插件：

```shell
yarn add js-file-download@0.4.12
```

`src/views/emp/EmpBasic.vue`

```vue
<template>
    <div>
        <div>
            <!--工具类-->
            <div style="display:flex;justify-content: space-between;margin-top: 10px;">
                <div>
                    <el-input style="width:300px;margin-right:10px" 
                              v-model="empName" 
                              @keydown-enter-native="initEmps"
                        	  prefix-icon="el-icon-search" 
                              clearable 
                              @clear="initEmps"
                        	  placeholder="请输入员工姓名进行搜索..." 
                              :disabled="showAdvanceSearchVisible  ? true : false">
    				</el-input>
                    <el-button type="primary" 
                               icon="el-icon-search" 
                               @click="initEmps" 
                               :disabled="showAdvanceSearchVisible  ? true : false">
                        搜索
    				</el-button>
                    <el-button type="primary" 
                               @click="showAdvanceSearchVisible=!showAdvanceSearchVisible">
                        <i :class="showAdvanceSearchVisible ? 'fa fa-angle-double-up' : 'fa fa-angle-double-down'" aria-hidden="true"></i>
                        高级搜索
                    </el-button>
                </div>
                <div>
                    <el-upload style="display:inline-flex;margin-right:8px" 
                               :show-file-list=false
                               :before-upload="beforeUpload" 
                               :on-success="onSuccess" 
                               :on-Error="onError"
                               :disabled="importDataDisabled" 
                               :headers="headers" 
                               action="/employee/basic/import">
                        <el-button type="success" 
                                   :icon="importDataBtnIcon" 
                                   :disabled="importDataDisabled">
                            {{ importDataBtnText }}
                        </el-button>
                    </el-upload>
                    <el-button @click="exportData" type="success" icon="el-icon-download">
                        导出数据
                    </el-button><el-button type="primary" 
                                           icon="el-icon-plus" 
                                           @click="showAddEmpView">
                        添加员工
                    </el-button>
                </div>
            </div>
        </div>
        <!-- 高级搜索框 -->
        <div v-show="showAdvanceSearchVisible" 
             style="border:1px solid #409eff;border-radius:5px;box-sizing: border-box;padding: 5px;margin: 10px 0px;">
            <el-row>
                <el-col :span="5">
                    政治面貌:
                    <el-select v-model="searchValue.politicId" 
                               placeholder="政治面貌" 
                               size="mini" 
                               style="width:150px">
                        <el-option v-for="item in politicsstatus" 
                                   :key="item.id" 
                                   :label="item.name" 
                                   :value="item.id">
                        </el-option>
                    </el-select>
                </el-col>
                <el-col :span="4">
                    民族:
                    <el-select v-model="searchValue.nationId" 
                               placeholder="民族" 
                               size="mini" 
                               style="width:150px">
                        <el-option v-for="item in nations" 
                                   :key="item.id" 
                                   :label="item.name" 
                                   :value="item.id">
                        </el-option>
                    </el-select>
                </el-col>
                <el-col :span="4">
                    职位:
                    <el-select v-model="searchValue.posId" 
                               placeholder="职位" 
                               size="mini" 
                               style="width:150px">
                        <el-option v-for="item in positions" 
                                   :key="item.id" 
                                   :label="item.name" 
                                   :value="item.id">
                        </el-option>
                    </el-select>
                </el-col>
                <el-col :span="4">
                    职称:
                    <el-select v-model="searchValue.jobLevelId" 
                               placeholder="职称" 
                               size="mini" 
                               style="width:150px">
                        <el-option v-for="item in joblevels" 
                                   :key="item.id" 
                                   :label="item.name" 
                                   :value="item.id">
                        </el-option>
                    </el-select>
                </el-col>
                <el-col :span="7">
                    聘用形式:
                    <el-radio-group v-model="searchValue.engageForm">
                        <el-radio label="劳动合同">劳动合同</el-radio>
                        <el-radio label="劳务合同">劳务合同</el-radio>
                    </el-radio-group>
                </el-col>
            </el-row>
            <el-row style="margin-top:10px">
                <el-col :span="5">
                    所属部门:
                    <el-popover placement="right" 
                                title="请选择部门" 
                                width="200" 
                                trigger="manual" 
                                v-model="visible2">
                        <el-tree default-expand-all 
                                 :data="allDeps" 
                                 :props="defaultProps"
                            	 @node-click="searchHandleNodeClick">
    					</el-tree>
                        <div style="width:140px;display:inline-flex;border:1px solid #dedede;height:25px;border-radius: 5px;cursor:pointer;font-size: 13px;padding-left: 8px; box-sizing=border-box"
                            
                             slot="reference" 
                             @click="showDepView2">
                            {{ inputDepName }}
                        </div>
                    </el-popover>
                </el-col>
                <el-col :span="10">
                    入职日期:
                    <el-date-picker v-model="searchValue.beginDateScope" 
                                    value-format="yyyy-MM-dd" 
                                    unlink-panels 
                                    type="daterange" 
                                    size="mini" 
                                    range-separator="至" 
                                    start-placeholder="开始日期"
                        			end-placeholder="结束日期">
                    </el-date-picker>
                </el-col>
                <el-col :span="5" :offset="4">
                    <el-button size="mini" @click="clearSearch">取消</el-button>
                    <el-button size="mini" 
                               icon="el-icon-search" 
                               type="primary" 
                               @click="initEmps('advanced')">
                        搜索
    				</el-button>
                </el-col>
            </el-row>
        </div>
        <!--表格-->
        <div style="margin-top: 10px;">
            <el-table :data="emps" 
                      stripe border 
                      style="width: 100%" 
                      v-loading="loading"
                      element-loading-text="正在加载员工数据..." 
                      element-loading-spinner="el-icon-loading"
                	  element-loading-background="rgba(0, 0, 0, 0.8)">
                <el-table-column type="selection" width="55">
                </el-table-column>
                <el-table-column prop="name" label="姓名" align="left" width="70" fixed>
                </el-table-column>
                <el-table-column prop="workID" label="工号" align="left" width="85">
                </el-table-column>
                <el-table-column prop="gender" label="性别" align="left" width="50">
                </el-table-column>
                <el-table-column prop="birthday" label="出生日期" align="left" width="95">
                </el-table-column>
                <el-table-column prop="idCard" label="身份证号码" align="left" width="150">
                </el-table-column>
                <el-table-column prop="wedlock" label="婚姻状况" align="left" width="70">
                </el-table-column>
                <el-table-column prop="nation.name" label="民族" align="left" width="50">
                </el-table-column>
                <el-table-column prop="nativePlace" label="籍贯" align="left" width="80">
                </el-table-column>
                <el-table-column prop="politicsStatus.name" label="政治面貌" align="left" width="100">
                </el-table-column>
                <el-table-column prop="email" label="电子邮件" align="left" width="160">
                </el-table-column>
                <el-table-column prop="phone" label="电话号码" align="left" width="100">
                </el-table-column>
                <el-table-column prop="address" label="联系地址" align="left" width="220">
                </el-table-column>
                <el-table-column prop="email" label="电子邮件" align="left" width="180">
                </el-table-column>
                <el-table-column prop="department.name" label="所属部门" align="left" width="100">
                </el-table-column>
                <el-table-column prop="joblevel.name" label="职称" align="left" width="100">
                </el-table-column>
                <el-table-column prop="position.name" label="职位" align="left" width="100">
                </el-table-column>
                <el-table-column prop="engageForm" label="聘用形式" align="left" width="100">
                </el-table-column>
                <el-table-column prop="tiptopDegree" label="最高学历" align="left" width="80">
                </el-table-column>
                <el-table-column prop="school" label="学校" align="left" width="150">
                </el-table-column>
                <el-table-column prop="specialty" label="专业" align="left" width="150">
                </el-table-column>
                <el-table-column prop="beginDate" label="入职日期" align="left" width="95">
                </el-table-column>
                <el-table-column prop="conversionTime" label="转正日期" align="left" width="95">
                </el-table-column>
                <el-table-column prop="beginContract" label="合同起始日期" align="left" width="95">
                </el-table-column>
                <el-table-column prop="endContract" label="合同截至日期" align="left" width="95">
                </el-table-column>
                <el-table-column label="合同期限" align="left" width="80">
                    <template slot-scope="scope">
                        <el-tag>{{ scope.row.contractTerm }}</el-tag>年
                    </template>
                </el-table-column>
                <el-table-column label="操作" width="180" fixed="right">
                    <template slot-scope="scope">
                        <el-button style="padding:1px" size="mini" 
                                   @click="showEditEmpView(scope.row)">
                            编辑
                        </el-button>
                        <el-button style="padding:1px" size="mini" 
                                   type="primary">
                            查看高级资料
                        </el-button>
                        <el-button style="padding:1px" size="mini" 
                                   type="danger"
                            	   @click="deleteEmp(scope.row)">
                            删除
                        </el-button>
                    </template>
                </el-table-column>
            </el-table>
            <!-- 分页插件 -->
            <div style="display:flex;justify-content:flex-end;margin-top: 10px;">
                <el-pagination background @current-change="currentChange" 
                               @size-change="sizeChange"
                               layout="sizes, prev, pager, next, jumper, ->, total"
                               :total="total">
                </el-pagination>
            </div>
        </div>
        <!-- 添加或者更新对话框 -->
        <el-dialog :title="title" :visible.sync="dialogVisible" width="80%">
            <div>
                <el-form ref="empForm" :model="emp" :rules="rules">
                    <el-row>
                        <el-col :span="6">
                            <el-form-item label="姓名:" prop="name">
                                <el-input size="mini" style="width:150px" 
                                          prefix-icon="el-icon-edit" 
                                          v-model="emp.name"
                                          placeholder="请输入员工姓名..."></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="性别:" prop="gender">
                                <el-radio-group v-model="emp.gender">
                                    <el-radio label="男">男</el-radio>
                                    <el-radio label="女">女</el-radio>
                                </el-radio-group>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="出生日期:" prop="birthday">
                                <el-date-picker v-model="emp.birthday" 
                                                type="date" size="mini" 
                                                value-format="yyyy-MM-dd"
                                                placeholder="出生日期" 
                                                style="width:150px">
                                </el-date-picker>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="政治面貌:" prop="politicId">
                                <el-select v-model="emp.politicId" 
                                           placeholder="政治面貌" size="mini" 
                                           style="width:150px">
                                    <el-option v-for="item in politicsstatus" 
                                               :key="item.id" 
                                               :label="item.name"
                                        	   :value="item.id">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <el-row>
                        <el-col :span="6">
                            <el-form-item label="民族:" prop="nationId">
                                <el-select v-model="emp.nationId" 
                                           placeholder="民族" 
                                           size="mini" style="width:150px">
                                    <el-option v-for="item in nations" 
                                               :key="item.id" :label="item.name"
                                        :value="item.id">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="籍贯:" prop="nativePlace">
                                <el-input size="mini" style="width:150px" 
                                          prefix-icon="el-icon-edit"
                                    	  v-model="emp.nativePlace" 
                                          placeholder="请输入员工籍贯...">
                                </el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="电子邮箱:" prop="email">
                                <el-input size="mini" style="width:150px" 
                                          prefix-icon="el-icon-message"
                                          v-model="emp.email" 
                                          placeholder="请输入电子邮箱...">
                                </el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="联系地址:" prop="address">
                                <el-input size="mini" style="width:150px" 
                                          prefix-icon="el-icon-edit"
                                          v-model="emp.address" 
                                          placeholder="请输入联系地址...">
                                </el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <el-row>
                        <el-col :span="6">
                            <el-form-item label="职位:" prop="posId">
                                <el-select v-model="emp.posId" 
                                           placeholder="职位" 
                                           size="mini" style="width:150px">
                                    <el-option v-for="item in positions" 
                                               :key="item.id" :label="item.name"
                                        :value="item.id">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="职称:" prop="jobLevelId">
                                <el-select v-model="emp.jobLevelId" 
                                           placeholder="职称" 
                                           size="mini" style="width:150px">
                                    <el-option v-for="item in joblevels" 
                                               :key="item.id" :label="item.name"
                                        :value="item.id">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="所属部门:" prop="departmentId">
                                <el-popover placement="right" 
                                            title="请选择部门" 
                                            width="200" 
                                            trigger="manual"
                                    		v-model="visible">
                                    <el-tree default-expand-all 
                                             :data="allDeps" 
                                             :props="defaultProps"
                                        	 @node-click="handleNodeClick"></el-tree>
                                    <div style="width:140px;display:inline-flex;border:1px solid #dedede;height:27px;border-radius: 5px;margin-top: 2px;cursor:pointer;align-items: center;font-size: 13px;padding-left: 8px; box-sizing=border-box"
                                         slot="reference" 
                                         @click="showDepView">{{ inputDepName }}
                                    </div>
                                </el-popover>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="电话号码:" prop="phone">
                                <el-input size="mini" style="width:150px" 
                                          prefix-icon="el-icon-phone"
                                          v-model="emp.phone" 
                                          placeholder="请输入电话号码...">
                                </el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <el-row>
                        <el-col :span="6">
                            <el-form-item label="工号:" prop="workID">
                                <el-input disabled size="mini" style="width:150px" 
                                          prefix-icon="el-icon-edit"
                                          v-model="emp.workID" placeholder="请输入工号...">
                                </el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="学历:" prop="tiptopDegree">
                                <el-select v-model="emp.tiptopDegree" placeholder="学历"
                                           size="mini" style="width:150px">
                                    <el-option v-for="item in tiptopDegrees" :key="item"
                                               :label="item" :value="item">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="毕业院校:" prop="school">
                                <el-input size="mini" style="width:150px" 
                                          prefix-icon="el-icon-edit"
                                          v-model="emp.school" 
                                          placeholder="请输入毕业院校...">
                                </el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="专业名称:" prop="specialty">
                                <el-input size="mini" style="width:150px" 
                                          prefix-icon="el-icon-edit"
                                          v-model="emp.specialty" 
                                          placeholder="请输入专业名称...">
                                </el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <el-row>
                        <el-col :span="6">
                            <el-form-item label="入职日期:" prop="beginDate">
                                <el-date-picker v-model="emp.beginDate" 
                                                type="date" size="mini"
                                                value-format="yyyy-MM-dd" 
                                                placeholder="入职日期" 
                                                style="width:150px">
                                </el-date-picker>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="转正日期:" prop="conversionTime">
                                <el-date-picker v-model="emp.conversionTime" 
                                                type="date" size="mini"
                                    			value-format="yyyy-MM-dd" 
                                                placeholder="转正日期" 
                                                style="width:150px">
                                </el-date-picker>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="合同起始日期:" prop="beginContract">
                                <el-date-picker v-model="emp.beginContract" 
                                                type="date" size="mini"
                                    			value-format="yyyy-MM-dd" 
                                                placeholder="合同起始日期" 
                                                style="width:150px">
                                </el-date-picker>
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-form-item label="合同截止日期:" prop="endContract">
                                <el-date-picker v-model="emp.endContract" 
                                                type="date" size="mini"
                                    			value-format="yyyy-MM-dd" 
                                                placeholder="合同截止日期" 
                                                style="width:150px">
                                </el-date-picker>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <el-row>
                        <el-col :span="8">
                            <el-form-item label="身份证号码:" prop="idCard">
                                <el-input size="mini" style="width:180px" 
                                          prefix-icon="el-icon-edit"
                                    	  v-model="emp.idCard" 
                                          placeholder="请输入身份证号码...">
                                </el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="聘用形式:" prop="engageForm">
                                <el-radio-group v-model="emp.engageForm">
                                    <el-radio label="劳动合同">劳动合同</el-radio>
                                    <el-radio label="劳务合同">劳务合同</el-radio>
                                </el-radio-group>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="婚姻状况:" prop="wedlock">
                                <el-radio-group v-model="emp.wedlock">
                                    <el-radio label="已婚">已婚</el-radio>
                                    <el-radio label="未婚">未婚</el-radio>
                                    <el-radio label="离异">离异</el-radio>
                                </el-radio-group>
                            </el-form-item>
                        </el-col>
                    </el-row>
                </el-form>
            </div>
            <span slot="footer" class="dialog-footer">
                <el-button @click="dialogVisible = false">取 消</el-button>
                <el-button type="primary" @click="doAddEmp">确 定</el-button>
            </span>
        </el-dialog>
    </div>
</template>

<script>

export default {
    name: 'EmpBasic',
    data() {
        return {
            //后端查询的员工对象数据列表
            emps: [],
            //加载动画开启开关
            loading: false,
            //总页数
            total: 0,
            //页码
            currentPage: 1,
            //每页数据量
            size: 10,
            //搜索用员工名
            empName: '',
            //dialog对话框是否弹出
            dialogVisible: false,
            //存放所有民族对象
            nations: [],
            //存放所有职称对象
            joblevels: [],
            //存放所有政治面貌对象
            politicsstatus: [],
            //存放所有职位对象
            positions: [],
            //学历数组对象
            tiptopDegrees: ['博士', '硕士', '本科', '大专', '高中', '初中', '小学', '其他'],
            //所属部门对话框是否弹出
            visible: false,
            //高级搜索中所属部门对话框是否弹出
            visible2: false,
            //所属部门树形控件展示的属性
            defaultProps: {
                children: 'children',
                label: 'name'
            },
            //所属部门树形控件展示数据
            allDeps: [],
            //所属部门回显数据
            inputDepName: '',
            //导入数据按钮显示文字
            importDataBtnText: '导入数据',
            //导入数据按钮显示图标
            importDataBtnIcon: 'el-icon-upload2',
            //导入数据禁用
            importDataDisabled: false,
            //导入数据请求头
            headers: {
                Authorization: window.sessionStorage.getItem('tokenStr')
            },
            //高级搜索框是否展开
            showAdvanceSearchVisible:false,
            //高级搜索对象
            searchValue:{
                politicId: null,
                nationId: null,
                jobLevelId: null,
                posId: null,
                engageForm: '',
                departmentId: null,
                beginDateScope: null,
            },
            //表单对象
            emp: {
                id: null,
                name: '',
                gender: '',
                birthday: '',
                idCard: '',
                wedlock: '',
                nationId: null,
                nativePlace: '',
                politicId: null,
                email: '',
                phone: '',
                address: '',
                departmentId: null,
                jobLevelId: null,
                posId: null,
                engageForm: '',
                tiptopDegree: '',
                specialty: '',
                school: '',
                beginDate: '',
                workState: '在职',
                workID: '',
                contractTerm: null,
                conversionTime: '',
                notWorkDate: null,
                beginContract: '',
                endContract: '',
                workAge: null,
                salaryId: null,
                salary: null
            },
            //表达名称
            title: '',
            //数据校验规则
            rules: {
                name: [{ required: true, message: '请输入员工名', trigger: 'blur' }],
                gender: [{ required: true, message: '请输入员工性别', trigger: 'blur' }],
                birthday: [{ required: true, message: '请输入出生日期', trigger: 'blur' }],
                idCard: [{ required: true, message: '请输入身份证号码', trigger: 'blur' }, { pattern: /(^([1-6][1-9]|50)\d{4}(18|19|20)\d{2}((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$)|(^([1-6][1-9]|50)\d{4}\d{2}((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d{3}$)/, message: '身份证号码不正确', trigger: 'blur' }],
                wedlock: [{ required: true, message: '请输入婚姻状况', trigger: 'blur' }],
                nationId: [{ required: true, message: '请输入民族', trigger: 'blur' }],
                nativePlace: [{ required: true, message: '请输入籍贯', trigger: 'blur' }],
                politicId: [{ required: true, message: '请输入政治面貌', trigger: 'blur' }],
                email: [{ required: true, message: '请输入邮箱地址', trigger: 'blur' }, { type: "email", message: '邮箱地址格式不正确', trigger: 'blur' }],
                phone: [{ required: true, message: '请输入电话号码', trigger: 'blur' }],
                address: [{ required: true, message: '请输入通讯地址', trigger: 'blur' }],
                departmentId: [{ required: true, message: '请输入所属部门', trigger: 'blur' }],
                jobLevelId: [{ required: true, message: '请输入职称', trigger: 'blur' }],
                posId: [{ required: true, message: '请输入职位', trigger: 'blur' }],
                engageForm: [{ required: true, message: '请输入聘用形式', trigger: 'blur' }],
                tiptopDegree: [{ required: true, message: '请输学历', trigger: 'blur' }],
                specialty: [{ required: true, message: '请输入专业', trigger: 'blur' }],
                school: [{ required: true, message: '请输入毕业院校', trigger: 'blur' }],
                beginDate: [{ required: true, message: '请输入入职日期', trigger: 'blur' }],
                workState: [{ required: true, message: '请输入工作状态', trigger: 'blur' }],
                workID: [{ required: true, message: '请输入工号', trigger: 'blur' }],
                contractTerm: [{ required: true, message: '请输入合同期限', trigger: 'blur' }],
                conversionTime: [{ required: true, message: '请输入转正日期', trigger: 'blur' }],
                notWorkDate: [{ required: true, message: '请输入离职日期', trigger: 'blur' }],
                beginContract: [{ required: true, message: '请输入合同起始日期', trigger: 'blur' }],
                endContract: [{ required: true, message: '请输入合同结束日期', trigger: 'blur' }],
                // workAge:[{required:true,message:'请输入工龄',trigger:'blur'}],
            }
        }
    },
    mounted() {
        this.initEmps();
        this.initData();
        this.initPositions();
    },
    methods: {
        //清空高级搜索
        clearSearch(){
            this.searchValue.politicId= null,
            this.searchValue.nationId= null,
            this.searchValue.jobLevelId= null,
            this.searchValue.posId= null,
            this.searchValue.engageForm= '',
            this.searchValue.departmentId= null,
            this.searchValue.beginDateScope= null
        },
        //弹出高级搜索部门菜单
        showDepView2(){
            this.visible2 = !this.visible2;
        },
        //高级搜索中点击选择部门
        searchHandleNodeClick(data){
            this.inputDepName = data.name;
            this.searchValue.departmentId = data.id;
            this.visible2 = !this.visible2;
        },
        //导入数据成功回调函数
        onSuccess() {
            this.importDataBtnIcon = 'el-icon-upload2';
            this.importDataBtnText = '导入数据';
            this.importDataDisabled = false;
            this.initEmps();
        },
        //导入数据失败回调函数
        onError() {
            this.importDataBtnIcon = 'el-icon-upload2';
            this.importDataBtnText = '导入数据';
            this.importDataDisabled = false;
        },
        //导入数据图标变化函数
        beforeUpload() {
            this.importDataBtnIcon = 'el-icon-loading';
            this.importDataBtnText = '正在导入';
            this.importDataDisabled = true;
        },
        //导出员工数据
        exportData() {
            this.downloadRequest('/employee/basic/export');
        },
        //弹出编辑对话框
        showEditEmpView(data) {
            this.title = "编辑员工";
            this.emp = data;
            this.inputDepName = data.department.name;
            this.initPositions();
            this.dialogVisible = true;
        },
        //根据id删除员工
        deleteEmp(data) {
            this.$confirm('此操作将永久删除[' + data.name + '], 是否继续?', '提示', {
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {
                this.deleteRequest('/employee/basic/' + data.id).then(resp => {
                    if (resp) {
                        this.initEmps();
                    }
                });
            }).catch(() => {
                this.$message({
                    type: 'info',
                    message: '已取消删除'
                });
            });
        },
        //点击添加员工
        doAddEmp() {
            if (this.emp.id) {
                this.$refs['empForm'].validate(valid => {
                    if (valid) {
                        this.putRequest('/employee/basic/', this.emp).then(resp => {
                            if (resp) {
                                this.dialogVisible = false;
                                this.initEmps();
                            }
                        })
                    }
                })
            } else {
                this.$refs['empForm'].validate(valid => {
                    if (valid) {
                        this.postRequest('/employee/basic/', this.emp).then(resp => {
                            if (resp) {
                                this.dialogVisible = false;
                                this.initEmps();
                            }
                        })
                    }
                })
            }

        },
        //节点点击事件，参数data是节点数据
        handleNodeClick(data) {
            this.emp.departmentId = data.id;
            this.inputDepName = data.name;
            this.visible = !this.visible;
        },
        //点击显示所属部门
        showDepView() {
            this.visible = !this.visible;
        },
        //获取最大工号，打开添加员工对话框时调用
        getMaxWorkID() {
            this.getRequest('/employee/basic/maxWorkID').then(resp => {
                if (resp) {
                    this.emp.workID = resp.obj;
                }
            })
        },
        //初始化获取所有职位数据信息，打开添加员工对话框时调用
        initPositions() {
            this.getRequest('/employee/basic/positions').then(resp => {
                if (resp) {
                    this.positions = resp;
                }
            })
        },
        //初始化不怎么变动的数据（政治面貌、民族、职称、所属部门），并放在sessionStorage中
        initData() {
            if (!window.sessionStorage.getItem('nations')) {
                this.getRequest('/employee/basic/nations').then(resp => {
                    if (resp) {
                        this.nations = resp;
                        window.sessionStorage.setItem('nations', JSON.stringify(resp));
                    }
                })
            } else {
                this.nations = JSON.parse(window.sessionStorage.getItem('nations'));
            }
            if (!window.sessionStorage.getItem('joblevels')) {
                this.getRequest('/employee/basic/joblevels').then(resp => {
                    if (resp) {
                        this.joblevels = resp;
                        window.sessionStorage.setItem('joblevels', JSON.stringify(resp));
                    }
                })
            } else {
                this.joblevels = JSON.parse(window.sessionStorage.getItem('joblevels'));
            }
            if (!window.sessionStorage.getItem('politicsstatus')) {
                this.getRequest('/employee/basic/politicsstatus').then(resp => {
                    if (resp) {
                        this.politicsstatus = resp;
                        window.sessionStorage.setItem('politicsstatus', JSON.stringify(resp));
                    }
                })
            } else {
                this.politicsstatus = JSON.parse(window.sessionStorage.getItem('politicsstatus'));
            }
            if (!window.sessionStorage.getItem('allDeps')) {
                this.getRequest('/employee/basic/deps').then(resp => {
                    if (resp) {
                        this.allDeps = resp;
                        window.sessionStorage.setItem('allDeps', JSON.stringify(resp));
                    }
                });
            } else {
                this.allDeps = JSON.parse(window.sessionStorage.getItem('allDeps'));
            }
        },
        //打开添加员工的对话框
        showAddEmpView() {
            this.title = '添加员工';
            this.emp = {
                id: null,
                name: '',
                gender: '',
                birthday: '',
                idCard: '',
                wedlock: '',
                nationId: null,
                nativePlace: '',
                politicId: null,
                email: '',
                phone: '',
                address: '',
                departmentId: null,
                jobLevelId: null,
                posId: null,
                engageForm: '',
                tiptopDegree: '',
                specialty: '',
                school: '',
                beginDate: '',
                workState: '在职',
                workID: '',
                contractTerm: null,
                conversionTime: '',
                notWorkDate: null,
                beginContract: '',
                endContract: '',
                workAge: null,
                salaryId: null,
                salary: null
            };
            this.inputDepName = '';
            this.getMaxWorkID();
            this.initPositions();
            this.dialogVisible = true;
        },
        //页码改变函数，参数currentPage（页码）在点击时会自动带过来
        currentChange(currentPage) {
            this.currentPage = currentPage;
            this.initEmps();
        },
        //每页数据量改变函数，参数size（每页数据量）在点击时会自动带过来
        sizeChange(size) {
            this.size = size;
            this.initEmps();
        },
        //初始化查询所有员工数据，获取分页的总条数以及第一页的所有数据
        initEmps(type) {
            this.loading = true;
            //定义url
            let url = '/employee/basic/?currentPage=' + this.currentPage + '&size=' + this.size;
            if(type && type=='advanced'){
                if(this.searchValue.politicId){
                    url += '&politicId='+this.searchValue.politicId;
                }
                if(this.searchValue.nationId){
                    url += '&nationId='+this.searchValue.nationId;
                }
                if(this.searchValue.posId){
                    url += '&posId='+this.searchValue.posId;
                }
                if(this.searchValue.jobLevelId){
                    url += '&jobLevelId='+this.searchValue.jobLevelId;
                }
                if(this.searchValue.engageForm){
                    url += '&engageForm='+this.searchValue.engageForm;
                }
                if(this.searchValue.departmentId){
                    url += '&departmentId='+this.searchValue.departmentId;
                }
                if(this.searchValue.beginDateScope){
                    url += '&beginDateScope='+this.searchValue.beginDateScope;
                }
            }else{
                url += '&name=' + this.empName;
            }


            this.getRequest(url).then(resp => {
                this.loading = false;
                if (resp) {
                    this.emps = resp.data;
                    this.total = resp.total;
                }
            })
        }
    }
};
</script>

<style scoped>

</style>
```

## 12、工资账套功能实现

`src\views\sal\SalSob.vue`

```vue
<template>
    <div>
        <div style="display:flex;justify-content:space-between">
            <!-- 工具类 -->
            <el-button type="primary" icon="el-icon-plus" @click="showAddSalaryView">
                添加工资账套
    		</el-button>
            <el-button type="success" icon="el-icon-refresh" @click="initSalaries">
    		</el-button>
        </div>
        <div style="margin-top: 10px;">
            <el-table :data="salaries"
                      border
                      stripe>
                <el-table-column type="selection" width="40">
                </el-table-column>
                <el-table-column prop="name" label="账套名称" width="120">
    			</el-table-column>
                <el-table-column prop="basicSalary" label="基本工资" width="70">
    			</el-table-column>
                <el-table-column prop="trafficSalary" label="交通补助" width="70">
    			</el-table-column>
                <el-table-column prop="lunchSalary" label="午餐补助" width="70">
    			</el-table-column>
                <el-table-column prop="bonus" label="奖金" width="70">
    			</el-table-column>
                <el-table-column prop="createDate" label="启用时间" width="100">
    			</el-table-column>
                <el-table-column label="养老金" align="center">
                    <el-table-column prop="pensionPer" label="比率" width="70">
                    </el-table-column>
                    <el-table-column prop="pensionBase" label="基数" width="70">
                    </el-table-column>
                </el-table-column>
                <el-table-column label="医疗保险" align="center">
                    <el-table-column prop="medicalPer" label="比率" width="70">
                    </el-table-column>
                    <el-table-column prop="medicalBase" label="基数" width="70">
                    </el-table-column>
                </el-table-column>
                <el-table-column label="公积金" align="center">
                    <el-table-column prop="accumulationFundPer" label="比率" width="70">
                    </el-table-column>
                    <el-table-column prop="accumulationFundBase" label="基数" width="70">
                    </el-table-column>
                </el-table-column>
                <el-table-column label="操作">
                    <template slot-scope="scope">
                        <el-button type="primary" @click="showEditSalaryView(scope.row)">
                            编辑
    					</el-button>
                        <el-button type="danger" @click="deleteSalary(scope.row)">
                            删除
    					</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </div>
        <el-dialog
            :title="title"
            :visible.sync="dialogVisible"
            width="50%">
            <div style="display:flex;justify-content: space-around;align-items: center;">
                <!-- 步骤条组件 -->
                <el-steps direction="vertical" :active="activeItemIndex">
                    <el-step :title="itemName" 
                             v-for="(itemName,index) in salaryItemName" :key="index">
                    </el-step>
                </el-steps>
                <el-input v-model="salary[title]" 
                          :placeholder="'请输入'+salaryItemName[index]+'...'" 
                          v-for="(value,title,index) in salary" :key="index" 
                          v-show="activeItemIndex==index" style="width:200px">
                </el-input>
            </div>
            <span slot="footer" class="dialog-footer">
                <el-button @click="preStep">
                    {{ activeItemIndex==10 ? '取消' : '上一步' }}
                </el-button>
                <el-button type="primary" @click="nextStep">
                    {{ activeItemIndex==10 ? '完成' : '下一步' }}
                </el-button>
            </span>
        </el-dialog>
    </div>
</template>

<script>
export default {
    name: 'SalSob',
    data(){
        return{
            //对话框的名称
            title:'',
            //添加工资账套的对象，注意要和循环的列名对应上
            salary:{
                name:'',
                basicSalary:0,
                trafficSalary:0,
                lunchSalary:0,
                bonus:0,
                pensionPer:0,
                pensionBase:0,
                medicalPer:0,
                medicalBase:0,
                accumulationFundPer:0,
                accumulationFundBase:0,
            },
            //步骤条组件激活对象
            activeItemIndex:0,
            //要循环的列名
            salaryItemName:[
                '账套名称',
                '基本工资',
                '交通补助',
                '午餐补助',
                '奖金',
                '养老金比率',
                '养老金基数',
                '医疗保险比率',
                '医疗保险基数',
                '公积金比率',
                '公积金基数',
            ],
            //添加工资账套对话框开关控制
            dialogVisible:false,
            //表格展示的数组
            salaries:[],
        }
    },
    mounted(){
        this.initSalaries();
    },
    methods:{
        //编辑其中一行的数据
        showEditSalaryView(data){
            this.title="编辑工资账套";
            this.activeItemIndex=0;
            this.salary.id=data.id;
            this.salary.name=data.name;
            this.salary.basicSalary=data.basicSalary;
            this.salary.trafficSalary=data.trafficSalary;
            this.salary.lunchSalary=data.lunchSalary;
            this.salary.bonus=data.bonus;
            this.salary.pensionPer=data.pensionPer;
            this.salary.pensionBase=data.pensionBase;
            this.salary.medicalPer=data.medicalPer;
            this.salary.medicalBase=data.medicalBase;
            this.salary.accumulationFundPer=data.accumulationFundPer;
            this.salary.accumulationFundBase=data.accumulationFundBase;
            this.dialogVisible = true;
        },
        //删除其中一行的数据
        deleteSalary(data){
            this.$confirm('此操作将永久删除[' + data.name + ']工资账套, 是否继续?', '提示', {
                confirmButtonText: '确定',
                cancelButtonText: '取消',
                type: 'warning'
            }).then(() => {
                this.deleteRequest('/salary/sob/' + data.id).then(resp => {
                    if (resp) {
                        this.initSalaries();
                    }
                });
            }).catch(() => {
                this.$message({
                    type: 'info',
                    message: '已取消删除'
                });
            });
        },
        //上一步
        preStep(){
            if(this.activeItemIndex == 10){
                this.dialogVisible=false;
                return;
            }
            if(this.activeItemIndex==0){
                return;
            }
            this.activeItemIndex--;
        },
        //下一步(最后一步是添加或者更新)
        nextStep(){
            if(this.activeItemIndex == 10){
                if(this.salary.id){
                    this.putRequest('/salary/sob/',this.salary).then(resp=>{
                        if(resp){
                            this.initSalaries();
                            this.dialogVisible = false;
                        }
                    })
                }else{
                    this.postRequest('/salary/sob/',this.salary).then(resp=>{
                        if(resp){
                            this.initSalaries();
                            this.dialogVisible = false;
                        }
                    })
                }
                return
            }
            this.activeItemIndex++;
        },
        //点击打开添加工资账套对话框
        showAddSalaryView(){
            this.title="添加工资账套"
            this.salary={
                name:'',
                basicSalary:0,
                trafficSalary:0,
                lunchSalary:0,
                bonus:0,
                pensionPer:0,
                pensionBase:0,
                medicalPer:0,
                medicalBase:0,
                accumulationFundPer:0,
                accumulationFundBase:0,
            },
            this.activeItemIndex=0;
            this.dialogVisible=true;
        },
        //初始化获取所有的工资账套
        initSalaries(){
            this.getRequest('/salary/sob/').then(resp=>{
                if(resp){
                    this.salaries=resp;
                }
            })
        }
    }
};
</script>

<style scoped>

</style>
```

## 13、员工账套功能实现

`src\views\sal\SalSobCfg.vue`

```vue
<template>
    <div>
        <el-table :data="emps" border stripe>
            <el-table-column type="selection" align="left" width="55">
            </el-table-column>
            <el-table-column prop="name" label="姓名" align="left" fixed width="120">
            </el-table-column>
            <el-table-column prop="workID" label="工号" align="left" width="120">
            </el-table-column>
            <el-table-column prop="email" label="电子邮箱" align="left" width="200">
            </el-table-column>
            <el-table-column prop="phone" label="电话号码" align="left" width="120">
            </el-table-column>
            <el-table-column prop="department.name" label="所属部门" align="left" width="120">
            </el-table-column>
            <el-table-column label="工资账套" align="center" width="150">
                <template slot-scope="scope">
                    <el-tooltip placement="right" v-if="scope.row.salary">
                        <div slot="content">
                            <table>
                                <tr>
                                    <td>基本工资</td>
                                    <td>{{ scope.row.salary.basicSalary }}</td>
                                </tr>
                                <tr>
                                    <td>交通补助</td>
                                    <td>{{ scope.row.salary.trafficSalary }}</td>
                                </tr>
                                <tr>
                                    <td>午餐补助</td>
                                    <td>{{ scope.row.salary.lunchSalary }}</td>
                                </tr>
                                <tr>
                                    <td>养老金比率</td>
                                    <td>{{ scope.row.salary.pensionPer }}</td>
                                </tr>
                                <tr>
                                    <td>养老金基数</td>
                                    <td>{{ scope.row.salary.pensionBase }}</td>
                                </tr>
                                <tr>
                                    <td>医疗保险比率</td>
                                    <td>{{ scope.row.salary.medicalPer }}</td>
                                </tr>
                                <tr>
                                    <td>医疗保险基数</td>
                                    <td>{{ scope.row.salary.medicalBase }}</td>
                                </tr>
                                <tr>
                                    <td>公积金比率</td>
                                    <td>{{ scope.row.salary.accumulationFundPer }}</td>
                                </tr>
                                <tr>
                                    <td>公积金基数</td>
                                    <td>{{ scope.row.salary.accumulationFundBase }}</td>
                                </tr>
                            </table>
                        </div>
                        <el-tag >{{ scope.row.salary.name }}</el-tag>
                    </el-tooltip>
                    <el-tag v-else>暂未设置</el-tag>
                </template>
            </el-table-column>
            <el-table-column label="操作" align="center" width="150">
                <template slot-scope="scope">
                    <el-popover
                        placement="left"
                        title="编辑工资账套"
                        @show="showPop(scope.row.salary)"
                        @hide="hidePop(scope.row)"
                        width="200"
                        trigger="click">
                        <div>
                            <el-select v-model="currentSalary" placeholder="请选择">
                                <el-option
                                    v-for="item in salaries"
                                    :key="item.id"
                                    :label="item.name"
                                    :value="item.id">
                                </el-option>
                            </el-select>
                        </div>
                        <el-button slot="reference" type="danger">修改工资账套</el-button>
                    </el-popover>
                </template>
            </el-table-column>
        </el-table>
        <!-- 分页插件 -->
        <div style="display: flex;justify-content: flex-end;margin-top: 10px;">
            <el-pagination
                background
                @current-change="currentChange"
                @size-change="sizeChange"
                layout="sizes, prev, pager, next, jumper, ->, total, slot"
                :total="total">
            </el-pagination>
        </div>
    </div>
</template>

<script>
export default {
    name: 'SalSobCfg',
    data(){
        return{
            //当前工资账套
            currentSalary:null,
            //查询所有工资账套
            salaries:[],
            //初始化查询员工账套信息
            emps:[],
            //默认分页的页码
            currentPage:1,
            //默认分页的行数
            size:10,
            //分页查询的总数据量
            total:0,
        }
    },
    mounted(){
        this.initEmps();
        this.initSalaries();
    },
    methods:{
        //隐藏当行工资账套
        hidePop(data){
            if(this.currentSalary && this.currentSalary!=data.salary.id){
                this.putRequest('/salary/sobcfg/?eid='+data.id+'&sid='+this.currentSalary).then(resp=>{
                    if(resp){
                        this.initEmps();
                    }
                })
            }
        },
        //点击展示当行的工资账套
        showPop(data){
            if(data){
                this.currentSalary=data.id;
            }
            this.currentSalary=null;
        },
        //查询获取所有的工资账套
        initSalaries(){
            this.getRequest('/salary/sobcfg/salaries').then(resp=>{
                if(resp){
                    this.salaries=resp;
                }
            })
        },
        //页码改变方法
        currentChange(page){
            this.currentPage=page;
            this.initEmps();
        },
        //页码显示数据量改变函数
        sizeChange(size){
            this.size=size;
            this.initEmps();
        },
        //初始化员工账套数据
        initEmps(){
            this.getRequest('/salary/sobcfg/?currentPage='+this.currentPage+'&size='+this.size).then(resp=>{
                if(resp){
                    this.emps=resp.data;
                    this.total=resp.total;
                }
            })
        },
    }
};
</script>

<style scoped>

</style>
```

