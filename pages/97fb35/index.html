<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis | 百里登风的博客</title>
    <meta name="generator" content="VuePress 1.9.8">
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e1aa9d15d62220ec692a843c08c79000";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>        
    </script>
    <script src="https://fastly.jsdelivr.net/npm/twikoo@1.5.11/dist/twikoo.all.min.js"></script>
    <script href="./js/index.js" async="async"></script>
    <link rel="icon" href="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/personPhoto.webp">
    <script charset="utf-8" href="./js/main.js"></script>
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <meta name="description" content="张弓折扇风雨历，畅叙平生快意！">
    <meta name="image" content="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111110930965.png">
    <meta name="twitter:title" content="Redis">
    <meta name="twitter:description" content="">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111110930965.png">
    <meta name="twitter:url" content="https://frxcat.fun/05.%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis.html">
    <meta name="twitter:site" content="@frxcat">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Redis">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111110930965.png">
    <meta property="og:url" content="https://frxcat.fun/05.%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis.html">
    <meta property="og:site_name" content="frxcat">
    <meta property="article:published_time" content="2023-02-03T23:21:41.000Z">
    <meta property="article:tag" content="null">
    <meta itemprop="name" content="Redis">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111110930965.png">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="baidu-site-verification" content="code-5aMKYEt9fV">
    <link rel="preload" href="/assets/css/0.styles.79be46fe.css" as="style"><link rel="preload" href="/assets/js/app.bb5e25c9.js" as="script"><link rel="preload" href="/assets/js/2.108e92a1.js" as="script"><link rel="preload" href="/assets/js/66.5ef4606b.js" as="script"><link rel="preload" href="/assets/js/5.73b07204.js" as="script"><link rel="preload" href="/assets/js/13.9b1b1c77.js" as="script"><link rel="preload" href="/assets/js/14.e2f4930c.js" as="script"><link rel="preload" href="/assets/js/9.5b9b4ae3.js" as="script"><link rel="preload" href="/assets/js/10.68c0c324.js" as="script"><link rel="prefetch" href="/assets/js/11.ef1511e2.js"><link rel="prefetch" href="/assets/js/12.da9b2478.js"><link rel="prefetch" href="/assets/js/15.cd646c33.js"><link rel="prefetch" href="/assets/js/16.3ec04fab.js"><link rel="prefetch" href="/assets/js/17.6e9ef9cc.js"><link rel="prefetch" href="/assets/js/18.493ad1ad.js"><link rel="prefetch" href="/assets/js/19.e0f986d5.js"><link rel="prefetch" href="/assets/js/20.b8528c67.js"><link rel="prefetch" href="/assets/js/21.fad22d46.js"><link rel="prefetch" href="/assets/js/22.8b0c4122.js"><link rel="prefetch" href="/assets/js/23.3e372155.js"><link rel="prefetch" href="/assets/js/24.3b7e2a1d.js"><link rel="prefetch" href="/assets/js/25.9a80a2fa.js"><link rel="prefetch" href="/assets/js/26.a83bf322.js"><link rel="prefetch" href="/assets/js/27.592a3fdd.js"><link rel="prefetch" href="/assets/js/28.a8d69689.js"><link rel="prefetch" href="/assets/js/29.bb969429.js"><link rel="prefetch" href="/assets/js/3.c65ee6b2.js"><link rel="prefetch" href="/assets/js/30.7d78332c.js"><link rel="prefetch" href="/assets/js/31.3f6e4842.js"><link rel="prefetch" href="/assets/js/32.b52e67f7.js"><link rel="prefetch" href="/assets/js/33.1a666e7d.js"><link rel="prefetch" href="/assets/js/34.4b8f1385.js"><link rel="prefetch" href="/assets/js/35.87ca92cc.js"><link rel="prefetch" href="/assets/js/36.fc40f016.js"><link rel="prefetch" href="/assets/js/37.be3bf444.js"><link rel="prefetch" href="/assets/js/38.eeafc53c.js"><link rel="prefetch" href="/assets/js/39.f34be6d8.js"><link rel="prefetch" href="/assets/js/4.c0fd3b18.js"><link rel="prefetch" href="/assets/js/40.9791c200.js"><link rel="prefetch" href="/assets/js/41.020877c5.js"><link rel="prefetch" href="/assets/js/42.45c39e58.js"><link rel="prefetch" href="/assets/js/43.d9e8ef5e.js"><link rel="prefetch" href="/assets/js/44.464ccf3b.js"><link rel="prefetch" href="/assets/js/45.cb64e9da.js"><link rel="prefetch" href="/assets/js/46.0c9a8ead.js"><link rel="prefetch" href="/assets/js/47.a2e35d4f.js"><link rel="prefetch" href="/assets/js/48.098763ec.js"><link rel="prefetch" href="/assets/js/49.07c62b3b.js"><link rel="prefetch" href="/assets/js/50.fc5f88a3.js"><link rel="prefetch" href="/assets/js/51.e2f578ac.js"><link rel="prefetch" href="/assets/js/52.9e3e4056.js"><link rel="prefetch" href="/assets/js/53.f916bd38.js"><link rel="prefetch" href="/assets/js/54.e7c11e98.js"><link rel="prefetch" href="/assets/js/55.0e0a561a.js"><link rel="prefetch" href="/assets/js/56.b2f3577e.js"><link rel="prefetch" href="/assets/js/57.9e884be2.js"><link rel="prefetch" href="/assets/js/58.2fac2650.js"><link rel="prefetch" href="/assets/js/59.3b25f511.js"><link rel="prefetch" href="/assets/js/6.ed952e3d.js"><link rel="prefetch" href="/assets/js/60.bf607c06.js"><link rel="prefetch" href="/assets/js/61.d726e61a.js"><link rel="prefetch" href="/assets/js/62.edf6d32a.js"><link rel="prefetch" href="/assets/js/63.e30fdc11.js"><link rel="prefetch" href="/assets/js/64.922b4a17.js"><link rel="prefetch" href="/assets/js/65.9a3b347a.js"><link rel="prefetch" href="/assets/js/67.d90678f1.js"><link rel="prefetch" href="/assets/js/68.91fa461c.js"><link rel="prefetch" href="/assets/js/69.1957f6af.js"><link rel="prefetch" href="/assets/js/7.355266c2.js"><link rel="prefetch" href="/assets/js/70.6ebb8af5.js"><link rel="prefetch" href="/assets/js/71.eee0b217.js"><link rel="prefetch" href="/assets/js/72.39ed8920.js"><link rel="prefetch" href="/assets/js/73.47121ddc.js"><link rel="prefetch" href="/assets/js/74.87a10f99.js"><link rel="prefetch" href="/assets/js/75.0b311495.js"><link rel="prefetch" href="/assets/js/76.268ef349.js"><link rel="prefetch" href="/assets/js/77.58de46fb.js"><link rel="prefetch" href="/assets/js/78.25b31166.js"><link rel="prefetch" href="/assets/js/79.d4ff4d30.js"><link rel="prefetch" href="/assets/js/8.f50cf6d8.js"><link rel="prefetch" href="/assets/js/80.c33be335.js"><link rel="prefetch" href="/assets/js/81.a24132da.js"><link rel="prefetch" href="/assets/js/82.00055c83.js"><link rel="prefetch" href="/assets/js/83.c39146f0.js"><link rel="prefetch" href="/assets/js/84.7c66fe01.js"><link rel="prefetch" href="/assets/js/85.c2a04d1e.js"><link rel="prefetch" href="/assets/js/86.b42a4e19.js"><link rel="prefetch" href="/assets/js/87.bdc4c3c8.js"><link rel="prefetch" href="/assets/js/88.deac45a6.js"><link rel="prefetch" href="/assets/js/89.8f2d6a69.js"><link rel="prefetch" href="/assets/js/90.e5dd302c.js"><link rel="prefetch" href="/assets/js/91.bbe5babf.js"><link rel="prefetch" href="/assets/js/92.74872263.js"><link rel="prefetch" href="/assets/js/93.8b3117a7.js"><link rel="prefetch" href="/assets/js/94.b33e3700.js"><link rel="prefetch" href="/assets/js/95.1ce3db13.js"><link rel="prefetch" href="/assets/js/96.6fda4bae.js">
    <link rel="stylesheet" href="/assets/css/0.styles.79be46fe.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">百里登风的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="散文随笔" class="dropdown-title"><!----> <span class="title" style="display:;">散文随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/00.散文随笔/00.沧桑百年史，爱国西交情.html" class="nav-link">沧桑百年史，爱国西交情</a></li><li class="dropdown-item"><!----> <a href="/00.散文随笔/01.静谧之眼.html" class="nav-link">静谧之眼</a></li><li class="dropdown-item"><!----> <a href="/00.散文随笔/02.承党恩泽，物阜民丰.html" class="nav-link">承党恩泽，物阜民丰</a></li><li class="dropdown-item"><!----> <a href="/00.散文随笔/03.历边海防学院记.html" class="nav-link">历边海防学院记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><!----> <span class="title" style="display:;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/01.Java基础/00.Java基础总结.html" class="nav-link">Java基础总结</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/01.Java开发介绍.html" class="nav-link">Java开发介绍</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/02.Java基础编程.html" class="nav-link">Java基础编程</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/03.方法与数组.html" class="nav-link">方法与数组</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/04.面向对象.html" class="nav-link">面向对象</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/05.异常处理.html" class="nav-link">异常处理</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/06.常用类库API.html" class="nav-link">常用类库API</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/07.文件IO操作.html" class="nav-link">文件IO操作</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/08.集合.html" class="nav-link">集合</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/09.多线程与并发.html" class="nav-link">多线程与并发</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/10.反射与内省.html" class="nav-link">反射与内省</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/11.泛型.html" class="nav-link">泛型</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/12.正则表达式.html" class="nav-link">正则表达式</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/13.枚举.html" class="nav-link">枚举</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/14.注解.html" class="nav-link">注解</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/15.GUI事件处理.html" class="nav-link">GUI事件处理</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/16.网络编程.html" class="nav-link">网络编程</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/17.JVM.html" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/18.JUC.html" class="nav-link">JUC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaWeb" class="dropdown-title"><!----> <span class="title" style="display:;">JavaWeb</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/02.JavaWeb/00.JavaWeb总结.html" class="nav-link">JavaWeb总结</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/01.Servlet.html" class="nav-link">Servlet</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/02.Web项目架构与数据库使用.html" class="nav-link">Web项目架构与数据库使用</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/03.Jsp与Listener.html" class="nav-link">Jsp与Listener</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/04.EL表达式与JSTL标签库.html" class="nav-link">EL表达式与JSTL标签库</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/05.文件的上传与下载.html" class="nav-link">文件的上传与下载</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/06.Web项目延伸完善.html" class="nav-link">Web项目延伸完善</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/07.cookie与session.html" class="nav-link">cookie与session</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/08.Filter与ThreadLocal.html" class="nav-link">Filter与ThreadLocal</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/09.i18n国际化.html" class="nav-link">i18n国际化</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/10.Web项目延伸完善(2).html" class="nav-link">Web项目延伸完善(2)</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><!----> <span class="title" style="display:;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/03.Spring生态/00.Spring.html" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/03.Spring生态/01.SpringMVC.html" class="nav-link">SpringMVC</a></li><li class="dropdown-item"><!----> <a href="/03.Spring生态/02.SpringBoot.html" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/03.Spring生态/03.SpringCloud.html" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/03.Spring生态/04.SpringSecurity.html" class="nav-link">SpringSecurity</a></li><li class="dropdown-item"><!----> <a href="/03.Spring生态/05.SpringSecurity与JWT.html" class="nav-link">SpringSecurity与JWT</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/04.前端/00.Html.html" class="nav-link">Html</a></li><li class="dropdown-item"><!----> <a href="/04.前端/01.Css.html" class="nav-link">Css</a></li><li class="dropdown-item"><!----> <a href="/04.前端/02.JavaScript.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/04.前端/03.jQuery.html" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/04.前端/04.Vue1.md.html" class="nav-link">Vue1</a></li><li class="dropdown-item"><!----> <a href="/04.前端/04.Vue2.html" class="nav-link">Vue2</a></li><li class="dropdown-item"><!----> <a href="/04.前端/06.Vue2项目笔记.html" class="nav-link">Vue2项目笔记</a></li><li class="dropdown-item"><!----> <a href="/04.前端/07.Vue3项目笔记.html" class="nav-link">Vue3项目笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/05.数据库/00.MySQL.html" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/05.数据库/01.Redis.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/05.数据库/02.MyBatis.html" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/05.数据库/03.MyBatisPlus.html" class="nav-link">MyBatisPlus</a></li><li class="dropdown-item"><!----> <a href="/05.数据库/04.tkMapper.html" class="nav-link">tkMapper</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title" style="display:;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/06.工具/00.Linux.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/06.工具/01.Git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/06.工具/02.Maven.html" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/06.工具/03.配置文件.html" class="nav-link">配置文件</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="组件" class="dropdown-title"><!----> <span class="title" style="display:;">组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/07.组件/00.Json与XML.html" class="nav-link">Json与XML</a></li><li class="dropdown-item"><!----> <a href="/07.组件/01.Ajax.html" class="nav-link">Ajax</a></li><li class="dropdown-item"><!----> <a href="/07.组件/02.Log.html" class="nav-link">Log</a></li><li class="dropdown-item"><!----> <a href="/07.组件/03.Swagger.html" class="nav-link">Swagger</a></li><li class="dropdown-item"><!----> <a href="/07.组件/04.RabbitMQ.html" class="nav-link">RabbitMQ</a></li><li class="dropdown-item"><!----> <a href="/07.组件/05.ElasticSearch.html" class="nav-link">ElasticSearch</a></li><li class="dropdown-item"><!----> <a href="/07.组件/06.Gateway.html" class="nav-link">Gateway</a></li><li class="dropdown-item"><!----> <a href="/07.组件/07.分布式锁.html" class="nav-link">分布式锁</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/08.项目/00.云E办/00.云E办后端笔记.html" class="nav-link">云E办后端笔记</a></li><li class="dropdown-item"><!----> <a href="/08.项目/00.云E办/01.云E办前端笔记.html" class="nav-link">云E办前端笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/09.算法/00.算法入门.html" class="nav-link">算法入门</a></li><li class="dropdown-item"><!----> <a href="/09.算法/01.算法基础.html" class="nav-link">算法基础</a></li><li class="dropdown-item"><!----> <a href="/09.算法/02.排序算法.html" class="nav-link">排序算法</a></li><li class="dropdown-item"><!----> <a href="/09.算法/03.二分查找总结.html" class="nav-link">二分查找总结</a></li><li class="dropdown-item"><!----> <a href="/09.算法/04.全排列与子集.html" class="nav-link">全排列与子集</a></li><li class="dropdown-item"><!----> <a href="/09.算法/05.链表翻转.html" class="nav-link">链表翻转</a></li><li class="dropdown-item"><!----> <a href="/09.算法/06.Scanner在ACM模式下应用.html" class="nav-link">Scanner在ACM模式下应用</a></li><li class="dropdown-item"><!----> <a href="/09.算法/07.Utils工具类.html" class="nav-link">Utils工具类</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/ZHANGChang47/BlogVuePress" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/personPhoto.webp"> <div class="blogger-info"><h3>百里登风</h3> <span>张弓折扇风雨历，畅叙平生快意!</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="散文随笔" class="dropdown-title"><!----> <span class="title" style="display:;">散文随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/00.散文随笔/00.沧桑百年史，爱国西交情.html" class="nav-link">沧桑百年史，爱国西交情</a></li><li class="dropdown-item"><!----> <a href="/00.散文随笔/01.静谧之眼.html" class="nav-link">静谧之眼</a></li><li class="dropdown-item"><!----> <a href="/00.散文随笔/02.承党恩泽，物阜民丰.html" class="nav-link">承党恩泽，物阜民丰</a></li><li class="dropdown-item"><!----> <a href="/00.散文随笔/03.历边海防学院记.html" class="nav-link">历边海防学院记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><!----> <span class="title" style="display:;">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/01.Java基础/00.Java基础总结.html" class="nav-link">Java基础总结</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/01.Java开发介绍.html" class="nav-link">Java开发介绍</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/02.Java基础编程.html" class="nav-link">Java基础编程</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/03.方法与数组.html" class="nav-link">方法与数组</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/04.面向对象.html" class="nav-link">面向对象</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/05.异常处理.html" class="nav-link">异常处理</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/06.常用类库API.html" class="nav-link">常用类库API</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/07.文件IO操作.html" class="nav-link">文件IO操作</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/08.集合.html" class="nav-link">集合</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/09.多线程与并发.html" class="nav-link">多线程与并发</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/10.反射与内省.html" class="nav-link">反射与内省</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/11.泛型.html" class="nav-link">泛型</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/12.正则表达式.html" class="nav-link">正则表达式</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/13.枚举.html" class="nav-link">枚举</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/14.注解.html" class="nav-link">注解</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/15.GUI事件处理.html" class="nav-link">GUI事件处理</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/16.网络编程.html" class="nav-link">网络编程</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/17.JVM.html" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/01.Java基础/18.JUC.html" class="nav-link">JUC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaWeb" class="dropdown-title"><!----> <span class="title" style="display:;">JavaWeb</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/02.JavaWeb/00.JavaWeb总结.html" class="nav-link">JavaWeb总结</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/01.Servlet.html" class="nav-link">Servlet</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/02.Web项目架构与数据库使用.html" class="nav-link">Web项目架构与数据库使用</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/03.Jsp与Listener.html" class="nav-link">Jsp与Listener</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/04.EL表达式与JSTL标签库.html" class="nav-link">EL表达式与JSTL标签库</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/05.文件的上传与下载.html" class="nav-link">文件的上传与下载</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/06.Web项目延伸完善.html" class="nav-link">Web项目延伸完善</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/07.cookie与session.html" class="nav-link">cookie与session</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/08.Filter与ThreadLocal.html" class="nav-link">Filter与ThreadLocal</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/09.i18n国际化.html" class="nav-link">i18n国际化</a></li><li class="dropdown-item"><!----> <a href="/02.JavaWeb/10.Web项目延伸完善(2).html" class="nav-link">Web项目延伸完善(2)</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><!----> <span class="title" style="display:;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/03.Spring生态/00.Spring.html" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/03.Spring生态/01.SpringMVC.html" class="nav-link">SpringMVC</a></li><li class="dropdown-item"><!----> <a href="/03.Spring生态/02.SpringBoot.html" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/03.Spring生态/03.SpringCloud.html" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/03.Spring生态/04.SpringSecurity.html" class="nav-link">SpringSecurity</a></li><li class="dropdown-item"><!----> <a href="/03.Spring生态/05.SpringSecurity与JWT.html" class="nav-link">SpringSecurity与JWT</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/04.前端/00.Html.html" class="nav-link">Html</a></li><li class="dropdown-item"><!----> <a href="/04.前端/01.Css.html" class="nav-link">Css</a></li><li class="dropdown-item"><!----> <a href="/04.前端/02.JavaScript.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/04.前端/03.jQuery.html" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/04.前端/04.Vue1.md.html" class="nav-link">Vue1</a></li><li class="dropdown-item"><!----> <a href="/04.前端/04.Vue2.html" class="nav-link">Vue2</a></li><li class="dropdown-item"><!----> <a href="/04.前端/06.Vue2项目笔记.html" class="nav-link">Vue2项目笔记</a></li><li class="dropdown-item"><!----> <a href="/04.前端/07.Vue3项目笔记.html" class="nav-link">Vue3项目笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/05.数据库/00.MySQL.html" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/05.数据库/01.Redis.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/05.数据库/02.MyBatis.html" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/05.数据库/03.MyBatisPlus.html" class="nav-link">MyBatisPlus</a></li><li class="dropdown-item"><!----> <a href="/05.数据库/04.tkMapper.html" class="nav-link">tkMapper</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title" style="display:;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/06.工具/00.Linux.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/06.工具/01.Git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/06.工具/02.Maven.html" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/06.工具/03.配置文件.html" class="nav-link">配置文件</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="组件" class="dropdown-title"><!----> <span class="title" style="display:;">组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/07.组件/00.Json与XML.html" class="nav-link">Json与XML</a></li><li class="dropdown-item"><!----> <a href="/07.组件/01.Ajax.html" class="nav-link">Ajax</a></li><li class="dropdown-item"><!----> <a href="/07.组件/02.Log.html" class="nav-link">Log</a></li><li class="dropdown-item"><!----> <a href="/07.组件/03.Swagger.html" class="nav-link">Swagger</a></li><li class="dropdown-item"><!----> <a href="/07.组件/04.RabbitMQ.html" class="nav-link">RabbitMQ</a></li><li class="dropdown-item"><!----> <a href="/07.组件/05.ElasticSearch.html" class="nav-link">ElasticSearch</a></li><li class="dropdown-item"><!----> <a href="/07.组件/06.Gateway.html" class="nav-link">Gateway</a></li><li class="dropdown-item"><!----> <a href="/07.组件/07.分布式锁.html" class="nav-link">分布式锁</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/08.项目/00.云E办/00.云E办后端笔记.html" class="nav-link">云E办后端笔记</a></li><li class="dropdown-item"><!----> <a href="/08.项目/00.云E办/01.云E办前端笔记.html" class="nav-link">云E办前端笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><!----> <span class="title" style="display:;">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/09.算法/00.算法入门.html" class="nav-link">算法入门</a></li><li class="dropdown-item"><!----> <a href="/09.算法/01.算法基础.html" class="nav-link">算法基础</a></li><li class="dropdown-item"><!----> <a href="/09.算法/02.排序算法.html" class="nav-link">排序算法</a></li><li class="dropdown-item"><!----> <a href="/09.算法/03.二分查找总结.html" class="nav-link">二分查找总结</a></li><li class="dropdown-item"><!----> <a href="/09.算法/04.全排列与子集.html" class="nav-link">全排列与子集</a></li><li class="dropdown-item"><!----> <a href="/09.算法/05.链表翻转.html" class="nav-link">链表翻转</a></li><li class="dropdown-item"><!----> <a href="/09.算法/06.Scanner在ACM模式下应用.html" class="nav-link">Scanner在ACM模式下应用</a></li><li class="dropdown-item"><!----> <a href="/09.算法/07.Utils工具类.html" class="nav-link">Utils工具类</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/ZHANGChang47/BlogVuePress" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/1c8947/" class="sidebar-link">MySQL</a></li><li><a href="/pages/97fb35/" aria-current="page" class="active sidebar-link">Redis</a></li><li><a href="/pages/a87d95/" class="sidebar-link">MyBatis</a></li><li><a href="/pages/29120b/" class="sidebar-link">MyBatisPlus</a></li><li><a href="/pages/340e6a/" class="sidebar-link">tkMapper</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/categories/?category=%E6%95%B0%E6%8D%AE%E5%BA%93" title="分类" data-v-1baff76c>数据库</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>张畅</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2023-02-03</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Redis<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h1> <h2 id="_1、redis介绍"><a href="#_1、redis介绍" class="header-anchor">#</a> 1、Redis介绍</h2> <h3 id="_1-1、项目问题"><a href="#_1-1、项目问题" class="header-anchor">#</a> 1.1、项目问题</h3> <ul><li>数据库访问压力：为了降低对数据库的访问压⼒，当多个用户请求相同的数据时，我们可以将第⼀次从数据库查询到数据进行缓存(存储在内存中)，以减少对数据库的访问次数</li> <li>首页数据的加载效率：将大量的且不经常改变的数据缓存在内容中，可以大幅度提高访问速度</li> <li>集群部署下的商品超卖：分布式事务</li> <li>⽤户登录：分布式会话</li></ul> <h3 id="_1-2、redis介绍"><a href="#_1-2、redis介绍" class="header-anchor">#</a> 1.2、Redis介绍</h3> <h4 id="_1-2-1、redis的产生背景"><a href="#_1-2-1、redis的产生背景" class="header-anchor">#</a> 1.2.1、Redis的产生背景</h4> <p>2008年 萨尔瓦多——开发⼀个进行网站实时统计软件项目（LLOOGG） ，项目的实时统计功能需要频繁的进行数
据库的读写(对数据库的读写要求很高——数千次/s)， MySQL满足不了项目的需求，萨尔瓦多就使用C语言自定义
了⼀个数据存储系统——Redis。后来萨尔瓦多不满足仅仅在LLOOGG这个项目中使⽤redis，就对redis进行产品化并进行开源，以便让更多的⼈能够使用。</p> <h4 id="_1-2-2、redis使用"><a href="#_1-2-2、redis使用" class="header-anchor">#</a> 1.2.2、Redis使用</h4> <p>Redis就是⼀个用C语言开发的、基于内存结构进行键值对数据存储的、高性能的、非关系型NoSQL数据库</p> <h4 id="_1-2-3、redis支持的数据类型"><a href="#_1-2-3、redis支持的数据类型" class="header-anchor">#</a> 1.2.3、Redis支持的数据类型</h4> <blockquote><p>redis是基于键值对进行数据存储的，但是value可以是多种数据类型：</p> <ul><li>string 字符串</li> <li>hash 映射</li> <li>list 列表（队列）</li> <li>set 集合</li> <li>zset 无序集合</li></ul></blockquote> <h4 id="_1-2-4、redis特点"><a href="#_1-2-4、redis特点" class="header-anchor">#</a> 1.2.4、Redis特点</h4> <ul><li>基于内存存储，数据读写效率很⾼</li> <li>Redis本身支持持久化</li> <li>Reids虽然基于key-value存储，但是⽀持多种数据类型</li> <li>Redis支持集群、支持主从模式</li></ul> <h3 id="_1-3、redis应用场景"><a href="#_1-3、redis应用场景" class="header-anchor">#</a> 1.3、Redis应用场景</h3> <ul><li>缓存：在绝大多数的互联网项目中，为了提供数据的访问速度、降低数据库的访问压力，我们可以使用redis作为缓存来实现</li> <li>点赞、排行榜、计数器等功能：对数据实时读写要求比较高，但是对数据库的⼀致性要求并不是太高的功能场景</li> <li>分布式锁：基于redis的操作特性可以实现分布式锁功能</li> <li>分布式会话：在分布式系统中可以使用redis实现 session (共享缓存)</li> <li>消息中间件：可以使用redis实现应用之间的通信</li></ul> <h3 id="_1-4、redis的优缺点"><a href="#_1-4、redis的优缺点" class="header-anchor">#</a> 1.4、Redis的优缺点</h3> <h4 id="_1-4-1、优点"><a href="#_1-4-1、优点" class="header-anchor">#</a> 1.4.1、优点</h4> <ul><li>redis是基于内存结构，性能极高（读 110000次/秒，写 81000次/秒）</li> <li>redis基于键值对存储，但是支持多种数据类型</li> <li>redis的所有操作都是原子性，可以通过lua脚本将多个操作合并为⼀个原子操作（Redis的事务）</li> <li>reids是基于单线程操作，但是其多路复用实现了高性能读写</li></ul> <h4 id="_1-4-2、缺点"><a href="#_1-4-2、缺点" class="header-anchor">#</a> 1.4.2、缺点</h4> <ul><li>缓存数据与数据库数据必须通过两次写操作才能保持数据的⼀致性</li> <li>使⽤缓存会存在缓存穿透、缓存击穿及缓存雪崩等问题，需要处理</li> <li>redis可以作为数据库使用进行数据的持久存储，存在丢失数据的风险</li></ul> <h2 id="_2、redis安装及配置"><a href="#_2、redis安装及配置" class="header-anchor">#</a> 2、Redis安装及配置</h2> <h3 id="_2-1、redis安装"><a href="#_2-1、redis安装" class="header-anchor">#</a> 2.1、Redis安装</h3> <blockquote><p>基于linux环境安装redis</p></blockquote> <h4 id="_2-1-1、下载redis"><a href="#_2-1-1、下载redis" class="header-anchor">#</a> 2.1.1、下载Redis</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> http://download.redis.io/releases/redis-5.0.5.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-1-2、安装redis"><a href="#_2-1-2、安装redis" class="header-anchor">#</a> 2.1.2、安装redis</h4> <ul><li><p>安装gcc</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum -y <span class="token function">install</span> gcc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>解压redis安装包</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">tar</span> -zxvf redis-5.0.5.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>解压之后进⼈到redis-5.0.5⽬录</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> redis-5.0.5
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>编译</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">make</span> <span class="token assign-left variable">MALLOC</span><span class="token operator">=</span>libc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>启动redis</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">##当我们完成redis安装之后，就可以执⾏redis相关的指令</span>
redis-server <span class="token comment">## 启动redis服务</span>
redis-server <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>打开客户端</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli <span class="token comment">## 启动redis操作客户端(命令⾏客户端)</span>
<span class="token comment">##若有多个redis实例可以通过端口号指定，也可以使用ip地址</span>
redis-cli -p <span class="token number">6380</span>
redis-cli -p <span class="token number">6380</span> -h <span class="token function">ip</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <h3 id="_2-2、redis配置"><a href="#_2-2、redis配置" class="header-anchor">#</a> 2.2、Redis配置</h3> <blockquote><ul><li><p>使⽤ redis-server 指令启动redis服务的时候，可以在指令后添加redis配置文件的路径，以设置redis是以何种配置进行启动</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-server redis-6380.conf <span class="token operator">&amp;</span> <span class="token comment">## redis以redis-6380.conf⽂件中的配置来启动</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>如果不指定配置文件的名字，则按照redis的默认配置启动（默认配置≠redis.conf）</p></li> <li><p>我们可以通过创建redis根⽬录下 redis.conf 来创建多个配置⽂件，启动多个redis服务常⽤redis配置</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-server redis-6380.conf <span class="token operator">&amp;</span>
redis-server redis-6381.conf <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></blockquote> <p>常用redis配置</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 设置redis实例（服务）为守护模式,默认值为no，可以设置为yes</span>
daemonize no
<span class="token comment">## 设置当前redis实例启动之后保存进程id的⽂件路径</span>
pidfile /var/run/redis_6379.pid
<span class="token comment">## 设置redis实例的启动端⼝（默认6379）</span>
port <span class="token number">6380</span>
<span class="token comment">## 设置当前redis实例是否开启保护模式</span>
protected-mode <span class="token function">yes</span>
<span class="token comment">## 设置允许访问当前redis实例的ip地址列表</span>
<span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1
<span class="token comment">## 设置连接密码</span>
requirepass <span class="token number">123456</span>
<span class="token comment">## 设置redis实例中数据库的个数（默认16个，编号0-15）</span>
databases <span class="token number">16</span>
<span class="token comment">## 设置最⼤并发数量</span>
maxclients
<span class="token comment">## 设置客户端和redis建⽴连接的最⼤空闲时间，设置为0表示不限制</span>
<span class="token function">timeout</span> <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="_3、redis启动与基本使用"><a href="#_3、redis启动与基本使用" class="header-anchor">#</a> 3、Redis启动与基本使用</h2> <h3 id="_3-0、windows环境下redis的下载与启动"><a href="#_3-0、windows环境下redis的下载与启动" class="header-anchor">#</a> 3.0、Windows环境下Redis的下载与启动</h3> <p><a href="https://blog.csdn.net/weixin_50094173/article/details/124885015" target="_blank" rel="noopener noreferrer">Windows环境下载安装Redis教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>使用cmd进入到Redis的解压目录，然后输入：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli.exe
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img alt="image-20230111110930965" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111110930965.png" loading="lazy" class="lazy"></p> <h3 id="_3-1、redis存储的数据结构"><a href="#_3-1、redis存储的数据结构" class="header-anchor">#</a> 3.1、Redis存储的数据结构</h3> <p>Redis是以键值对形式进行数据存储的，但是value支持多种数据类型</p> <p><img alt="image-20230111111533105" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111111533105.png" loading="lazy" class="lazy"></p> <h3 id="_3-2、string常用指令"><a href="#_3-2、string常用指令" class="header-anchor">#</a> 3.2、string常用指令</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 设置值/修改值 如果key存在则进⾏修改</span>
<span class="token builtin class-name">set</span> key value
<span class="token comment">## 取值</span>
get key
<span class="token comment">## 批量添加</span>
mset k1 v1 <span class="token punctuation">[</span>k2 v2 k3 v3 <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
<span class="token comment">## 批量取值</span>
mget k1 <span class="token punctuation">[</span>k2 k3<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
<span class="token comment">## ⾃增和⾃减</span>
incr key 		<span class="token comment">## 对于数字，在key对应的value上⾃增 +1</span>
decr key 		<span class="token comment">## 对于数字，在key对应的value上⾃减 -1</span>
incrby key <span class="token function">v</span> 	<span class="token comment">## 对于数字，在key对应的value上+v</span>
decrby key <span class="token function">v</span> 	<span class="token comment">## 对于数字，在key对应的value上-v</span>
<span class="token comment">## 添加键值对，并设置过期时间(TTL)</span>
setex key time<span class="token punctuation">(</span>seconds<span class="token punctuation">)</span> value
<span class="token comment">## 设置值，如果key不存在则成功添加，如果key存在则添加失败（不做修改操作）</span>
setnx key value
<span class="token comment">## 在指定的key对应value拼接字符串</span>
append key value
<span class="token comment">## 获取key对应的字符串的⻓度</span>
strlen key
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_3-3、hash常用指令"><a href="#_3-3、hash常用指令" class="header-anchor">#</a> 3.3、hash常用指令</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 向key对应的hash中添加键值对</span>
hset key field value
<span class="token comment">## 从key对应的hash获取field对应的值</span>
hget key field
<span class="token comment">## 向key对应的hash结构中批量添加键值对</span>
hmset key f1 v1 <span class="token punctuation">[</span>f2 v2 <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
<span class="token comment">## 从key对应的hash中批量获取值</span>
hmget key f1 <span class="token punctuation">[</span>f2 f3 <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
<span class="token comment">## 对于数字，在key对应的hash中的field对应value上加v</span>
hincrby key field <span class="token function">v</span>
<span class="token comment">## 获取key对应的hash中所有的键值对</span>
hgetall key
<span class="token comment">## 获取key对应的hash中所有的field</span>
hkeys key
<span class="token comment">## 获取key对应的hash中所有的value</span>
hvals key
<span class="token comment">## 检查key对应的hash中是否有指定的field</span>
hexists key field
<span class="token comment">## 获取key对应的hash中键值对的个数</span>
hlen key
<span class="token comment">## 向key对应的hash结构中添加f-v,如果field在hash中已经存在，则添加失败</span>
hsetnx key field value
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_3-4、list常用指令"><a href="#_3-4、list常用指令" class="header-anchor">#</a> 3.4、list常用指令</h3> <p><img alt="image-20211228232744234" data-src="https://s2.loli.net/2021/12/28/eLYVu18TD9sjrEc.png" loading="lazy" class="lazy"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 存储数据</span>
lpush key value <span class="token comment"># 向key对应的列表的左侧添加数据value</span>
rpuhs key value <span class="token comment"># 向key对应的列表的右侧添加数据value</span>
<span class="token comment">## 获取数据</span>
lpop key <span class="token comment"># 从key对应的列表的左侧方向取⼀个值</span>
rpop key <span class="token comment"># 从key对应的列表的右侧方向取⼀个值</span>
<span class="token comment">## 修改数据</span>
lset key index value <span class="token comment">#修改key对应的列表的索引位置的数据（索引从左往右，从0开始）</span>
<span class="token comment">## 查看key对应的列表中索引从start开始到stop结束的所有值</span>
lrange key start stop
<span class="token comment">## 查看key对应的列表中index索引对应的值</span>
lindex key index
<span class="token comment">## 获取key对应的列表中的元素个数</span>
llen key
<span class="token comment">## 从key对应的列表中截取key在[start,stop]范围的值，不在此范围的数据⼀律被清除掉</span>
ltrim key start stop
<span class="token comment">## 从k1右侧取出⼀个数据存放到k2的左侧</span>
rpoplpush k1 k2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_3-5、set常用指令"><a href="#_3-5、set常用指令" class="header-anchor">#</a> 3.5、set常用指令</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 存储元素 ：在key对应的集合中添加元素，可以添加1个，也可以同时添加多个元素</span>
sadd key v1 <span class="token punctuation">[</span>v2 v3 v4<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
<span class="token comment">## 遍历key对应的集合中的所有元素</span>
smembers key
<span class="token comment">## 随机从key对于听的集合中获取⼀个值（出栈）</span>
spop key
<span class="token comment">## 交集</span>
sinter key1 key2
<span class="token comment">## 并集</span>
sunion key1 key2
<span class="token comment">## 差集</span>
<span class="token function">sdiff</span> key1 key2
<span class="token comment">## 从key对应的集合中移出指定的value</span>
srem key value
<span class="token comment">## 检查key对应的集合中是否有指定的value</span>
sismember key value
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_3-6、zset常用指令"><a href="#_3-6、zset常用指令" class="header-anchor">#</a> 3.6、zset常用指令</h3> <blockquote><p>zset 有序不可重复集合</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 存储数据(score存储位置必须是数值，可以是float类型的任意数字； member元素不允许重复)</span>
zadd key score member <span class="token punctuation">[</span>score member<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
<span class="token comment">## 查看key对应的有序集合中索引[start,stop]数据——按照score值由⼩到⼤（start 和 stop指的不是score，⽽是元素在有序集合中的索引）</span>
zrange key start <span class="token function">top</span>
<span class="token comment">##查看member元素在key对应的有序集合中的索引</span>
zscore key member
<span class="token comment">## 获取key对应的zset中的元素个数</span>
zcard key
<span class="token comment">## 获取key对应的zset中， score在[min,max]范围内的member个数</span>
zcount key min max
<span class="token comment">## 从key对应的zset中移除指定的member</span>
zrem key6 member
<span class="token comment">## 查看key对应的有序集合中索引[start,stop]数据——按照score值由⼤到⼩，反转</span>
zrevrange key start stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_3-7、key相关指令"><a href="#_3-7、key相关指令" class="header-anchor">#</a> 3.7、key相关指令</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 查看redis中满⾜pattern规则的所有的key（keys *）</span>
keys pattern
keys *
<span class="token comment">## 查看指定的key谁否存在</span>
exists key
<span class="token comment">## 删除指定的key-value对</span>
del key
<span class="token comment">## 获取当前key的存活时间(如果没有设置过期返回-1，设置过期并且已经过期返回-2)</span>
ttl key
<span class="token comment">## 设置键值对过期时间</span>
expire key seconds
pexpire key milliseconds
<span class="token comment">## 取消键值对过期时间</span>
persist key
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_3-8、db常用指令"><a href="#_3-8、db常用指令" class="header-anchor">#</a> 3.8、db常用指令</h3> <blockquote><p>redis的键值对是存储在数据库中的——db</p> <p>redis中默认有16个db，编号 0-15</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 切换数据库</span>
<span class="token keyword">select</span> index
<span class="token comment">## 将键值对从当前db移动到⽬标db</span>
move key index
<span class="token comment">## 清空当前数据库数据</span>
flushdb
<span class="token comment">## 清除所有数据库的k-v</span>
flushall
<span class="token comment">## 查看当前db中k-v个数</span>
dbsize
<span class="token comment">## 获取最后⼀次持久化操作时间</span>
lastsave
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="_4、redis的持久化-重点"><a href="#_4、redis的持久化-重点" class="header-anchor">#</a> 4、Redis的持久化 [重点]</h2> <blockquote><p>Redis是基于内存操作，但作为⼀个数据库也具备数据的持久化能⼒；但是为了实现高效的读写操作，并不会
即时进行数据的持久化，而是按照⼀定的规则进行持久化操作的——持久化策略</p> <p>Redis提供了2中持久化策略：</p> <ul><li>RDB (Redis DataBase)</li> <li>AOF(Append Only File)</li></ul></blockquote> <h3 id="_4-1、rdb"><a href="#_4-1、rdb" class="header-anchor">#</a> 4.1、RDB</h3> <blockquote><p>在满足特定的redis操作条件时，将内存中的数据以数据快照的形式存储到rdb⽂件中</p></blockquote> <p><img alt="image-20230111145602913" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111145602913.png" loading="lazy" class="lazy"></p> <ul><li><p>原理：</p> <p>RDB是redis默认的持久化策略，当redis中的写操作达到指定的次数、同时距离上⼀次持久化达到指定的时间就会将redis内存中的数据生成数据快照，保存在指定的rdb文件中。</p></li> <li><p>默认触发持久化条件：</p> <ul><li>900s 1次：当操作次数达到1次， 900s就会进行持久化</li> <li>300s 10次：当操作次数达到10次， 300s就会进行持久化</li> <li>60s 10000次：当操作次数达到10000次， 60s就会就行持久化</li></ul></li> <li><p>我们可以通过修改<code>redis.conf</code>⽂件，来设置RDB策略的触发条件：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## rdb持久化开关</span>
rdbcompression <span class="token function">yes</span>
<span class="token comment">## 配置redis的持久化策略</span>
save <span class="token number">900</span> <span class="token number">1</span>
save <span class="token number">300</span> <span class="token number">10</span>
save <span class="token number">60</span> <span class="token number">10000</span>
<span class="token comment">## 指定rdb数据存储的⽂件</span>
dbfilename dump.rdb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>RED持久化细节分析：</p> <p>缺点：</p> <ul><li>如果redis出现故障，存在数据丢失的风险，丢失上⼀次持久化之后的操作数据；</li> <li>RDB采用的是数据快照形式进行持久化，不适合实时性持久化；</li> <li>如果数据量巨大，在RDB持久化过程中生成数据快照的子进程执行时间过长，会导致redis卡顿，因此
save时间周期设置不宜过短；</li></ul> <p>优点：</p> <ul><li>但是在数据量较小的情况下，执行速度比较快；</li> <li>由于RDB是以数据快照的形式进行保存的，我们可以通过拷贝rdb文件轻松实现redis数据移植</li></ul></li></ul> <h3 id="_4-2、aof"><a href="#_4-2、aof" class="header-anchor">#</a> 4.2、AOF</h3> <blockquote><p>Apeend Only File，当达到设定触发条件时，将redis执行的写操作指令存储在aof文件中， Redis默认未开启aof
持久化</p></blockquote> <p><img alt="image-20211229202918751" data-src="https://s2.loli.net/2021/12/29/SgioAM3QxZ2rVCL.png" loading="lazy" class="lazy"></p> <ul><li><p>原理：</p> <p>Redis将每⼀个成功的写操作写⼊到aof⽂件中，当redis重启的时候就执⾏aof⽂件中的指令以恢复数据</p></li> <li><p>配置：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 开启AOF</span>
appendonly <span class="token function">yes</span>
<span class="token comment">## 设置触发条件（三选⼀）</span>
appendfsync always <span class="token comment">## 只要进⾏成功的写操作，就执⾏aof</span>
appendfsync everysec <span class="token comment">## 每秒进⾏⼀次aof</span>
appendfsync no <span class="token comment">## 让redis执⾏决定aof</span>
<span class="token comment">## 设置aof⽂件路径</span>
appendfilename <span class="token string">&quot;appendonly.aof&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>AOF细节分析：</p> <ul><li>也可以通过拷贝aof文件进行redis数据移植</li> <li>aof存储的指令，而且会对指令进行整理；而RDB直接生成数据快照，在数据量不大时RDB比较快</li> <li>aof是对指令文件进行增量更新，更适合实时性持久化</li> <li>redis官方建议同时开启两中持久化策略，如果同时存在aof文件和rdb文件的情况下aof优先</li></ul></li></ul> <h2 id="_5、java应用连接redis"><a href="#_5、java应用连接redis" class="header-anchor">#</a> 5、Java应用连接Redis</h2> <h3 id="_5-1、设置redis允许远程连接"><a href="#_5-1、设置redis允许远程连接" class="header-anchor">#</a> 5.1、设置redis允许远程连接</h3> <blockquote><p>Java应用连接Redis，首先要将我们的Redis设置允许远程连接</p></blockquote> <ul><li><p>修改redis-6379.conf</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 关闭保护模式</span>
protected-mode no
<span class="token comment">## 将bind注释掉（如果不注释，默认为 bind 127.0.0.1 只能本机访问）</span>
<span class="token comment"># bind 127.0.0.1</span>
<span class="token comment">## 密码可以设置（也可以不设置）</span>
<span class="token comment"># requirepass 123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>重启redis</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-server redis-6379.conf <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>阿里云安全组设置放行6379端⼝</p> <p><img alt="image-20211229204038983" data-src="https://s2.loli.net/2021/12/29/3QXsO56nrzIvNYb.png" loading="lazy" class="lazy"></p></li></ul> <h3 id="_5-2、在普通maven工程连接redis"><a href="#_5-2、在普通maven工程连接redis" class="header-anchor">#</a> 5.2、在普通Maven工程连接Redis</h3> <blockquote><p>使用jedis客户端连接</p></blockquote> <h4 id="_5-2-1、添加jedis依赖以及使用的lombock依赖以及gson依赖"><a href="#_5-2-1、添加jedis依赖以及使用的lombock依赖以及gson依赖" class="header-anchor">#</a> 5.2.1、添加Jedis依赖以及使用的lombock依赖以及Gson依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.24<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.code.gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_5-2-2、使用案例"><a href="#_5-2-2、使用案例" class="header-anchor">#</a> 5.2.2、使用案例</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>chang</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span></span><span class="token class-name">Gson</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建对象并连接redis</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">&quot;娃哈哈AD钙奶&quot;</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//如果有密码</span>
        <span class="token comment">//jedis.auth(&quot;redis&quot;);</span>
        <span class="token comment">//存储数据</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>      
        <span class="token comment">//{&quot;productId&quot;:101,&quot;productName&quot;:&quot;娃哈哈AD钙奶&quot;,&quot;productPrice&quot;:2.5}</span>
        <span class="token class-name">String</span> set <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token comment">//OK</span>
        <span class="token comment">//获取数据</span>
        <span class="token class-name">String</span> s1 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Product</span> product1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product1<span class="token punctuation">)</span><span class="token punctuation">;</span>   
        <span class="token comment">//Product(productId=101, productName=娃哈哈AD钙奶, productPrice=2.5)</span>
        <span class="token comment">//关闭连接</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>Product：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>chang</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> productId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> productPrice<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_5-3、在springboot工程连接redis"><a href="#_5-3、在springboot工程连接redis" class="header-anchor">#</a> 5.3、在SpringBoot⼯程连接Redis</h3> <blockquote><p>Spring Data Redis, part of the larger Spring Data family, provides easy configuration and access to Redis from
Spring applications. It offers both low-level and high-level abstractions for interacting with the store, freeing the
user from infrastructural concerns.</p> <p>Spring Data Redis依赖中，提供了用于连接redis的客户端：</p> <ul><li>RedisTemplate</li> <li>StringRedisTemplate</li></ul></blockquote> <h4 id="_5-3-1、创建springboot应用"><a href="#_5-3-1、创建springboot应用" class="header-anchor">#</a> 5.3.1、创建springBoot应用</h4> <p><img alt="image-20211229205232975" data-src="https://s2.loli.net/2021/12/29/KfV52hylPcRLCY1.png" loading="lazy" class="lazy"></p> <h4 id="_5-3-2、配置redis"><a href="#_5-3-2、配置redis" class="header-anchor">#</a> 5.3.2、配置redis</h4> <blockquote><p>application.yml⽂件配置redis的连接信息</p></blockquote> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5-3-3、beans目录中创建实体类"><a href="#_5-3-3、beans目录中创建实体类" class="header-anchor">#</a> 5.3.3、beans目录中创建实体类</h4> <p>新建beans，创建Product实体类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>chang<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>redisdemo<span class="token punctuation">.</span>beans</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> productPrice<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_5-3-4、service注入stringredistemplate操作redis"><a href="#_5-3-4、service注入stringredistemplate操作redis" class="header-anchor">#</a> 5.3.4、Service注入StringRedisTemplate操作redis</h4> <blockquote><p>直接在service中注入 RedisTemplate 或者 StringRedisTemplate ，就可以使用此对象完成redis操作</p></blockquote> <p><strong>ProductService：</strong></p> <p>编写两个接口，一个用来向redis中添加数据，一个从redis中获取数据</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>chang<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>redisdemo<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>chang<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>redisdemo<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">Product</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ProductService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInfoToRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">getInfoFromRedis</span><span class="token punctuation">(</span><span class="token class-name">String</span> productId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>impl/ProductServiceImpl：</strong></p> <p>注入StringRedisTemplate，首先确定要操作的key，然后对value进行操作</p> <p>其中涉及字符串与对象的转换：</p> <ul><li><p>将对象转为字符串：String jsonStr = new ObjectMapper().writeValueAsString(product);</p></li> <li><p>将字符串转为对象：Product product = new ObjectMapper().readValue(s, Product.class);</p></li></ul> <p>如果涉及到列表，参考6.3.3中的截图的代码</p> <p>二者均需要捕获异常</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>chang<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>redisdemo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>chang<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>redisdemo<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">Product</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>chang<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>redisdemo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ProductService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JsonProcessingException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">StringRedisTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ProductService</span> <span class="token punctuation">{</span>
<span class="token comment">//    @Autowired</span>
<span class="token comment">//    private RedisTemplate redisTemplate;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>
    <span class="token comment">/*
    将数据存储到redis中
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInfoToRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">&quot;103&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;王老吉&quot;</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> jsonStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JsonProcessingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*
    从redis中取出数据
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">getInfoFromRedis</span><span class="token punctuation">(</span><span class="token class-name">String</span> productId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> s <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span>productId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JsonProcessingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> product<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h4 id="_5-3-5、controller层调用service层方法"><a href="#_5-3-5、controller层调用service层方法" class="header-anchor">#</a> 5.3.5、Controller层调用service层方法</h4> <p>ProductController：</p> <p>新建controller层，以及ProductController方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>chang<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>redisdemo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>chang<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>redisdemo<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">Product</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>chang<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>redisdemo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ProductService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/product&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ProductService</span> productService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        productService<span class="token punctuation">.</span><span class="token function">addInfoToRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">testGet</span><span class="token punctuation">(</span><span class="token class-name">String</span> productId<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Product</span> infoFromRedis <span class="token operator">=</span> productService<span class="token punctuation">.</span><span class="token function">getInfoFromRedis</span><span class="token punctuation">(</span>productId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> infoFromRedis<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><blockquote><p>在浏览器中调用：localhost:8080/product/add，将product对象添加进redis中</p></blockquote> <p><img alt="image-20230111174924594" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111174924594.png" loading="lazy" class="lazy"></p> <blockquote><p>在浏览器中调用：localhost:8080/product/get?productId=103，从redis中获取product对象</p></blockquote> <p><img alt="image-20230111175042997" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111175042997.png" loading="lazy" class="lazy"></p> <h3 id="_5-4、spring-data-redis"><a href="#_5-4、spring-data-redis" class="header-anchor">#</a> 5.4、Spring Data Redis</h3> <p><img alt="image-20230111203544594" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111203544594.png" loading="lazy" class="lazy"></p> <h4 id="_5-4-1、不同数据结构的添加操作"><a href="#_5-4-1、不同数据结构的添加操作" class="header-anchor">#</a> 5.4.1、不同数据结构的添加操作</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//1.string</span>
<span class="token comment">//添加数据 set key value</span>
stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.hash</span>
stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">&quot;products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//3.list</span>
stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leftPush</span><span class="token punctuation">(</span><span class="token string">&quot;ccc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//4.set</span>
stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span><span class="token string">&quot;s1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;v2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//5.zset</span>
stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">&quot;z1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span><span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_5-4-2、string类型的操作方法"><a href="#_5-4-2、string类型的操作方法" class="header-anchor">#</a> 5.4.2、string类型的操作方法</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//添加数据 set key value</span>
stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//添加数据时指定过期时间 setex key 300 value</span>
stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;103&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置指定key的过期时间 expire key 20</span>
stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;103&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//添加数据 setnx key value</span>
<span class="token class-name">Boolean</span> absent <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;103&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_5-4-3、不同数据类型的取值操作"><a href="#_5-4-3、不同数据类型的取值操作" class="header-anchor">#</a> 5.4.3、不同数据类型的取值操作</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//string</span>
<span class="token class-name">String</span> o <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;103&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//hash</span>
<span class="token class-name">Object</span> v <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">&quot;products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;101&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//list</span>
<span class="token class-name">String</span> s1 <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leftPop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s2 <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s3 <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//set</span>
<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> vs <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span><span class="token string">&quot;s1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//zset</span>
<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> vs2 <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">&quot;z1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_6、使用redis缓存数据库数据"><a href="#_6、使用redis缓存数据库数据" class="header-anchor">#</a> 6、使用redis缓存数据库数据</h2> <h3 id="_6-1、redis作为缓存的使用流程"><a href="#_6-1、redis作为缓存的使用流程" class="header-anchor">#</a> 6.1、redis作为缓存的使用流程</h3> <p><img alt="image-20230111183533627" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111183533627.png" loading="lazy" class="lazy"></p> <h3 id="_6-2、在使用redis缓存商品详情-锋迷商城"><a href="#_6-2、在使用redis缓存商品详情-锋迷商城" class="header-anchor">#</a> 6.2、在使用redis缓存商品详情(锋迷商城)</h3> <h4 id="_6-2-1、在service子工程添加spring-data-redis依赖"><a href="#_6-2-1、在service子工程添加spring-data-redis依赖" class="header-anchor">#</a> 6.2.1、在service子工程添加Spring data redis依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_6-2-2、在application-yml配置redis数据源"><a href="#_6-2-2、在application-yml配置redis数据源" class="header-anchor">#</a> 6.2.2、在application.yml配置redis数据源</h4> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">druid</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
    <span class="token comment">## 如果后端项⽬服务器和数据库服务器不在同⼀台主机，则需要修改localhost为数据库服务器ip地址</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/fmmall2<span class="token punctuation">?</span>characterEncoding=utf<span class="token punctuation">-</span><span class="token number">8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> admin123
<span class="token key atrule">redis</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> 47.96.11.185
  <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_6-2-3、在productserviceimpl中修改业务代码"><a href="#_6-2-3、在productserviceimpl中修改业务代码" class="header-anchor">#</a> 6.2.3、在ProductServiceImpl中修改业务代码</h4> <p><img alt="image-20230111183547626" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111183547626.png" loading="lazy" class="lazy"></p> <p><img alt="image-20230111183602614" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111183602614.png" loading="lazy" class="lazy"></p> <p><img alt="image-20230111183616115" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111183616115.png" loading="lazy" class="lazy"></p> <p><img alt="image-20230111183629330" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111183629330.png" loading="lazy" class="lazy"></p> <h3 id="_6-3、案例"><a href="#_6-3、案例" class="header-anchor">#</a> 6.3、案例</h3> <p>需要先定义一个返回值</p> <p>涉及查询存放，以及格式转换</p> <p>设定过期时间</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CategoryServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">CategoryService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CategoryMapper</span> categoryMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ObjectMapper</span> objectMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//查询分类列表（包含三个级别的分类）</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultVO</span> <span class="token function">listCategories</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryVO</span><span class="token punctuation">&gt;</span></span> categoryVOS<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//1、查询redis</span>
            <span class="token class-name">String</span> cateories <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;cateories&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2、判断是否为空</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>cateories<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">JavaType</span> javaType<span class="token operator">=</span>objectMapper<span class="token punctuation">.</span><span class="token function">getTypeFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">constructParametricType</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">CategoryVO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                categoryVOS <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>cateories<span class="token punctuation">,</span> javaType<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">//如果redis中没有类型数据，需要查询数据库</span>
                categoryVOS <span class="token operator">=</span> categoryMapper<span class="token punctuation">.</span><span class="token function">selectAllCategories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;cateories&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>categoryVOS<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JsonProcessingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">ResultVO</span> resultVO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span><span class="token class-name">ResStatus</span><span class="token punctuation">.</span>OK<span class="token punctuation">,</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> categoryVOS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultVO<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//查询所有一级分类，同时查询当前一级分类下销量最高的6个商品</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultVO</span> <span class="token function">listFirstLevelCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryVO</span><span class="token punctuation">&gt;</span></span> categoryVOS <span class="token operator">=</span> categoryMapper<span class="token punctuation">.</span><span class="token function">selectFirstLevelCategories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultVO</span> resultVO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span><span class="token class-name">ResStatus</span><span class="token punctuation">.</span>OK<span class="token punctuation">,</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> categoryVOS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultVO<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="_6-4、页面静态化"><a href="#_6-4、页面静态化" class="header-anchor">#</a> 6.4、页面静态化</h3> <blockquote><p>页面静态化：将数据库中的每条数据结合模板生成单独的HTML文件进行存储（一条数据对应一个独立的HTML文件），当用户访问数据时，直接访问不同的静态文件即可</p></blockquote> <h2 id="_7、使用redis做缓存使用存在的问题-重点"><a href="#_7、使用redis做缓存使用存在的问题-重点" class="header-anchor">#</a> 7、使用Redis做缓存使用存在的问题 [重点]</h2> <blockquote><p>使用redis做为缓存在高并发场景下有可能出现缓存击穿、缓存穿透、缓存雪崩等问题</p></blockquote> <h3 id="_7-1、缓存击穿"><a href="#_7-1、缓存击穿" class="header-anchor">#</a> 7.1、缓存击穿</h3> <blockquote><p>缓存击穿：大量的并发请求同时访问同⼀个在redis中不存在的数据，就会导致大量的请求绕过redis同时并发
访问数据库，对数据库造成了高并发访问压力。</p></blockquote> <ul><li>使用 <code>双重检测锁</code> 解决 <code>缓存击穿</code> 问题</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexImgServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IndexImgService</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">IndexImgMapper</span> indexImgMapper<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultVO</span> <span class="token function">listIndexImgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IndexImg</span><span class="token punctuation">&gt;</span></span> indexImgs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">//1000个并发请求，请求轮播图</span>
			<span class="token class-name">String</span> imgsStr <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;indexImgs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
            <span class="token comment">//1000个请求查询到redis中的数据都是null</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>imgsStr <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 从redis中获取到了轮播图信息</span>
			<span class="token class-name">JavaType</span> javaType <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">getTypeFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">constructParametricType</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">IndexImg</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			indexImgs <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>imgsStr<span class="token punctuation">,</span> javaType<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 1000个请求都会进⼊else</span>
                <span class="token comment">// (service类在spring容器中是单例的，</span>
                <span class="token comment">// 1000个并发会启动1000个线程来处理，但是共⽤⼀个service实例)</span>
				<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">// 第⼆次查询redis</span>
                    <span class="token class-name">String</span> s <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;indexImgs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token comment">// 这1000个请求中，只有第⼀个请求再次查询redis时依然为null，其余的进入else中</span>
                        indexImgs <span class="token operator">=</span> indexImgMapper<span class="token punctuation">.</span><span class="token function">listIndexImgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----------------查询数据库&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;indexImgs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>indexImgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;indexImgs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        <span class="token class-name">JavaType</span> javaType <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">getTypeFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">constructParametricType</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">IndexImg</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        indexImgs <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> javaType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JsonProcessingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//返回数据</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>indexImgs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span><span class="token class-name">ResStatus</span><span class="token punctuation">.</span>OK<span class="token punctuation">,</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>indexImgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span><span class="token class-name">ResStatus</span><span class="token punctuation">.</span>NO<span class="token punctuation">,</span><span class="token string">&quot;fail&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h3 id="_7-2、缓存穿透"><a href="#_7-2、缓存穿透" class="header-anchor">#</a> 7.2、缓存穿透</h3> <blockquote><p>缓存穿透：大量的请求⼀个数据库中不存在的数据，首先在redis中无法命中，最终所有的请求都会访问数据
库，同样会导致数据库承受巨大的访问压力</p></blockquote> <ul><li>解决方案：当从数据库查询到⼀个null时，写⼀个非空的数据到redis，并设置过期时间</li></ul> <p><img alt="image-20230111195839847" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111195839847.png" loading="lazy" class="lazy"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>indexImgs <span class="token operator">=</span> indexImgMapper<span class="token punctuation">.</span><span class="token function">listIndexImgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>indexImgs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> s <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>indexImgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;indexImgs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
	stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;indexImgs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
	<span class="token comment">//当从数据库查询数据为null时，保存⼀个⾮空数据到redis，并设置过期时间</span>
	stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;indexImgs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;indexImgs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_7-3、缓存雪崩"><a href="#_7-3、缓存雪崩" class="header-anchor">#</a> 7.3、缓存雪崩</h3> <blockquote><p>缓存雪崩：缓存大量的数据集中过期，导致请求这些数据的大量的并发请求会同时访问数据库</p></blockquote> <p>解决方案：</p> <ul><li>将缓存中的数据设置成不同的过期时间</li> <li>在访问洪峰到达前缓存热点数据，过期时间设置到流量最低的时段</li></ul> <h3 id="_7-4、jmeter测试"><a href="#_7-4、jmeter测试" class="header-anchor">#</a> 7.4、Jmeter测试</h3> <blockquote><p>Jmeter是基于Java开发的一个测试工具，因此需要先安装JDK</p></blockquote> <h4 id="_7-4-1、创建测试计划"><a href="#_7-4-1、创建测试计划" class="header-anchor">#</a> 7.4.1、创建测试计划</h4> <p><img alt="image-20230111195848553" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111195848553.png" loading="lazy" class="lazy"></p> <h4 id="_7-4-2、创建线程组"><a href="#_7-4-2、创建线程组" class="header-anchor">#</a> 7.4.2、创建线程组</h4> <p><img alt="image-20230111195859429" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111195859429.png" loading="lazy" class="lazy"></p> <h4 id="_7-4-3、设置http请求"><a href="#_7-4-3、设置http请求" class="header-anchor">#</a> 7.4.3、设置HTTP请求</h4> <p><img alt="image-20230111195917710" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111195917710.png" loading="lazy" class="lazy"></p> <h4 id="_7-4-4、设置监听器"><a href="#_7-4-4、设置监听器" class="header-anchor">#</a> 7.4.4、设置监听器</h4> <p><img alt="image-20230111195925944" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111195925944.png" loading="lazy" class="lazy"></p> <p><img alt="image-20230111195932621" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111195932621.png" loading="lazy" class="lazy"></p> <p>然后保存点击绿色三角运行</p> <h2 id="_8、-redis高级应用"><a href="#_8、-redis高级应用" class="header-anchor">#</a> 8、 Redis高级应用</h2> <blockquote><p>使用redis作为缓存数据库使用目的是为了提升数据加载速度、降低对数据库的访问压力，我们需要保证redis
的可用性。</p> <ul><li>主从配置</li> <li>哨兵模式</li> <li>集群配置</li></ul></blockquote> <h3 id="_8-1、主从配置"><a href="#_8-1、主从配置" class="header-anchor">#</a> 8.1、主从配置</h3> <blockquote><p>主从配置：在多个redis实例建立起主从关系，当<code>主redis</code>中的数据发生变化， <code>从redis</code>中的数据也会同步变化。</p> <ul><li><p>通过主从配置可以实现redis数据的备份（ <code>从redis</code> 就是对 <code>主redis</code> 的备份），保证数据的安全性；</p></li> <li><p>通过主从配置可以实现redis的读写分离</p> <p><img alt="image-20230111203740618" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111203740618.png" loading="lazy" class="lazy"></p></li></ul></blockquote> <p>主从配置示例</p> <ul><li><p>启动三个redis实例</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 在redis-5.0.5⽬录下创建 msconf ⽂件夹</span>
<span class="token punctuation">[</span>root@theo redis-5.0.5<span class="token punctuation">]</span><span class="token comment"># mkdir msconf</span>
<span class="token comment">## 拷⻉redis.conf⽂件 到 msconf⽂件夹 ---&gt; redis-master.conf，在这个过程中去掉注释与空行</span>
<span class="token punctuation">[</span>root@theo redis-5.0.5<span class="token punctuation">]</span><span class="token comment"># cat redis.conf | grep -v &quot;#&quot; | grep -v &quot;^$&quot; &gt; msconf/redismaster.conf</span>
<span class="token comment">## 修改 redis-master.conf 端⼝及远程访问设置</span>
<span class="token punctuation">[</span>root@theo msconf<span class="token punctuation">]</span><span class="token comment"># vim redis-master.conf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img alt="image-20230111203702007" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111203702007.png" loading="lazy" class="lazy"></p> <p><img alt="image-20230111200032026" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111200032026.png" loading="lazy" class="lazy"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 将 redis-master.conf 拷⻉两份分别为： redis-slave1.conf redis-slave2.conf</span>
<span class="token punctuation">[</span>root@theo msconf<span class="token punctuation">]</span><span class="token comment"># sed 's/6380/6381/g' redis-master.conf &gt; redis-slave1.conf</span>
<span class="token punctuation">[</span>root@theo msconf<span class="token punctuation">]</span><span class="token comment"># sed 's/6380/6382/g' redis-master.conf &gt; redis-slave2.conf</span>
<span class="token comment">## 修改redis-slave1.conf redis-slave2.conf，设置“跟从”---127.0.0.1 6380</span>
<span class="token punctuation">[</span>root@theo msconf<span class="token punctuation">]</span><span class="token comment"># vim redis-slave1.conf</span>
<span class="token punctuation">[</span>root@theo msconf<span class="token punctuation">]</span><span class="token comment"># vim redis-slave2.conf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img alt="image-20211230112629618" data-src="https://s2.loli.net/2021/12/30/DJZXTWqt2FHIVaE.png" loading="lazy" class="lazy"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 启动三个redis实例</span>
<span class="token punctuation">[</span>root@theo msconf<span class="token punctuation">]</span><span class="token comment"># redis-server redis-master.conf &amp;</span>
<span class="token punctuation">[</span>root@theo msconf<span class="token punctuation">]</span><span class="token comment"># redis-server redis-slave1.conf &amp;</span>
<span class="token punctuation">[</span>root@theo msconf<span class="token punctuation">]</span><span class="token comment"># redis-server redis-slave2.conf &amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img alt="image-20230111203818521" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111203818521.png" loading="lazy" class="lazy"></p></li></ul> <h3 id="_8-2、哨兵模式"><a href="#_8-2、哨兵模式" class="header-anchor">#</a> 8.2、哨兵模式</h3> <blockquote><p>不存在读写分离</p> <p>哨兵模式：用于监听主库，当确认主库宕机之后，从备库(从库)中选举⼀个转备为主</p> <p><img alt="image-20230111204712832" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111204712832.png" loading="lazy" class="lazy"></p></blockquote> <ul><li>哨兵模式配置</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">##⾸先实现三个redis实例之间的主从配置（如上）</span>
<span class="token comment">## 创建并启动三个哨兵</span>
<span class="token comment">## 拷⻉sentinel.conf⽂件三份： sentinel-26380.conf sentinel-26381.conf sentinel-26382.conf</span>
<span class="token comment">## 创建sentinelconf⽬录</span>
<span class="token punctuation">[</span>root@theo redis-5.0.5<span class="token punctuation">]</span><span class="token comment"># mkdir sentinelconf</span>
<span class="token comment">## 拷⻉sentinel.conf⽂件到 sentinelconf⽬录： sentinel-26380.conf</span>
<span class="token punctuation">[</span>root@theo redis-5.0.5<span class="token punctuation">]</span><span class="token comment"># cat sentinel.conf | grep -v &quot;#&quot; | grep -v &quot;^$&quot; &gt; sentinelconf/sentinel-26380.conf</span>
<span class="token punctuation">[</span>root@theo redis-5.0.5<span class="token punctuation">]</span><span class="token comment"># cd sentinelconf/</span>
<span class="token punctuation">[</span>root@theo sentinelconf<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">4</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">326</span> May <span class="token number">19</span> <span class="token number">17</span>:09 sentinel-26380.conf
<span class="token comment">## 编辑 sentinelconf/sentinel-26380.conf⽂件</span>
<span class="token punctuation">[</span>root@theo sentinelconf<span class="token punctuation">]</span><span class="token comment"># vim sentinel-26380.conf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>sentinel-26380.conf：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>port <span class="token number">26380</span>
daemonize no
pidfile <span class="token string">&quot;/var/run/redis-sentinel-26380.pid&quot;</span>
logfile <span class="token string">&quot;&quot;</span>
<span class="token function">dir</span> <span class="token string">&quot;/tmp&quot;</span>
sentinel deny-scripts-reconfig <span class="token function">yes</span>
<span class="token comment"># 此处配置默认的主库的ip 和端⼝ 最后的数字是哨兵数量的⼀半多⼀个</span>
sentinel monitor mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6380</span> <span class="token number">2</span>
sentinel down-after-milliseconds mymaster <span class="token number">30000</span>
sentinel config-epoch mymaster <span class="token number">0</span>
sentinel leader-epoch mymaster <span class="token number">0</span>
protected-mode no
sentinel current-epoch <span class="token number">0</span>
<span class="token punctuation">[</span>root@theo sentinelconf<span class="token punctuation">]</span><span class="token comment"># sed 's/26380/26381/g' sentinel-26380.conf &gt; sentinel-26381.conf</span>
<span class="token punctuation">[</span>root@theo sentinelconf<span class="token punctuation">]</span><span class="token comment"># sed 's/26380/26382/g' sentinel-26380.conf &gt; sentinel-26382.conf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>测试：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>启动 主redis
启动 备1redis
启动 备2redis
每个新窗口内依次启动三个哨兵：
<span class="token punctuation">[</span>root@theo sentinelconf<span class="token punctuation">]</span><span class="token comment"># redis-sentinel sentinel-26380.conf</span>
<span class="token punctuation">[</span>root@theo sentinelconf<span class="token punctuation">]</span><span class="token comment"># redis-sentinel sentinel-26381.conf</span>
<span class="token punctuation">[</span>root@theo sentinelconf<span class="token punctuation">]</span><span class="token comment"># redis-sentinel sentinel-26382.conf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_8-3、集群配置"><a href="#_8-3、集群配置" class="header-anchor">#</a> 8.3、集群配置</h3> <blockquote><p>高可用：保证redis⼀直处于可用状态，即时出现了故障也有备用方案保证可用性（哨兵模式）</p> <p>高并发：⼀个redis实例已经可以支持多达11w并发读操作或者8.1w并发写操作；但是如果对于有更高并发需求的应用来说，我们可以通过<code>读写分离</code> 、 <code>集群配置</code>来解决高并发问题  tdc</p> <p><img alt="image-20230111210453441" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111210453441.png" loading="lazy" class="lazy"></p></blockquote> <p><strong>Redis集群</strong></p> <ul><li>Redis集群中每个节点是对等的，无中心结构</li> <li>数据按照slots分布式存储在不同的redis节点上，节点中的数据可共享，可以动态调整数据的分布</li> <li>可扩展性强，可以动态增删节点，最多可扩展至1000+节点</li> <li>集群每个节点通过主备（哨兵模式）可以保证其高可用性</li></ul> <h4 id="_8-3-1、集群搭建"><a href="#_8-3-1、集群搭建" class="header-anchor">#</a> 8.3.1、集群搭建</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/redis-5.0.5</span>
<span class="token comment">#创建集群配置的文件夹，若配置3个节点的集群，至少需要6个redis</span>
<span class="token punctuation">[</span>root@theo redis-5.0.5<span class="token punctuation">]</span><span class="token comment"># mkdir cluster-conf</span>
<span class="token comment">#首先拷贝一个模板配置文件redis.conf，修改完成后再复制剩余5个，拷贝时去除里面的#行以及空行</span>
<span class="token punctuation">[</span>root@theo redis-5.0.5<span class="token punctuation">]</span><span class="token comment"># cat redis.conf | grep -v &quot;#&quot;|grep -v &quot;^$&quot; &gt; cluster-conf/redis-7001.conf</span>
<span class="token punctuation">[</span>root@theo redis-5.0.5<span class="token punctuation">]</span><span class="token comment"># cd cluster-conf/</span>
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># ls</span>
redis-7001.conf
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># vim redis-7001.conf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img alt="image-20230111212825485" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111212825485.png" loading="lazy" class="lazy"></p> <ul><li><p>拷贝6个文件，端口分别为 7001-7006</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># sed 's/7001/7002/g' redis-7001.conf &gt; redis-7002.conf</span>
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># sed 's/7001/7003/g' redis-7001.conf &gt; redis-7003.conf</span>
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># sed 's/7001/7004/g' redis-7001.conf &gt; redis-7004.conf</span>
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># sed 's/7001/7005/g' redis-7001.conf &gt; redis-7005.conf</span>
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># sed 's/7001/7006/g' redis-7001.conf &gt; redis-7006.conf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>启动6个redis实例</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-server redis-7001.conf &amp;</span>
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-server redis-7002.conf &amp;</span>
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-server redis-7003.conf &amp;</span>
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-server redis-7004.conf &amp;</span>
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-server redis-7005.conf &amp;</span>
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-server redis-7006.conf &amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img alt="image-20230111221755187" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111221755187.png" loading="lazy" class="lazy"></p></li> <li><p>查看6个实例是否启动</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># ps -ef|grep redis</span>
root <span class="token number">4789</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">10</span>:20 ? 00:00:00 redis-server *:7001 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root <span class="token number">4794</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">10</span>:20 ? 00:00:00 redis-server *:7002 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root <span class="token number">4799</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">10</span>:20 ? 00:00:00 redis-server *:7003 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root <span class="token number">4806</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">10</span>:21 ? 00:00:00 redis-server *:7004 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root <span class="token number">4811</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">10</span>:21 ? 00:00:00 redis-server *:7005 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
root <span class="token number">4816</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">10</span>:21 ? 00:00:00 redis-server *:7006 <span class="token punctuation">[</span>cluster<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>启动集群</p> <p>--cluster-replicas 1：每个节点1个备机</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster create 47.96.11.185:7001 47.96.11.185:7002 47.96.11.185:7003 47.96.11.185:7004 47.96.11.185:7005 47.96.11.185:7006 --cluster-replicas 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img alt="image-20230111212839457" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111212839457.png" loading="lazy" class="lazy"></p></li> <li><p>连接集群：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 7001 -c</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img alt="image-20230111221719403" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111221719403.png" loading="lazy" class="lazy"></p></li></ul> <h4 id="_8-3-2、集群管理"><a href="#_8-3-2、集群管理" class="header-anchor">#</a> 8.3.2、集群管理</h4> <ul><li><p>如果集群启动失败：等待节点加入</p> <ul><li><p><code>服务器检查安全组是否放行redis实例端口，以及+10000的端口</code></p></li> <li><p>Linux防火墙是否放行redis服务（关闭防火墙）</p></li> <li><p>Linux状态（top） ---- 更换云主机操作系统</p></li> <li><p>redis配置文件错误</p></li></ul></li> <li><p>创建集群：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster create 47.96.11.185:7001 47.96.11.185:7002 47.96.11.185:7003 47.96.11.185:7004 47.96.11.185:7005 47.96.11.185:7006 --cluster-replicas 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>查看集群状态</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster info 47.96.11.185:7001</span>
<span class="token number">47.96</span>.11.185:7001 <span class="token punctuation">(</span>4678478a<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">2</span> keys <span class="token operator">|</span> <span class="token number">5461</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">47.96</span>.11.185:7002 <span class="token punctuation">(</span>e26eaf2a<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">0</span> keys <span class="token operator">|</span> <span class="token number">5462</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">47.96</span>.11.185:7003 <span class="token punctuation">(</span>5752eb20<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">5461</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token number">3</span> keys <span class="token keyword">in</span> <span class="token number">3</span> masters.
<span class="token number">0.00</span> keys per slot on average.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>平衡节点的数据槽数</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster rebalance 47.96.11.185:7001</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">47.96</span>.11.185:7001<span class="token punctuation">)</span>
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
*** No rebalancing needed<span class="token operator">!</span> All nodes are within the <span class="token number">2.00</span>% threshold.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>迁移节点槽</p> <p><img alt="image-20211230124837233" data-src="https://s2.loli.net/2021/12/30/ju4gp1S3YVr8bLm.png" loading="lazy" class="lazy"></p></li> <li><p>删除节点</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster del-node 47.96.11.185:7001 4678478aa66b6d37b23944cf7db0ac07298538a4</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Removing <span class="token function">node</span> 4678478aa66b6d37b23944cf7db0ac07298538a4 from cluster <span class="token number">47.96</span>.11.185:7001
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER FORGET messages to the cluster<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> SHUTDOWN the node.
<span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster info 47.96.11.185:7002</span>
<span class="token number">47.96</span>.11.185:7002 <span class="token punctuation">(</span>e26eaf2a<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">8192</span> slots <span class="token operator">|</span> <span class="token number">2</span> slaves.
<span class="token number">47.96</span>.11.185:7003 <span class="token punctuation">(</span>5752eb20<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">2</span> keys <span class="token operator">|</span> <span class="token number">8192</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token number">3</span> keys <span class="token keyword">in</span> <span class="token number">2</span> masters.
<span class="token number">0.00</span> keys per slot on average.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>添加节点</p> <p>第一个是添加的新节点，第二个是集群</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@theo cluster-conf<span class="token punctuation">]</span><span class="token comment"># redis-cli --cluster add-node 47.96.11.185:7007 47.96.11.185:7002</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h4 id="_8-3-3、springboot应用连接集群"><a href="#_8-3-3、springboot应用连接集群" class="header-anchor">#</a> 8.3.3、SpringBoot应用连接集群</h4> <ul><li><p>添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>配置集群节点</p> <p>max-redirects: 3：获取失败，最多重试3次</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodes</span><span class="token punctuation">:</span> 47.96.11.185<span class="token punctuation">:</span><span class="token number">7001</span><span class="token punctuation">,</span>47.96.11.185<span class="token punctuation">:</span><span class="token number">7002</span><span class="token punctuation">,</span>47.96.11.185<span class="token punctuation">:</span><span class="token number">7003</span>
      <span class="token key atrule">max-redirects</span><span class="token punctuation">:</span> <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>操作集群</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token class-name">RedisDemo3Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RedisDemo3ApplicationTests</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//stringRedisTemplate.boundValueOps(&quot;key1&quot;).set(&quot;value1&quot;);</span>
		<span class="token class-name">String</span> s <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul> <h2 id="_9、redis淘汰策略"><a href="#_9、redis淘汰策略" class="header-anchor">#</a> 9、Redis淘汰策略</h2> <blockquote><p>Redis是基于内存结构进行数据缓存的，当内存资源消耗完毕，想要有新的数据缓存进来，必然要从Redis的
内存结构中释放⼀些数据。如何进⾏数据的释放呢？ ----Redis的淘汰策略</p></blockquote> <p>Redis提供的8中淘汰策略</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># volatile-lru -&gt; 从设置了过期时间的数据中淘汰最久未使⽤的数据.</span>
<span class="token comment"># allkeys-lru -&gt; 从所有数据中淘汰最久未使⽤的数据.</span>
<span class="token comment"># volatile-lfu -&gt; 从设置了过期时间的数据中淘汰使⽤最少的数据.</span>
<span class="token comment"># allkeys-lfu -&gt; 从所有数据中淘汰使⽤最少的数据.</span>
<span class="token comment"># volatile-random -&gt; 从设置了过期时间的数据中随机淘汰⼀批数据.</span>
<span class="token comment"># allkeys-random -&gt; 从所有数据中随机淘汰⼀批数据.</span>
<span class="token comment"># volatile-ttl -&gt; 淘汰过期时间最短的数据.</span>
<span class="token comment"># noeviction -&gt; 不淘汰任何数据，当内存不够时直接抛出异常.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><p>理解两个算法名词：</p> <p>LRU 最久最近未使用</p> <p>LFU 最近最少使用</p></li></ul> <p>如果开启，就在配置文件中选择一个</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>volatile-lru
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img alt="image-20230111222039745" data-src="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/image-20230111222039745.png" loading="lazy" class="lazy"></p> <h2 id="_10、redis高频面试题"><a href="#_10、redis高频面试题" class="header-anchor">#</a> 10、Redis高频面试题</h2> <ol><li>在项目中redis的使用场景
<ul><li>用于缓存首页数据</li> <li>...</li></ul></li> <li>Redis的持久化策略</li> <li>Redis支持的数据类型</li> <li>如何保证redis的高可用
<ul><li>Redis支持持久化，同时开启rdb 和 aof ，以保证数据的安全性（还是存在数据丢失风险的）</li> <li>Redis支持主从配置，我们可通配置哨兵，实现主备配置，保证可用性</li> <li>Redis也支持集群，通过集群配置可以保证redis的高并发</li></ul></li> <li>你刚才提到了redis集群，请问如何解决redis集群的脑裂问题？</li> <li>redis中的数据可以设置过期时间，当数据过期之后有些key并没有及时清除，请问如何处理？</li></ol> <h2 id="_11、使用redis实现分布式会话"><a href="#_11、使用redis实现分布式会话" class="header-anchor">#</a> 11、使⽤Redis实现分布式会话</h2> <h3 id="_11-1、流程分析"><a href="#_11-1、流程分析" class="header-anchor">#</a> 11.1、流程分析</h3> <p><img alt="image-20211230220655199" data-src="https://s2.loli.net/2021/12/30/b4pTm7NMfCRknEA.png" loading="lazy" class="lazy"></p> <h3 id="_11-2、在锋迷商城项目中使用redis实现分布式会话"><a href="#_11-2、在锋迷商城项目中使用redis实现分布式会话" class="header-anchor">#</a> 11.2、在锋迷商城项目中使用redis实现分布式会话</h3> <h4 id="_11-2-1、修改登录接口"><a href="#_11-2-1、修改登录接口" class="header-anchor">#</a> 11.2.1、修改登录接口</h4> <ul><li>当登录成功以token为key将用户信息保存到redis</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UsersMapper</span> usersMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultVO</span> <span class="token function">userResgit</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> pwd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token comment">//...</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultVO</span> <span class="token function">checkLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> pwd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Example</span> example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span><span class="token class-name">Users</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Example<span class="token punctuation">.</span>Criteria</span> criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Users</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> usersMapper<span class="token punctuation">.</span><span class="token function">selectByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span><span class="token class-name">ResStatus</span><span class="token punctuation">.</span>NO<span class="token punctuation">,</span><span class="token string">&quot;登录失败，⽤户名不存在！ &quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> md5Pwd <span class="token operator">=</span> <span class="token class-name">MD5Utils</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>md5Pwd<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            	<span class="token comment">//如果登录验证成功，则需要⽣成令牌token（token就是按照特定规则⽣成的字符串）</span>
            	<span class="token comment">//使⽤jwt规则⽣成token字符串</span>
            	<span class="token class-name">JwtBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            	<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;value1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;value2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">String</span> token <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setIssuedAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setClaims</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">signWith</span><span class="token punctuation">(</span><span class="token class-name">SignatureAlgorithm</span><span class="token punctuation">.</span>HS256<span class="token punctuation">,</span> <span class="token string">&quot;chang&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//当⽤户登录成功之后，以token为key 将⽤户信息保存到reids</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                	<span class="token class-name">String</span> userInfo <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                	stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JsonProcessingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span><span class="token class-name">ResStatus</span><span class="token punctuation">.</span>OK<span class="token punctuation">,</span>token<span class="token punctuation">,</span>users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span><span class="token class-name">ResStatus</span><span class="token punctuation">.</span>NO<span class="token punctuation">,</span><span class="token string">&quot;登录失败，密码错误！ &quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h4 id="_11-2-2、在需要只用用户信息的位置-直接根据token从redis查询"><a href="#_11-2-2、在需要只用用户信息的位置-直接根据token从redis查询" class="header-anchor">#</a> 11.2.2、在需要只用用户信息的位置，直接根据token从redis查询</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultVO</span> <span class="token function">addShoppingCart</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ShoppingCart</span> cart<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token class-name">String</span>
token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ResultVO</span> resultVO <span class="token operator">=</span> shoppingCartService<span class="token punctuation">.</span><span class="token function">addShoppingCart</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Users</span> users <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token class-name">Users</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> resultVO<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_11-2-3、修改受限资源拦截器"><a href="#_11-2-3、修改受限资源拦截器" class="header-anchor">#</a> 11.2.3、修改受限资源拦截器</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CheckTokenInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span>
                             handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;OPTIONS&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>token <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">ResultVO</span> resultVO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span><span class="token class-name">ResStatus</span><span class="token punctuation">.</span>LOGIN_FAIL_NOT<span class="token punctuation">,</span> <span class="token string">&quot;请先登录！ &quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">doResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span>resultVO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token comment">//根据token从redis中获取⽤户信息</span>
            <span class="token class-name">String</span> s <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//如果⽤户信息为空，表示⽤户未登录或者距离上⼀次访问超过30分钟</span>
                <span class="token class-name">ResultVO</span> resultVO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span><span class="token class-name">ResStatus</span><span class="token punctuation">.</span>LOGIN_FAIL_NOT<span class="token punctuation">,</span> <span class="token string">&quot;请先登录！ &quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">doResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span>resultVO<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">// 如果不为空，表示⽤户登录成功，续命</span>
                stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doResponse</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span><span class="token class-name">ResultVO</span> resultVO<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>resultVO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h4 id="_11-2-4、创建非受限资源拦截器"><a href="#_11-2-4、创建非受限资源拦截器" class="header-anchor">#</a> 11.2.4、创建非受限资源拦截器</h4> <blockquote><p>即使访问的是非受限资源，但是如果已经登录，只要与服务器有交互也要续命</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SetTimeInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>token <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> s <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>s <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                stringRedisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li>配置拦截器：</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterceptorConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CheckTokenInterceptor</span> checkTokenInterceptor<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SetTimeInterceptor</span> setTimeInterceptor<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>checkTokenInterceptor<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/shopcart/**&quot;</span><span class="token punctuation">)</span>
        	<span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/orders/**&quot;</span><span class="token punctuation">)</span>
        	<span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/useraddr/**&quot;</span><span class="token punctuation">)</span>
        	<span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/user/check&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>setTimeInterceptor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>前端访问注意事项： <code>只要前端有token，对接⼝的访问就要携带token</code></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/ZHANGChang47/BlogVuePress/edit/main/docs/05.数据库/01.Redis.md" target="_blank" rel="noopener noreferrer">帮助我改善此页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023年2月4日</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/1c8947/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">MySQL</div></a> <a href="/pages/a87d95/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">MyBatis</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/1c8947/" class="prev">MySQL</a></span> <span class="next"><a href="/pages/a87d95/">MyBatis</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/9b7514/"><div>
            沧桑百年史，爱国西交情
            <!----></div></a> <span class="date">02-04</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/d7b60a/"><div>
            承党恩泽，物阜民丰
            <!----></div></a> <span class="date">02-04</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/a0057c/"><div>
            静谧之眼
            <!----></div></a> <span class="date">02-04</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:2648492063@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/ZHANGChang47" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://typora001-zc.oss-cn-chengdu.aliyuncs.com/typoraImg/Snipaste_2023-02-03_22-33-33.webp" title="微信" target="_blank" class="iconfont icon-weixin"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>张畅 |<a href="https://beian.miit.gov.cn" target="_blank">陕ICP备2022001001号</a><br>	<img src="http://www.beian.gov.cn/img/new/gongan.png" border="0" /></a>	 		<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41018302000331" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="" style="float:left;"/><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px;">冀公网安备 13112802000237号</p></a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><APlayer audio="" fixed="true" mini="true" theme="#b7daff" loop="loop" order="list" preload="auto" volume="0.7" mutex="true" lrc-type="0" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer><div></div><div></div><div></div><div id="tcomment"></div><!----></div></div>
    <script src="/assets/js/app.bb5e25c9.js" defer></script><script src="/assets/js/2.108e92a1.js" defer></script><script src="/assets/js/66.5ef4606b.js" defer></script><script src="/assets/js/5.73b07204.js" defer></script><script src="/assets/js/13.9b1b1c77.js" defer></script><script src="/assets/js/14.e2f4930c.js" defer></script><script src="/assets/js/9.5b9b4ae3.js" defer></script><script src="/assets/js/10.68c0c324.js" defer></script>
  </body>
</html>
